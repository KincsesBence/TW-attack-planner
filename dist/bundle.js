/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var n={"./src/core/Api.ts":(n,e,a)=>{a.r(e),a.d(e,{TroopTransaction:()=>P,calcUnitPop:()=>_,coordDistance:()=>C,fetchGroups:()=>f,game:()=>o,getAllPlayer:()=>w,getAllVillages:()=>m,getServerConifg:()=>u,getSlowestUnit:()=>A,getUnitConfig:()=>h,hasAvailableTroops:()=>T,loadPages:()=>b});var t=a("./src/core/VillageModel.ts"),i=a("./src/core/xml2json.ts");const l="https://"+window.location.hostname,o=game_data,s="/map/village.txt",r="/map/player.txt",d="/interface.php?func=get_unit_info",c="/interface.php?func=get_config",g="screen=accountmanager",p="screen=overview_villages&mode=combined";async function u(){let n=await $.ajax({url:l+c});return(0,i.xml2json)(n,"")}async function h(){let n=await $.ajax({url:l+d});return(0,i.xml2json)(n,"")}async function m(){let n=await $.ajax({url:l+s});n=n.trim();let e=[],a=n.split("\n");for(let n=0;n<a.length;n++){let t=a[n].split(","),i=parseInt(t[2]),l=parseInt(t[3]);e.push({id:parseInt(t[0]),name:decodeURIComponent(t[1]).replaceAll("+"," "),owner:parseInt(t[4]),kontinent:10*Math.floor(l/100)+Math.floor(i/100),coord:{text:t[2]+"|"+t[3],x:i,y:l},popRemain:null,unitsContain:null,popSize:null})}return e}async function w(){let n=await $.ajax({url:l+r});n=n.trim();let e=[],a=n.split("\n");for(let n=0;n<a.length;n++){let t=a[n].split(",");e.push({id:parseInt(t[0]),name:decodeURIComponent(t[1]).replaceAll("+"," "),allyId:parseInt(t[2]),villageCnt:parseInt(t[3]),pionts:parseInt(t[4]),rank:parseInt(t[5])})}return e}function v(n=1,e=0){return`/game.php?${0!=o.player.sitter?"t="+o.player.id+"&":""}village=${o.village.id}&group=${e}&page=${n}&screen=overview_villages&mode=combined`}async function f(){let n=await $.ajax({url:l+`/game.php?${0!=o.player.sitter?"t="+o.player.id+"&":""}village=${o.village.id}& ${window.game_data.features.AccountManager.active?g:p}`}),e=[],a=$(n).find(".group-menu-item").get();return a.length>0?a.forEach((n=>{e.push({id:parseInt($(n).attr("data-group-id")),name:$(n).text().trim().slice(1,-1)})})):$($(n).find("#paged_view_content").find("select").get()[0]).find("option").get().forEach((n=>{if(!$(n).is(":disabled")){let a=new URLSearchParams($(n).attr("value"));console.log(a,$(n).attr("value")),e.push({id:parseInt(a.get("group")),name:$(n).text()})}})),e}async function b(n){let e=[],a=[],t=[];for(let e=0;e<n.length;e++)a.push(k(v(0,n[e]),e,1));await Promise.allSettled(a).then((n=>n.forEach((async n=>{t.push(n.value.pageCnt),n.value.villages.forEach((n=>{-1==e.findIndex((e=>n.id==e.id))&&e.push(n)}))})))),a=[];for(let e=0;e<n.length;e++)for(let i=1;i<t[e];i++)a.push(k(v(i,n[e]),(e+1)*i,i));return await Promise.allSettled(a).then((n=>n.forEach((async n=>{n.value.villages.forEach((n=>{-1==e.findIndex((e=>n.id==e.id))&&e.push(n)}))})))),e}function k(n,e,a){return new Promise((async(i,l)=>{setTimeout((async()=>{let e=await $.ajax({url:n}),l=await async function(n){let e=$(n).find("#combined_table").find("tr"),a=[],i=[];$(e).find("th").get().forEach(((n,e)=>{let a=$(n).find("img");if(a.length>0){let n=$(a).attr("src");n.includes("graphic/unit/unit_")&&!n.includes("unit_militia")&&i.push({index:e,name:y(n)})}}));for(let n=1;n<e.length;n++){const l=e[n];let o=$(l).find("td"),s=parseInt($(l).find(".quickedit-vn").attr("data-id")),r={spear:0,sword:0,axe:0,archer:0,spy:0,light:0,marcher:0,heavy:0,ram:0,catapult:0,knight:0,snob:0},d=0;i.forEach((n=>{let e=parseInt($(o[n.index]).text());r[n.name]=e,d+=window.unitConfig[n.name].pop*e}));let c=(await t.VillageModel.init()).find((n=>n.id==s)),g=parseInt($(o[7]).find("a").text().split(" ")[0]);c.unitsContain=r,c.popRemain=g,c.popSize=d,a.push(c)}return a}(e);i({pageCnt:x(e),pageNum:a-1,villages:l})}),200*e)}))}function x(n){let e=$($(n).find(".paged-nav-item").get()[0]).parent().find("select"),a=0;return a=1==e.length?e.find("option").length-1:$(n).find(".paged-nav-item").length,a}function y(n){let e=n.split("/");return e[e.length-1].split(".")[0].replace("unit_","").replace("@2x","")}function P(n,e,a){return Object.keys(a).forEach((t=>{[n[t],e[t]]=function(n,e,a){return a<0&&(a=e+a)<0&&(a=0),e-a<0?(n=e,e=0):(n+=a,e-=a),[n,e]}(n[t],e[t],a[t])})),[n,e]}function _(n){let e=0;return Object.keys(n).forEach((a=>{e+=window.unitConfig[a].pop*n[a]})),e}function A(n,e){var a=Object.keys(n).map((n=>({key:n,value:window.unitConfig[n].speed}))).sort(((n,e)=>n.value>e.value?-1:1));if(!e&&n.knight>0)return{key:"knight",value:window.unitConfig.knight.speed};for(let e=0;e<a.length;e++)if(n[a[e].key]>0)return a[e]}function C(n,e){return n&&e?Math.sqrt(Math.pow(e.coord.x-n.coord.x,2)+Math.pow(e.coord.y-n.coord.y,2)):null}function T(n,e){let a=Object.keys(e);for(let t=0;t<a.length;t++){const i=a[t];if("snob"==i&&n.unitsContain[i]>0&&0==e[i])return console.log("ide"),!1;if(0!=e[i]){if(e[i]<0&&n.unitsContain[i]+e[i]<0)return!1;if(0==n.unitsContain[i]&&99999==e[i])return!1;if(n.unitsContain[i]<e[i]&&99999!=e[i]&&e[i]>0)return!1}}return!0}},"./src/core/Language.ts":(n,e,a)=>{a.r(e),a.d(e,{Lang:()=>l,determineLang:()=>o});var t=a("./src/view/language/en.ts"),i=a("./src/view/language/hu.ts");function l(n){let e=i.hu;switch(window.Lang){case"hu":e=i.hu;break;case"en":e=t.en}return e.hasOwnProperty(n)?e[n]:`lang.${window.Lang}.${n}`}function o(){const n=navigator.language.split("-")[0];return["hu","en"].includes(n)?n:"en"}},"./src/core/Model.ts":(n,e,a)=>{a.r(e),a.d(e,{Model:()=>t});class t{constructor(n=[]){this.items=[],this.items=n}first(){return this.items.length>0?this.items[0]:null}get(n=this.items.length){return this.items.slice(0,n)}filter(n){let e=this.items.filter(n);return new t(e)}find(n){return this.items.find(n)}sort(n,e){let a=this.items.sort(((a,t)=>a[n]>t[n]?e?1:-1:e?-1:1));return new t(a)}}},"./src/core/PlayersModel.ts":(n,e,a)=>{a.r(e),a.d(e,{PlayersModel:()=>l});var t=a("./src/core/Api.ts"),i=a("./src/core/Model.ts");class l extends i.Model{static init(){return null==l.instance?async function(){return l.instance=new l,await l.instance.loadPlayers(),l.instance}():async function(){return l.instance}()}async loadPlayers(){this.items=await(0,t.getAllPlayer)()}}l.instance=null},"./src/core/Query.ts":(n,e,a)=>{a.r(e),a.d(e,{Query:()=>t});class t{constructor(n,e,a,t,i){this.objectCopy=[],this.way=1,this.field="",this.from=0,this.to=0,this.draw=50,this.CanScroll=!1,this.searchField=null,this.field=i,this.objectRef=n,this.objectCopy=structuredClone(this.objectRef),this.controlledOrder(this.field,this.way),this.funcRef=t,this.targetHtml=e,this.targetCnt=a;let l=this;e.addEventListener("scroll",(function(n){let a=!1;e.scrollHeight-100<=e.clientHeight+e.scrollTop&&!a&&l.CanScroll&&(a=!0,l.pull())})),addEventListener("wheel",(n=>{l.CanScroll=!0,clearTimeout(l.To),l.To=setTimeout((()=>{l.CanScroll=!1}),500)}))}search(n){this.searchField=n,this.reset(),this.objectCopy=this.objectCopy.filter((n=>`${n.name} (${n.coord.text}) K${n.kontinent}`.includes(this.searchField.value))),this.render()}setDraw(n){this.draw=n}calcPaging(){this.to=this.from+this.draw,this.to>this.objectCopy.length&&(this.to=this.objectCopy.length)}reset(){$(this.targetHtml).html(""),$(this.targetHtml).scrollTop(0),this.objectCopy=structuredClone(this.objectRef),this.controlledOrder(this.field,1),this.from=0,this.to=0}resetAll(){this.reset(),this.render(),this.searchField&&(this.searchField.value="")}controlledOrder(n,e){let a=this;this.objectCopy.sort(((e,t)=>a.getProp(n,e)<a.getProp(n,t)?-1*this.way:1*this.way))}order(n){this.reset(),this.field==n?this.way*=-1:this.way=-1,this.controlledOrder(n,this.way),this.field=n,this.render()}getProp(n,e){let a=n.split(".");return 1==a.length?e[a[0]]:(e=e[a.shift()],this.getProp(a.join("."),e))}pull(){this.from+this.draw>this.objectCopy.length||(this.from+=this.draw,this.to=this.from+this.draw,this.render())}render(){this.calcPaging();for(let n=this.from;n<this.to;n++)$(this.targetHtml).append(this.funcRef(this.objectCopy[n]));$(this.targetCnt).text(this.objectCopy.length)}partialRender(n,e){n.forEach((n=>{$(this.targetHtml).find(`#${this.getProp(e,n)}`).replaceWith(this.funcRef(n))}))}}},"./src/core/VillageModel.ts":(n,e,a)=>{a.r(e),a.d(e,{VillageModel:()=>l});var t=a("./src/core/Api.ts"),i=a("./src/core/Model.ts");class l extends i.Model{static init(){return null==l.instance?async function(){return l.instance=new l,await l.instance.loadVillages(),l.instance}():l.instance}async loadVillages(){this.items=await(0,t.getAllVillages)()}}l.instance=null},"./src/core/planDB.ts":(n,e,a)=>{a.r(e),a.d(e,{planDB:()=>t});class t{async init(){this.db=await this.loadDB(),console.log("loaded plan DB 🚀")}async loadPlans(){return new Promise((async(n,e)=>{if(!this.db.objectStoreNames.contains("plans"))return void n([]);let a=this.db.transaction("plans"),t=await a.objectStore("plans").getAll();t.onsuccess=()=>{n(t.result.map((n=>JSON.parse(n.data))))}}))}async savePlan(n){let e=this.db.transaction("plans","readwrite");await e.objectStore("plans").put({id:n.id,data:JSON.stringify(n)})}async removePlan(n){let e=this.db.transaction("plans","readwrite");await e.objectStore("plans").delete(n)}async loadDB(){return new Promise(((n,e)=>{let a=indexedDB.open("TW_ATTACK_PLANNER_DATA",1);a.onupgradeneeded=function(){let e=a.result;e.objectStoreNames.contains("plans")||e.createObjectStore("plans",{keyPath:"id",autoIncrement:!1}),a.onsuccess=function(){n(a.result)}},a.onsuccess=function(){n(a.result)},a.onerror=function(){throw console.error("Error",a.error),new Error(a.error.message)}}))}}},"./src/core/xml2json.ts":(n,e,a)=>{function t(n,e){var a={toObj:function(n){var e={};if(1==n.nodeType){if(n.attributes.length)for(var t=0;t<n.attributes.length;t++)e["@"+n.attributes[t].nodeName]=(n.attributes[t].nodeValue||"").toString();if(n.firstChild){for(var i=0,l=0,o=!1,s=n.firstChild;s;s=s.nextSibling)1==s.nodeType?o=!0:3==s.nodeType&&s.nodeValue.match(/[^ \f\n\r\t\v]/)?i++:4==s.nodeType&&l++;if(o)if(i<2&&l<2)for(a.removeWhite(n),s=n.firstChild;s;s=s.nextSibling)3==s.nodeType?e["#text"]=a.escape(s.nodeValue):4==s.nodeType?e["#cdata"]=a.escape(s.nodeValue):e[s.nodeName]?e[s.nodeName]instanceof Array?e[s.nodeName][e[s.nodeName].length]=a.toObj(s):e[s.nodeName]=[e[s.nodeName],a.toObj(s)]:e[s.nodeName]=a.toObj(s);else n.attributes.length?e["#text"]=a.escape(a.innerXml(n)):e=a.escape(a.innerXml(n));else if(i)n.attributes.length?e["#text"]=a.escape(a.innerXml(n)):(e=a.escape(a.innerXml(n)),isNaN(e)||(e=parseFloat(e)));else if(l)if(l>1)e=a.escape(a.innerXml(n));else for(s=n.firstChild;s;s=s.nextSibling)e["#cdata"]=a.escape(s.nodeValue)}n.attributes.length||n.firstChild||(e=null)}else 9==n.nodeType?e=a.toObj(n.documentElement):alert("unhandled node type: "+n.nodeType);return e},toJson:function(n,e,t){var i=e?'"'+e+'"':"";if(n instanceof Array){for(var l=0,o=n.length;l<o;l++)n[l]=a.toJson(n[l],"",t+"\t");i+=(e?":[":"[")+(n.length>1?"\n"+t+"\t"+n.join(",\n"+t+"\t")+"\n"+t:n.join(""))+"]"}else if(null==n)i+=(e&&":")+"null";else if("object"==typeof n){var s=[];for(var r in n)s[s.length]=a.toJson(n[r],r,t+"\t");i+=(e?":{":"{")+(s.length>1?"\n"+t+"\t"+s.join(",\n"+t+"\t")+"\n"+t:s.join(""))+"}"}else i+="string"==typeof n?(e&&":")+'"'+n.toString()+'"':(e&&":")+n.toString();return i},innerXml:function(n){var e="";if("innerHTML"in n)e=n.innerHTML;else for(var a=function(n){var e="";if(1==n.nodeType){e+="<"+n.nodeName;for(var t=0;t<n.attributes.length;t++)e+=" "+n.attributes[t].nodeName+'="'+(n.attributes[t].nodeValue||"").toString()+'"';if(n.firstChild){e+=">";for(var i=n.firstChild;i;i=i.nextSibling)e+=a(i);e+="</"+n.nodeName+">"}else e+="/>"}else 3==n.nodeType?e+=n.nodeValue:4==n.nodeType&&(e+="<![CDATA["+n.nodeValue+"]]>");return e},t=n.firstChild;t;t=t.nextSibling)e+=a(t);return e},escape:function(n){return n.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(n){n.normalize();for(var e=n.firstChild;e;)if(3==e.nodeType)if(e.nodeValue.match(/[^ \f\n\r\t\v]/))e=e.nextSibling;else{var t=e.nextSibling;n.removeChild(e),e=t}else 1==e.nodeType?(a.removeWhite(e),e=e.nextSibling):e=e.nextSibling;return n}};return 9==n.nodeType&&(n=n.documentElement),a.toObj(a.removeWhite(n))}a.r(e),a.d(e,{xml2json:()=>t})},"./src/view/ConfirmVillageSpeedRemoveModal.ts":(n,e,a)=>{a.r(e),a.d(e,{ConfirmVillageSpeedRemoveModal:()=>i});var t=a("./src/core/Language.ts");const i=n=>`<div class="modal-input-inline"><h2>${(0,t.Lang)("removeQuestion")}</h2></div><div class="modal-input-inline"><button class="btn" onclick="window.targetItem.confirmRemoveVillageBooster(${n})">${(0,t.Lang)("yes")}</button> <button class="btn" onclick="window.closeModal()">${(0,t.Lang)("cancel")}</button></div>`},"./src/view/addAttackModal.ts":(n,e,a)=>{a.r(e),a.d(e,{addAttackModal:()=>l});var t=a("./src/core/Api.ts"),i=a("./src/core/Language.ts");const l=()=>`<div class="modal-input-inline"><label for="attack">${(0,i.Lang)("attack")}:</label><input type="radio" value="attack" name="planner-operation" checked><label for="reinforce">${(0,i.Lang)("support")}:</label><input type="radio" value="reinforce" name="planner-operation"></div><div class="modal-input-group"><label for="planner-template">${(0,i.Lang)("template")}:</label><select id="planner-template" placeholder="${(0,i.Lang)("notSelected")}"><option value="temp_all">${(0,i.Lang)("allUnit")}</option>${window.attackPlan.templates.map((n=>`<option value="${n.name}" ${window.latestTemplate==n.name?"selected":""}>${n.name}</option>`))}</select></div><div class="modal-input-group"><label for="planner-arrival">${(0,i.Lang)("arrival")}:</label><select id="planner-arrival" placeholder="${(0,i.Lang)("notSelected")}">${window.attackPlan.arrivals.map((n=>`<option value="${n}" ${window.latestArrival==n?"selected":""}>${n}</option>`))}</select></div><div class="modal-input-group"><label for="planner-notes">${(0,i.Lang)("note")}:</label><input id="planner-notes" placeholder="${(0,i.Lang)("noNote")}"></div><div class="modal-input-inline"><button class="btn" onclick="window.addAttackConfirm()">${(0,i.Lang)("add")}</button> <button class="btn" onclick="window.closeModal()">${(0,i.Lang)("cancel")}</button></div>`;window.addAttackConfirm=()=>{let n=[],e=[];if(0==$('input[name="target"]:checked').get().length)return void window.UI.ErrorMessage((0,i.Lang)("noTargetSelected"));if(0==$(".launch-list").find("input:checked").get().length)return void window.UI.ErrorMessage((0,i.Lang)("noLauncherSelected"));let a=parseInt($('input[name="target"]:checked').val().toString()),t=$("#planner-template").val().toString(),l=$('input[name="planner-operation"]:checked').val().toString(),o=$("#planner-arrival").val().toString(),s=$("#planner-notes").val().toString();window.latestTemplate=t,window.latestArrival=o,console.log($(".launch-list").find("input:checked").get().length,a,t,l,o,s);let r=window.attackPlan.targetPool.findIndex((n=>n.village.id==a)),d=window.attackPlan.templates.findIndex((n=>n.name==t));$(".launch-list").find("input:checked").get().forEach((e=>{let a=parseInt($(e).val().toString()),i=window.attackPlan.launchPool.findIndex((n=>n.id==a)),c=null;d>-1&&(c=window.attackPlan.templates[d].units),"temp_all"==t&&(c=window.attackPlan.launchPool[i].unitsContain);let g=window.attackPlan.launchPool[i].id,p=window.addLauncher(r,i,c,l,o,s);console.log(p),p?$(".launch-list").find(`#${g}`).remove():n.push(window.attackPlan.launchPool[i])})),e.push(window.attackPlan.targetPool[r]),window.targetPoolQuery.partialRender(e,"village.id"),window.launchVillagesQuery.partialRender(n,"id"),$(".planner-modal").hide(),window.DB.savePlan(window.attackPlan)},window.addLauncher=(n,e,a,i,l,o)=>{let s={...window.attackPlan.launchPool[e]};return s.unitsContain={spear:0,sword:0,axe:0,archer:0,spy:0,light:0,marcher:0,heavy:0,ram:0,catapult:0,knight:0,snob:0},[s.unitsContain,window.attackPlan.launchPool[e].unitsContain]=(0,t.TroopTransaction)(s.unitsContain,window.attackPlan.launchPool[e].unitsContain,a),s.popSize=(0,t.calcUnitPop)(s.unitsContain),window.attackPlan.launchPool[e].popSize=(0,t.calcUnitPop)(window.attackPlan.launchPool[e].unitsContain),s.popSize>0&&window.attackPlan.targetPool[n].launchers.push({arrival:l,isAttack:"attack"==i,notes:o,unitSpeed:(0,t.getSlowestUnit)(s.unitsContain,"attack"==i),village:s}),0==window.attackPlan.launchPool[e].popSize&&(window.attackPlan.launchPool.splice(e,1),!0)}},"./src/view/addPlayerSpeedModal.ts":(n,e,a)=>{a.r(e),a.d(e,{addPlayerSpeedModal:()=>i});var t=a("./src/core/Language.ts");const i=()=>{let n=[];window.attackPlan.targetPool.forEach((e=>{n.includes(e.village.owner)||n.push(e.village.owner)}));let e=[];return n.forEach((n=>{let a=window.Players.find((e=>e.id==n));a&&-1==window.attackPlan.boosters.findIndex((n=>n.playerId==a.id))&&e.push(a)})),`<div class="modal-input-group"><select id="planner-player-boosts" size="5">${window.attackPlan.boosters.map((n=>`<option value="${n.playerId}">${n.player} (${n.value}%)</option>`))}</select><button class="btn" onclick="window.removePlayerBoost()">${(0,t.Lang)("remove")}</button></div>\n<div class="modal-input-group"><select id="planner-player-select">${e.map((n=>`<option value="${n.id}">${n.name}</option>`))}</select><label for="planner-player-boost">${(0,t.Lang)("boosterPct")}:</label><input id="planner-player-boost" type="number" max="60" min="1" placeholder="%"><button class="btn" onclick="window.addPlayerBoost()">${(0,t.Lang)("add")}</button></div>`};window.addPlayerBoost=()=>{if(""==$("#planner-player-boost").val())return;let n=parseInt($("#planner-player-select").val().toString()),e=parseInt($("#planner-player-boost").val().toString());if(0==e)return;let a=window.Players.find((e=>e.id==n));window.attackPlan.boosters.push({player:a.name,playerId:n,value:e}),window.DB.savePlan(window.attackPlan),$(".planner-modal-content").html(i())},window.removePlayerBoost=()=>{if(null==$("#planner-player-boosts").val())return;let n=parseInt($("#planner-player-boosts").val().toString()),e=window.attackPlan.boosters.findIndex((e=>e.playerId==n));window.attackPlan.boosters.splice(e,1),$(".planner-modal-content").html(i())}},"./src/view/addVillageSpeedModal.ts":(n,e,a)=>{a.r(e),a.d(e,{addVillageBoosterModal:()=>i});var t=a("./src/core/Language.ts");const i=n=>`<div class="modal-input-group"><label for="planner-notes">${(0,t.Lang)("boosterPct")}:</label><input id="planner-village-boost" type="number" max="60" min="1" placeholder="%"></div><div class="modal-input-inline"><button class="btn" onclick="window.targetItem.confirmAddVillageBooster(${n})">${(0,t.Lang)("yes")}</button> </div>`},"./src/view/autoAssignModal.ts":(n,e,a)=>{a.r(e),a.d(e,{autoAssignModal:()=>l});var t=a("./src/core/Api.ts"),i=a("./src/core/Language.ts");const l=()=>{let n="";return window.attackPlan.templates.forEach((e=>{n+=`<option value='${e.name}'>${e.name}</option>`})),`<style>.assigner-row {  display: grid;display: grid;grid-template-columns: 200px repeat(auto-fill, 80px) 10px;}\n.assigner-row input{width:30px;}\n.item{padding:5px;}\n.add-assignment{width: 130px;}\n.add-assignment input{width: 50px;}\n.assigner-target-villages{width:1100px;max-height:250px;overflow-y:auto;border: solid 1px #6c4824;border-radius: 5px;background-color:#fff5dc;}\n.assigner-target-villages .item{border: solid 1px #6c4824;}\n.assigner-counter .item{border: solid 1px #6c4824;}\n.assigner-counter .item:first-of-type{border: none !important;}\n.assigner-counter .item:last-of-type{border: none !important;}\n\n.assigner-target-btn{display:block;width: 20px;height: 20px;background: url(https://dshu.innogamescdn.com/asset/80b013af/graphic/login_close.png) top left no-repeat;cursor: pointer;background-size: 20px;margin-right: 10px;}\n.assigner-date div{transform: rotate(290deg) translateX(20px);text-wrap: nowrap;}\n.assignment-alg{margin:15px 0;display: flex;justify-content: center;}\n.add-assignment-input{margin-bottom:5px;display:grid;}</style><div class="assigner"><div class="add-assignment"><div class="add-assignment-input"><label>${(0,i.Lang)("date")}:</label><select id="assignmentArrival">${window.attackPlan.arrivals.map((n=>`<option value='${n}'>${n}</option>`)).join("")}</select></div><div class="add-assignment-input"><label>${(0,i.Lang)("template")}:</label><select id="assignmentTemplates">${n}</select></div><div class="add-assignment-input"><label>${(0,i.Lang)("qntt")}:</label><input min="1" value="1" id="assigner-number-filter" type="number" disabled><input id="assigner-max-filter" onclick="$('#assigner-number-filter').prop('disabled', (i, v) => !v);" type="checkbox" checked></div><button class="btn" onclick="autoAssign.addAssignment()">+ ${(0,i.Lang)("add")}</button></div><div class="assigner-header"><div class="assigner-row assigner-date"><div class="item"></div><div class="item checkbox"></div></div><div class="assigner-row assigner-remover"><div class="item"></div><div class="item checkbox"></div></div><div class="assigner-row assigner-loader"><div class="item"></div><div class="item checkbox"></div></div><div class="assigner-row assigner-name"><div class="item">${(0,i.Lang)("village")} (${window.attackPlan.targetPool.length})</div><div class="item checkbox"><input id="assigner-main-checkbox" onclick="autoAssign.checkAll()" type="checkbox"></div></div>  </div><div class="assigner-target-villages">${window.attackPlan.targetPool.map((n=>`<div class="assigner-row" id="assigner-row-${n.village.id}"><div class="item"><a target="_blank" href="/game.php?village=${t.game.village.id}&screen=info_village&id=${n.village.id}">${n.village.name}(${n.village.coord.text}) K${n.village.kontinent}</a></div><div class="item checkbox"><input class="assigner-target-check" value="${n.village.id}" type="checkbox"></div></div>`)).join("")}</div><div class="assigner-row assigner-counter"><div class="item"></div><div class="item checkbox"></div></div><div class="assignment-alg"><input id="evenDistributeClosest" value="1" type="radio" name="assignmentAlg"><label for="evenDistributeClosest">${(0,i.Lang)("even")}</label><input id="oneByOneQ" value="2" type="radio" name="assignmentAlg"><label for="oneByOneQ">${(0,i.Lang)("oneByOne")}</label><input id="oneByOneClosest" value="3"  type="radio" name="assignmentAlg"><label for="oneByOneClosest">${(0,i.Lang)("oneByOneClosest")}</label><input id="closestToTarget" value="4" type="radio" name="assignmentAlg"><label for="closestToTarget">${(0,i.Lang)("closestToTarget")}</label></div><div><button style="margin: 0 auto; display: block;" onclick="autoAssign.startAssignment()" class="btn">${(0,i.Lang)("startAssignment")}</button></div></div><div id="dialog-loading" style="display: none;justify-content: center;width: 100%;"><img style="height:25px" src="https://dshu.innogamescdn.com/asset/6389cdba/graphic/loading.gif"><span style="padding:5px">${(0,i.Lang)("assigningAttacks")}...</span></div>`};function o(n,e){let a=[];for(let i=0;i<window.autoAssign.launchPoolCopy.length;i++){const l=window.autoAssign.launchPoolCopy[i];if(a.length>=e)break;if((0,t.hasAvailableTroops)(l,n.units)){let e={...l};e.unitsContain={spear:0,sword:0,axe:0,archer:0,spy:0,light:0,marcher:0,heavy:0,ram:0,catapult:0,knight:0,snob:0},[e.unitsContain,l.unitsContain]=(0,t.TroopTransaction)(e.unitsContain,l.unitsContain,n.units),n.units.snob>0&&(n.units.marcher<0&&(l.unitsContain.marcher=0),n.units.light<0&&(l.unitsContain.light=0),n.units.axe<0&&(l.unitsContain.axe=0)),e.popSize=(0,t.calcUnitPop)(e.unitsContain),l.popSize=(0,t.calcUnitPop)(l.unitsContain),a.push(e),0==l.popSize&&(console.log("removed"),window.autoAssign.launchPoolCopy.splice(i,1))}}return a}window.autoAssign={assignTypes:[],launchPoolCopy:[],removeAssignment:n=>{let e=window.autoAssign.assignTypes.findIndex((e=>e.id==n.toString()));-1!=e&&(window.autoAssign.assignTypes[e].filtered.forEach((n=>{let a=window.autoAssign.launchPoolCopy.findIndex((e=>e.id==n.id));-1==a?window.autoAssign.launchPoolCopy.push(n):(window.autoAssign.assignTypes[e].template.units.snob>0&&(window.autoAssign.assignTypes[e].template.units.marcher<0&&(n.unitsContain.marcher-=window.autoAssign.assignTypes[e].template.units.marcher),window.autoAssign.assignTypes[e].template.units.light<0&&(n.unitsContain.light-=window.autoAssign.assignTypes[e].template.units.light),window.autoAssign.assignTypes[e].template.units.axe<0&&(n.unitsContain.axe-=window.autoAssign.assignTypes[e].template.units.axe)),[window.autoAssign.launchPoolCopy[a].unitsContain,n.unitsContain]=(0,t.TroopTransaction)(window.autoAssign.launchPoolCopy[a].unitsContain,n.unitsContain,n.unitsContain))})),window.autoAssign.assignTypes.splice(e,1),$(".ar-"+n).remove())},fillAssignment:n=>{$(".assigner-target-villages .assigner-target-check").get().forEach((e=>{if(!$(e).is(":checked"))return;let a=$(`.assigner-loader .ar-${n}`).find(".ass-inp").val();$(e).parent().parent().find(`.ar-${n} .ass-inp`).val(a)})),window.autoAssign.updateCount(n)},addAssignment:()=>{if(window.autoAssign.assignTypes.length>=10)return;let n=$("#assignmentArrival").val().toString(),e=99999;$("#assigner-max-filter").is(":checked")||(e=parseInt($("#assigner-number-filter").val().toString()));let a=$("#assignmentTemplates").val().toString(),t=window.attackPlan.templates.find((n=>n.name==a)),i={id:(new Date).getTime().toString(),arrival:n,filtered:o(t,e),required:0,template:t,max:e};window.autoAssign.assignTypes.push(i),$(".assigner-header .assigner-loader .checkbox").before(`<div class="item ar-${i.id}" ><input class="ass-inp" value="0" type="number" min="0"><button onclick="autoAssign.fillAssignment(${i.id})">↓</button></div>`),$(".assigner-header .assigner-name .checkbox").before(`<div class="item ar-${i.id}" >${i.template.name}</div>`),$(".assigner-header .assigner-remover .checkbox").before(`<div class="item ar-${i.id}" ><a onclick="autoAssign.removeAssignment(${i.id})" class="assigner-target-btn"></a></div>`),$(".assigner-header .assigner-date .checkbox").before(`<div class="item ar-${i.id}" >${i.arrival}</div>`),$(".assigner-target-villages").find(".assigner-row").get().forEach((n=>{$(n).find(".checkbox").before(`<div class="item ar-${i.id}" ><input class="ass-inp" onchange="autoAssign.updateCount(${i.id})" onkeyup="autoAssign.updateCount(${i.id})" value="0" type="number" min="0"></div>`)})),$(".assigner-counter .checkbox").before(`<div class="item ar-${i.id}" ><span class="cnt-actual">0</span>/${i.filtered.length}</div>`),console.log(window.autoAssign.assignTypes)},startAssignment:()=>{let n=$('input[name="assignmentAlg"]:checked').val();n?0!=window.autoAssign.assignTypes.length?($("#dialog-loading").show(),$("#plannerCloseBtn").hide(),$(".assigner").hide(),setTimeout((()=>{switch(n){case"1":window.autoAssign.assignTypes.forEach(((n,e)=>{let a=0;for(;n.filtered.length>0&&n.required>a;)for(let i=0;i<window.attackPlan.targetPool.length;i++){const l=window.attackPlan.targetPool[i];let o=0;for(let n=0;n<e+1;n++)o+=parseInt($(`#assigner-row-${l.village.id} .ar-${window.autoAssign.assignTypes[n].id} .ass-inp`).val().toString());if(console.log(o),l.launchers.length<o){let e=-1,o=999999;if(n.filtered.forEach(((n,a)=>{let i=(0,t.coordDistance)(n,l.village);i<o&&(e=a,o=i)})),e>-1){a++,console.log(a,n.required);let t=window.attackPlan.launchPool.findIndex((a=>a.id==n.filtered[e].id));window.addLauncher(i,t,n.template.units,"attack",n.arrival,""),n.filtered.splice(e,1)}}}}));break;case"2":!function(){for(let n=0;n<window.attackPlan.targetPool.length;n++){const e=window.attackPlan.targetPool[n];for(let a=0;a<window.autoAssign.assignTypes.length;a++){const i=window.autoAssign.assignTypes[a];if(0==i.filtered.length)continue;let l=parseInt($(`#assigner-row-${e.village.id} .ar-${i.id} .ass-inp`).val().toString());for(let a=0;a<l;a++){let a=-1,l=999999;if(i.filtered.forEach(((n,i)=>{let o=(0,t.coordDistance)(n,e.village);o<l&&(a=i,l=o)})),a>-1){let e=window.attackPlan.launchPool.findIndex((n=>n.id==i.filtered[a].id));window.addLauncher(n,e,i.template.units,"attack",i.arrival,""),i.filtered.splice(a,1)}}}}}();break;case"3":!function(){for(let n=0;n<window.attackPlan.targetPool.length;n++){const e=window.attackPlan.targetPool[n];for(let a=0;a<window.autoAssign.assignTypes.length;a++){const t=window.autoAssign.assignTypes[a];if(0==t.filtered.length)continue;let i=parseInt($(`#assigner-row-${e.village.id} .ar-${t.id} .ass-inp`).val().toString());for(let e=0;e<i;e++){let e=window.attackPlan.launchPool.findIndex((n=>n.id==t.filtered[0].id));window.addLauncher(n,e,t.template.units,"attack",t.arrival,""),t.filtered.splice(0,1)}}}}();break;case"4":!function(){let n=[];for(let e=0;e<window.autoAssign.assignTypes.length;e++){const a=window.autoAssign.assignTypes[e];if(0!=a.filtered.length)for(let i=0;i<a.filtered.length;i++){const l=a.filtered[i];let o=-1,s=999999;for(let a=0;a<window.attackPlan.targetPool.length;a++){const i=window.attackPlan.targetPool[a];let r=n.findIndex((n=>n.id==i.village.id)),d=0;for(let n=0;n<e+1;n++)d+=parseInt($(`#assigner-row-${i.village.id} .ar-${window.autoAssign.assignTypes[n].id} .ass-inp`).val().toString());if(console.log(d),r>-1&&n[r].cnt>=d)continue;let c=(0,t.coordDistance)(l,i.village);c<s&&(o=a,s=c)}if(o>-1){let e=n.findIndex((n=>n.id==window.attackPlan.targetPool[o].village.id));-1==e?n.push({id:window.attackPlan.targetPool[o].village.id,cnt:1}):n[e].cnt++;let t=window.attackPlan.launchPool.findIndex((n=>n.id==a.filtered[i].id));window.addLauncher(o,t,a.template.units,"attack",a.arrival,""),a.filtered.splice(i,1)}}}}()}window.targetPoolQuery.resetAll(),window.launchVillagesQuery.resetAll(),window.closeModal(),window.DB.savePlan(window.attackPlan)}),200)):window.UI.ErrorMessage((0,i.Lang)("noAttackAssigned")):window.UI.ErrorMessage((0,i.Lang)("noAlgSelected"))},checkAll:()=>{$(".assigner-target-villages").find("input[type=checkbox]").get().forEach((n=>{$(n).prop("checked",$("#assigner-main-checkbox").prop("checked"))}))},updateCount:n=>{let e=0;$(`.assigner-target-villages .ar-${n} .ass-inp`).get().forEach((n=>{let a=$(n).val();e+=parseInt(a.toString().split("x")[0])})),console.log(n,e);let a=window.autoAssign.assignTypes.findIndex((e=>e.id==n.toString()));window.autoAssign.assignTypes[a].required=e,$(`.assigner-counter .ar-${n} .cnt-actual`).text(e)}}},"./src/view/calculatedAttackModal.ts":(n,e,a)=>{a.r(e),a.d(e,{calculatedAttackModal:()=>l,generateLaunchText:()=>o});var t=a("./src/core/Api.ts"),i=a("./src/core/Language.ts");const l=()=>{const n=["spear","sword","axe","archer","spy","light","marcher","heavy","ram","catapult","knight","snob"];return setTimeout((()=>{!function(){let e=[];window.attackPlan.targetPool.forEach((a=>{let i=window.attackPlan.boosters.findIndex((n=>n.playerId==a.village.owner));a.launchers.forEach((l=>{let o=1;i>-1&&(a.booster=window.attackPlan.boosters[i].value),l.isAttack||(o+=a.booster/100);let r=60*l.unitSpeed.value,d=new Date(l.arrival),c=new Date(d.valueOf()-Math.round(1e3*r/window.gameConfig.speed/(window.gameConfig.unit_speed*o)*(0,t.coordDistance)(l.village,a.village))),g=new Intl.DateTimeFormat("hu-hu",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).format(c),p="",u="";Object.keys(window.unitConfig).forEach(((e,a)=>{l.village.unitsContain.hasOwnProperty(e)&&l.village.unitsContain[e]>0&&(p+=`&${e}=${l.village.unitsContain[e]}`,u+=`${n.indexOf(e).toString(16)}:${l.village.unitsContain[e].toString(16)},`)})),e.push({launchDate:g,launchLink:`https://${window.location.host}/game.php?village=${l.village.id}&screen=place&target=${a.village.id}${p}`,qrdata:(l.isAttack?1:0)+","+`${n.indexOf(l.unitSpeed.key).toString(16)},`+`${new Date(g).getTime().toString(16)},`+`${l.village.id.toString(16)},`+`${a.village.id.toString(16)},`+`${s(a.village.name)},`+`${u.slice(0,-1)};`,unitSpeed:l.unitSpeed,villageFrom:l.village,villageTo:a.village,note:l.notes,isAttack:l.isAttack})}))})),e.sort(((n,e)=>n.launchDate>e.launchDate?1:-1));let{bbcode:a,html:i,QRhtml:l}=o(e);console.log(l),$(".bb-field").html(a),$(".inApp-field").html(i),$(".qr-field").html(l),$("#dialog-loading").hide(),$(".modal-input-inline").show()}()}),2e3),`<div id="dialog-loading"><img style="height:25px" src="https://dshu.innogamescdn.com/asset/6389cdba/graphic/loading.gif"><span style="padding:5px">${(0,i.Lang)("calculaing")}...</span></div><div class="modal-input-inline" style="display:none"><label for="bb">${(0,i.Lang)("bbCode")}:</label><input onclick="window.changeDisplayType()" type="radio" id="bb" value="bb" name="showType" ><label for="inapp">In-app:</label><input onclick="window.changeDisplayType()" type="radio" id="inapp" value="inapp" name="showType" checked><label for="inapp">mobile-app:</label><input onclick="window.changeDisplayType()" type="radio" id="mobile" value="mobile" name="showType" ><div class="bb-field" style="display:none;max-height:600px; overflow-y: auto;"></div><div class="inApp-field" style="max-height:600px; overflow-y: auto;"></div><div class="qr-field" style="display:none;max-height:650px; overflow-y: auto;"></div></div>`};function o(n){let e=0,a=1,l=`<textarea style="resize:none;overflow: hidden;height:100px;width:400px;">[table][**] [||][building]barracks[/building][||]${(0,i.Lang)("launch")}[||]${(0,i.Lang)("target")}[||]${(0,i.Lang)("command")}[||]${(0,i.Lang)("note")}[/**]`,o="",r="",d=1,c=`twla://${d.toString(16)}:-pageCnt-,${window.location.hostname},${s(window.attackPlan.name)}/`,g=`<table class="vis"><tr><th></th><th></th><th>${(0,i.Lang)("launch")}</th><th>${(0,i.Lang)("target")}</th><th>${(0,i.Lang)("command")}</th><th>${(0,i.Lang)("note")}</th></tr>`;for(let s=0;s<n.length;s++){let p=`[*]#${s+1}[|][unit]${n[s].unitSpeed.key}[/unit][|][b]${n[s].launchDate}[/b][|] ${n[s].villageTo.coord.text} [|][url=${n[s].launchLink}]${n[s].isAttack?(0,i.Lang)("attack"):(0,i.Lang)("support")}[/url][|]${n[s].note}`;e+p.length+23>=6e4&&(e=0,a++,o+="[/table]</textarea><br>"),0==e&&(o+=`${a}.${(0,i.Lang)("page")}<br>`+l,e+=l.length),c.length+n[s].qrdata.length>1e3&&(r+=`<h3>${d}.Oldal</h3><div><p><img src="https://api.qrserver.com/v1/create-qr-code/?size=600x600&data=${c}"></p></div>`,d++,c=`twla://${d.toString(16)}/`),c+=n[s].qrdata,s==n.length-1&&(r+=`<h3>${d}.Oldal</h3><div><p><img src="https://api.qrserver.com/v1/create-qr-code/?size=600x600&data=${c}"></p></div>`),o+=p,e+=p.length,g+=`<tr><td>#${s+1}</td><td><img src="/graphic/unit/unit_${n[s].unitSpeed.key}.png"></td><td>${n[s].launchDate}</td><td><a target="_blank" href="/game.php?village=${t.game.village.id}&screen=info_village&id=${n[s].villageTo.id}">${n[s].villageTo.name} (${n[s].villageTo.coord.text}) </a></td><td><a href="${n[s].launchLink}">${n[s].isAttack?(0,i.Lang)("attack"):(0,i.Lang)("support")}</a></td><td>${n[s].note}</td></tr>`}return g+="</table>",r=r.replace("-pageCnt-",d.toString(16)),{bbcode:o,html:g,QRhtml:r}}function s(n){return[";","/",",",":"].forEach((e=>{n=n.replaceAll(e," ")})),n}window.changeDisplayType=()=>{let n=$("input[name=showType]:checked").val();switch($(".inApp-field").hide(),$(".bb-field").hide(),$(".qr-field").hide(),n){case"bb":$(".bb-field").show();break;case"inapp":$(".inApp-field").show();break;case"mobile":$(".qr-field").show(),$(".qr-field").accordion()}}},"./src/view/confirmCalculateAttackModal.ts":(n,e,a)=>{a.r(e),a.d(e,{confirmCalculateAttackModal:()=>i});var t=a("./src/core/Language.ts");const i=()=>`<div class="modal-input-inline"><h2>${(0,t.Lang)("calculateQuestion")}</h2></div><div class="modal-input-inline"><button class="btn" onclick="window.confirmCalculateAttack()">${(0,t.Lang)("yes")}</button> <button class="btn" onclick="window.closeModal()">${(0,t.Lang)("cancel")}</button></div>`},"./src/view/confirmRemoveModal.ts":(n,e,a)=>{a.r(e),a.d(e,{confirmRemoveModal:()=>i});var t=a("./src/core/Language.ts");const i=(n,e)=>`<div class="modal-input-inline"><h2>${(0,t.Lang)("removeQuestion")}</h2></div><div class="modal-input-inline"><button class="btn" onclick="window.targetItem.confirmRemoveTargetLauncherItem(${n},${e})">${(0,t.Lang)("yes")}</button> <button class="btn" onclick="window.closeModal()">${(0,t.Lang)("cancel")}</button></div>`},"./src/view/confirmRemoveTargetModal.ts":(n,e,a)=>{a.r(e),a.d(e,{confirmRemoveTargetModal:()=>i});var t=a("./src/core/Language.ts");const i=n=>`<div class="modal-input-inline"><h2>${(0,t.Lang)("removeQuestion")}</h2></div><div class="modal-input-inline"><button class="btn" onclick="window.targetItem.confirmRemoveTargetItem(${n})">${(0,t.Lang)("yes")}</button> <button class="btn" onclick="window.closeModal()">${(0,t.Lang)("cancel")}</button></div>`},"./src/view/confirmResetAssignmentsModal.ts":(n,e,a)=>{a.r(e),a.d(e,{confirmResetAssignmentsModal:()=>l});var t=a("./src/core/Api.ts"),i=a("./src/core/Language.ts");const l=()=>`<div class="modal-input-inline"><h2>${(0,i.Lang)("resetAttackQuestion")}</h2></div><div class="modal-input-inline"><button class="btn" onclick="window.finalResetAssignments()">${(0,i.Lang)("yes")}</button></div>`;window.finalResetAssignments=()=>{window.attackPlan.targetPool.forEach((n=>{n.isSelected=!1,n.isOpen=!1,n.launchers.forEach((n=>{let e=window.attackPlan.launchPool.findIndex((e=>e.id==n.village.id));-1==e?window.attackPlan.launchPool.push({...n.village}):[window.attackPlan.launchPool[e].unitsContain,n.village.unitsContain]=(0,t.TroopTransaction)(window.attackPlan.launchPool[e].unitsContain,n.village.unitsContain,n.village.unitsContain)})),n.launchers=[]})),window.closeModal(),window.launchVillagesQuery.resetAll(),window.targetPoolQuery.resetAll(),window.DB.savePlan(window.attackPlan)}},"./src/view/editArrivalsModal.ts":(n,e,a)=>{a.r(e),a.d(e,{editArrivalsModal:()=>i});var t=a("./src/core/Language.ts");const i=n=>(window.editArrivalsModal.arrivalsRef=n,`<div class="modal-input-group"><label for="">${(0,t.Lang)("arrivals")}:</label><select id="plan_arrivals_select" size="5">${n.map((n=>`<option value="${n}">${n}</option>`)).join("")}</select><input id="plan_arrivals_input" type="datetime-local" type="text" step="1"/></div><div class="modal-input-inline"><button class="btn" onclick="editArrivalsModal.addArrival()" >${(0,t.Lang)("add")}</button><button class="btn" onclick="editArrivalsModal.removeArrival()">${(0,t.Lang)("remove")}</button></div>`);window.editArrivalsModal={addArrival:()=>{let n=$("#plan_arrivals_input").val().toString().replace("T"," ");if(""==n)return;window.editArrivalsModal.arrivalsRef.includes(n)||window.editArrivalsModal.arrivalsRef.push(n),window.editArrivalsModal.arrivalsRef.sort(((n,e)=>n>e?1:-1));let e="";window.editArrivalsModal.arrivalsRef.forEach((n=>{e+=`<option value="${n}">${n}</option>`})),$("#plan_arrivals_select").html(e),1==$(".mainWindow").get().length?window.DB.savePlan(window.attackPlan):window.launchDialog.stepCheck()},removeArrival:()=>{let n=$("#plan_arrivals_select").val().toString().replace("T"," ");if(""==n)return;let e=window.editArrivalsModal.arrivalsRef.findIndex((e=>e==n));e>-1&&window.editArrivalsModal.arrivalsRef.splice(e,1);let a="";window.editArrivalsModal.arrivalsRef.forEach((n=>{a+=`<option value="${n}">${n}</option>`})),$("#plan_arrivals_select").html(a),1==$(".mainWindow").get().length?window.DB.savePlan(window.attackPlan):window.launchDialog.stepCheck()}}},"./src/view/editLaunchVillagesModal.ts":(n,e,a)=>{a.r(e),a.d(e,{editLaunchVillagesModal:()=>i});var t=a("./src/core/Language.ts");const i=n=>`<label for="">${(0,t.Lang)("launchers")}:</label><br><select id="plan_launcher_list" size="5"></select><select id="plan_launcher_select" style="font-size:16px" >${window.Groups.map((n=>`<option value="${n.id}">${n.name}</option>`)).join("")}</select><div><button class="btn" onclick="editLaunchVillagesModal.addGroup()" >${(0,t.Lang)("add")}</button><button class="btn" onclick="editLaunchVillagesModal.removeGroup()" >${(0,t.Lang)("remove")}</button></div>`;window.editLaunchVillagesModal={addGroup:()=>{let n=parseInt($("#plan_launcher_select").val().toString());if(window.launchDialog.groupIDs.findIndex((e=>e.id==n))>-1)return;window.launchDialog.groupIDs.push({id:n,name:$("#plan_launcher_select option:selected").text()});let e="";window.launchDialog.groupIDs.forEach((n=>{e+=`<option value="${n.id}">${n.name}</option>`})),$("#plan_launcher_list").html(e),window.launchDialog.stepCheck()},removeGroup:()=>{let n=parseInt($("#plan_launcher_list").val().toString()),e=window.launchDialog.groupIDs.findIndex((e=>e.id==n));window.launchDialog.groupIDs.splice(e,1);let a="";window.launchDialog.groupIDs.forEach((n=>{a+=`<option value="${n.id}">${n.name}</option>`})),$("#plan_launcher_list").html(a),window.launchDialog.stepCheck()}}},"./src/view/editPlanNameModal.ts":(n,e,a)=>{a.r(e),a.d(e,{editPlanNameModal:()=>i});var t=a("./src/core/Language.ts");const i=n=>(window.editPlanNameModal.planRef=n,`<label for="plan_name_input" >${(0,t.Lang)("planName")}:</label><br><input maxlength="20" value="${window.editPlanNameModal.planRef.name}" onkeyup="window.editPlanNameModal.saveName()" id="plan_name_input" type="text"/>`);window.editPlanNameModal={saveName:()=>{let n=$("#plan_name_input").val().toString();n=n.substring(0,20).trim(),window.editPlanNameModal.planRef.name=n,$("#open-plan-name").get().length>0&&$("#open-plan-name").text(n),1==$(".mainWindow").get().length?window.DB.savePlan(window.attackPlan):window.launchDialog.stepCheck()}}},"./src/view/editTargetModal.ts":(n,e,a)=>{a.r(e),a.d(e,{editTargetModal:()=>l});var t=a("./src/core/Api.ts"),i=a("./src/core/Language.ts");const l=n=>(window.editTargetModal.targetRef=n,`<div class="modal-input-group"><label for="target-select">${(0,i.Lang)("targets")} (<span id="modal-targets-cnt">${n.length}</span>):</label><select id="target-select" size="5" multiple>${n.map((n=>`<option value="${n.village.id}">${n.village.name} (${n.village.coord.text}) K${n.village.kontinent}</option>`)).join("")}</select></div><div class="modal-input-group"><label for="">${(0,i.Lang)("newTargets")}:</label><br><textarea id="plan_targets" size="10"></textarea></div><div class="modal-input-inline"><button class="btn" onclick="editTargetModal.addTargets()">${(0,i.Lang)("add")}</button><button class="btn" onclick="editTargetModal.removeTargets()">${(0,i.Lang)("remove")}</button></div>`);window.editTargetModal={addTargets:()=>{let n=$("#plan_targets").val().toString();console.log(n);let e=Array.from(n.matchAll(/([0-9]{1,3}).([0-9]{1,3})/g));console.log(e),e.forEach((n=>{let e=n[1]+"|"+n[2],a=window.Villages.find((n=>n.coord.text==e)),t=window.editTargetModal.targetRef.findIndex((n=>n.village.coord.text==e));a&&-1==t&&window.editTargetModal.targetRef.push({booster:0,launchers:[],village:a,isOpen:!1,isSelected:!1})})),$("#plan_targets").val(""),$("#modal-targets-cnt").text(window.editTargetModal.targetRef.length),$("#target-select").html(window.editTargetModal.targetRef.map((n=>`<option value="${n.village.id}">${n.village.name} (${n.village.coord.text}) K${n.village.kontinent}</option>`)).join("")),1==$(".mainWindow").get().length?(window.DB.savePlan(window.attackPlan),window.targetPoolQuery.resetAll()):window.launchDialog.stepCheck()},removeTargets:()=>{$("#target-select").val().toString().split(",").forEach((n=>{let e=window.editTargetModal.targetRef.findIndex((e=>e.village.id==parseInt(n)));1==$(".mainWindow").get().length&&window.editTargetModal.targetRef[e].launchers.forEach((n=>{let e=window.attackPlan.launchPool.findIndex((e=>e.id==n.village.id));-1==e?window.attackPlan.launchPool.push({...n.village}):[window.attackPlan.launchPool[e].unitsContain,n.village.unitsContain]=(0,t.TroopTransaction)(window.attackPlan.launchPool[e].unitsContain,n.village.unitsContain,n.village.unitsContain)})),window.editTargetModal.targetRef.splice(e,1)})),$("#target-select").html(window.editTargetModal.targetRef.map((n=>`<option value="${n.village.id}">${n.village.name} (${n.village.coord.text}) K${n.village.kontinent}</option>`)).join("")),1==$(".mainWindow").get().length&&(window.targetPoolQuery.resetAll(),window.launchVillagesQuery.resetAll())},targetRef:[]}},"./src/view/editTemplatesModal.ts":(n,e,a)=>{a.r(e),a.d(e,{editTemplatesModal:()=>i});var t=a("./src/core/Language.ts");const i=n=>(window.templateModal.templateRef=n,`<style>.template-editor {  margin: 0 auto;display: grid;grid-template-columns: 100px 100px;grid-template-rows: max-content 35px max-content max-content;text-align:center;gap: 10px 0px;grid-auto-flow: row;grid-template-areas:"template-select-box template-select-box""template-buttons template-buttons""template-infantry template-calvary""template-machines template-other";}.template-select-box { grid-area: template-select-box; display:grid; }.template-calvary { grid-area: template-calvary; }.template-machines { grid-area: template-machines; }.template-other { grid-area: template-other; }.template-buttons{ grid-area: template-buttons; }.template-infantry { grid-area: template-infantry; }.template-input-group{margin-top:5px;}\n.template-editor option {font-size: 16px;padding: 2px 5px;text-align: center;}.template-unitsInput {width: 45px;}\n</style><div class="template-editor"><div class="template-select-box"><label for="template_select">${(0,t.Lang)("templates")}:</label><select onclick="templateModal.selectTemplate()" id="template_select" size="5">${n.map((n=>`<option value="${n.name}">${n.name}</option>`))}</select><label for="temp_name">${(0,t.Lang)("name")}:</label><input id="temp_name" type="text" /></div><div class="template-infantry"><div class="template-input-group"><img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_spear.png" ><input id="palnner_unit_input_spear" type="number" tabindex="1" value="0" class="template-unitsInput"><br><input onclick="templateModal.selectAll('spear')" id="max_spear" type="checkbox"> ${(0,t.Lang)("all")}</div><div class="template-input-group"><img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_sword.png" ><input id="palnner_unit_input_sword" type="number" tabindex="1" value="0" class="template-unitsInput"><br><input onclick="templateModal.selectAll('sword')" id="max_sword" type="checkbox"> ${(0,t.Lang)("all")}</div><div class="template-input-group"><img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_axe.png" ><input id="palnner_unit_input_axe" type="number" tabindex="1" value="0" class="template-unitsInput"><br><input onclick="templateModal.selectAll('axe')" id="max_axe" type="checkbox"> ${(0,t.Lang)("all")}</div><div class="template-input-group" ${0==window.gameConfig.game.archer&&'style="display:none;"'} ><img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_archer.png" ><input id="palnner_unit_input_archer" type="number" tabindex="1" value="0" class="template-unitsInput"><br><input onclick="templateModal.selectAll('archer')" id="max_archer" type="checkbox"> ${(0,t.Lang)("all")}</div></div><div class="template-calvary"><div class="template-input-group"><img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_spy.png" ><input id="palnner_unit_input_spy" type="number" tabindex="1" value="0" class="template-unitsInput"><br><input onclick="templateModal.selectAll('spy')" id="max_spy" type="checkbox"> ${(0,t.Lang)("all")}</div><div class="template-input-group"><img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_light.png" ><input id="palnner_unit_input_light" type="number" tabindex="1" value="0" class="template-unitsInput"><br><input onclick="templateModal.selectAll('light')" id="max_light" type="checkbox"> ${(0,t.Lang)("all")}</div><div class="template-input-group" ${0==window.gameConfig.game.archer&&'style="display:none;"'}><img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_marcher.png" ><input id="palnner_unit_input_marcher" type="number" tabindex="1" value="0" class="template-unitsInput"><br><input onclick="templateModal.selectAll('marcher')" id="max_marcher" type="checkbox"> ${(0,t.Lang)("all")}</div><div class="template-input-group"><img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_heavy.png" ><input id="palnner_unit_input_heavy" type="number" tabindex="1" value="0" class="template-unitsInput"><br><input onclick="templateModal.selectAll('heavy')" id="max_heavy" type="checkbox"> ${(0,t.Lang)("all")}</div>    </div><div class="template-machines"><div class="template-input-group"><img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_ram.png" ><input id="palnner_unit_input_ram" type="number" tabindex="1" value="0" class="template-unitsInput"><br><input onclick="templateModal.selectAll('ram')" id="max_ram" type="checkbox"> ${(0,t.Lang)("all")}</div><div class="template-input-group"><img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_catapult.png" ><input id="palnner_unit_input_catapult"  type="number" tabindex="1" value="0" class="template-unitsInput"><br><input onclick="templateModal.selectAll('catapult')" id="max_catapult" type="checkbox"> ${(0,t.Lang)("all")}</div></div><div class="template-other"><div class="template-input-group"><img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_knight.png" ><input id="palnner_unit_input_knight" type="number" tabindex="1" value="0" class="template-unitsInput"><br><input onclick="templateModal.selectAll('knight')" id="max_knight" type="checkbox"> ${(0,t.Lang)("all")}</div><div class="template-input-group"><img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_snob.png" ><input id="palnner_unit_input_snob" type="number" tabindex="1" value="0" class="template-unitsInput"><br><input onclick="templateModal.selectAll('snob')" id="max_snob" type="checkbox"> ${(0,t.Lang)("all")}</div></div><div class="template-buttons"><button class="btn" onclick="templateModal.addTemplate()">${(0,t.Lang)("add")}</button><button class="btn" onclick="templateModal.removeTemplate()">${(0,t.Lang)("remove")}</button></div></div>`);window.templateModal={templateRef:[],addTemplate:()=>{if($("#temp_name").val().toString().length>10)return;let n={name:$("#temp_name").val().toString(),units:{spear:0,sword:0,archer:0,axe:0,spy:0,light:0,marcher:0,heavy:0,ram:0,catapult:0,knight:0,snob:0}};if(Object.keys(n.units).forEach((e=>{let a=parseInt($(`#palnner_unit_input_${e}`).val().toString());console.log($(`#max_${e}`).is(":checked")),$(`#max_${e}`).is(":checked")&&(a=99999),null==a&&(a=0),n.units[e]=a})),console.log(n),""==n.name)return;let e=window.templateModal.templateRef.findIndex((e=>e.name==n.name));e>-1?window.templateModal.templateRef[e]=n:window.templateModal.templateRef.push(n),$("#temp_name").val(""),Object.keys(n.units).forEach((n=>{$(`#palnner_unit_input_${n}`).val("0"),$(`#palnner_unit_input_${n}`).prop("disabled",!1),$(`#max_${n}`).prop("checked",!1)}));let a="";window.templateModal.templateRef.forEach((n=>{a+=`<option value="${n.name}">${n.name}</option>`})),$("#template_select").html(a),1==$(".mainWindow").get().length?window.DB.savePlan(window.attackPlan):window.launchDialog.stepCheck()},removeTemplate:()=>{let n=$("#template_select").val(),e=window.templateModal.templateRef.findIndex((e=>e.name==n));e>-1&&window.templateModal.templateRef.splice(e,1);let a="";window.templateModal.templateRef.forEach((n=>{a+=`<option value="${n.name}">${n.name}</option>`})),$("#template_select").html(a),1==$(".mainWindow").get().length?window.DB.savePlan(window.attackPlan):window.launchDialog.stepCheck()},selectTemplate:()=>{let n=$("#template_select").val(),e=window.templateModal.templateRef.findIndex((e=>e.name==n));if(console.log(e,n,window.templateModal.templateRef),e>-1){let n=window.templateModal.templateRef[e];console.log(n),$("#temp_name").val(n.name),Object.keys(n.units).forEach((e=>{let a=n.units[e];99999==a?($(`#max_${e}`).prop("checked",!0),$(`#palnner_unit_input_${e}`).prop("disabled",!0),$(`#palnner_unit_input_${e}`).val("")):($(`#palnner_unit_input_${e}`).val(a),$(`#palnner_unit_input_${e}`).prop("disabled",!1),$(`#max_${e}`).prop("checked",!1))}))}},selectAll:n=>{$(`#max_${n}`).prop("checked")?$(`#palnner_unit_input_${n}`).val(""):$(`#palnner_unit_input_${n}`).val("0"),$(`#palnner_unit_input_${n}`).prop("disabled",$(`#max_${n}`).prop("checked"))}}},"./src/view/language/en.ts":(n,e,a)=>{a.r(e),a.d(e,{en:()=>t});const t={plans:"Plans",loadPlan:"Load plan",removePlan:"Remove plan",newPlan:"New plan",cancel:"Cancel",next:"Next",loading:"Loading...",createPlan:"Create plan",PlanSuccessfullyCreated:"Plan successfully created!",attack:"Attack",support:"Strengthen",template:"Template",templates:"Templates",allUnit:"All units",arrival:"Arrival",arrivals:"Arrivals",notSelected:"---Not selected---",noNote:"---No note---",add:"Add",note:"Note",noTargetSelected:"No targets selected",noLauncherSelected:"No launchers selected",remove:"Remove",boosterPct:"Booster in percent",yes:"Yes",date:"Date",qntt:"Quantity",village:"Village",even:"Even distribution",oneByOne:"One by one",oneByOneClosest:"One by one closest",closestToTarget:"Closest to target",assigningAttacks:"Assigning attacks",startAssignment:"Start assignment",noAlgSelected:"The distribution algorithm is not selected!",noAttackAssigned:"No attack assigned!",bbCode:"BB Code",calculaing:"Calculating",calculateAttack:"Calculate attack",launch:"Launch",target:"Target",targets:"Targets",command:"Command",calculateQuestion:"Are you sure you want to calculate?",removeQuestion:"Are you sure you want to remove?",resetAttackQuestion:"Are you sure you want to reset all attacks?",launchers:"Launching village",planName:"Plan name",newTargets:"New targets",all:"All",name:"Name",editTargets:"Edit targets",editArrivals:"Edit arrivals",editTemplates:"Edit templates",editPalyerBoosters:"Booster boosters",autoAssigner:"Automatic assignment",resetAssigments:"Reset assignments",size:"Size",reset:"Reset",addAtatck:"Add attack",noLauncherSel:"No launcher village(s) selected!",noTargetSel:"No target selected!",close:"Close",renamePlan:"Rename plan",editTargetsText:"Edit targets",editArrivalsText:"Edit arrivals",editTemplatesText:"Edit templates",editBoostersText:"Edit boosters",attackPlan:"Attack Plan",removeTarget:"Remove target",removeAttack:"Remove attack",addVillageBoost:"Add booster to village",removeVillageBoost:"Remove booster from village",options:"Settings",rename:"Rename",launchVillages:"Starting villages",page:"Page",search:"Search",PlanNotSelected:"No plans have been selected!",needPremiumFeature:"A premium account is required to run the script!"}},"./src/view/language/hu.ts":(n,e,a)=>{a.r(e),a.d(e,{hu:()=>t});const t={plans:"Tervek",loadPlan:"Terv betöltése",removePlan:"Terv törlése",newPlan:"Új terv",cancel:"Mégse",next:"Következő",loading:"Betöltés...",createPlan:"Terv létrehozása",PlanSuccessfullyCreated:"A terv sikeresen létre lett hozva!",attack:"Támadás",support:"Erősítés",template:"Sablon",templates:"Sablonok",allUnit:"Összes egység",arrival:"Érkezés",arrivals:"Érkezések",notSelected:"---Nincs kiválasztva---",noNote:"---Nincs megjegyzés---",add:"Hozzáadás",note:"Megjegyzés",noTargetSelected:"Nincsenek célpontok kiválasztva",noLauncherSelected:"Nincsenek inulófaluk kiválasztva",remove:"Eltávolítás",boosterPct:"Gyorsító százalékban",yes:"Igen",date:"Dátum",qntt:"Mennyiség",village:"Falu",even:"Egyenletes",oneByOne:"Egyenként sorban",oneByOneClosest:"Egyenként legközelebb",closestToTarget:"Célpothoz legközelebb",assigningAttacks:"Támadások kiosztása",startAssignment:"Kiosztás indítása",noAlgSelected:"Nincs az elosztó algoritmus kiválasztva!",noAttackAssigned:"Nincs egy támadás se kiosztva!",bbCode:"BB kód",calculaing:"Számolás",calculateAttack:"Támadás kiszámítása",launch:"Indítás",target:"Célpont",targets:"Célpontok",command:"Parancs",calculateQuestion:"Biztosan szeretnéd kiszámítani?",removeQuestion:"Biztosan szeretnéd eltávolítani?",resetAttackQuestion:"Biztosan szeretnéd visszaállítani az összes támadást?",launchers:"Iduló faluk",planName:"Terv neve",newTargets:"Új célpontok",all:"Összes",name:"Név",editTargets:"Célpontok szerkesztése",editArrivals:"Érkezések szerkesztése",editTemplates:"Sablonok szerkesztése",editPalyerBoosters:"Erősítés gyorsítók",autoAssigner:"Automata hozzárrendelés",resetAssigments:"Kiosztások visszaállítása",size:"Méret",reset:"Vissza áll.",addAtatck:"Támadás hozzáadása",noLauncherSel:"Nincs indítófalu(k) kiválasztva!",noTargetSel:"Nincs célpont kiválasztva!",close:"Bezár",renamePlan:"Terv átnevezése",editTargetsText:"Célpontok szerkesztése",editArrivalsText:"Érkezések szerkesztése",editTemplatesText:"Sablonok szerkesztése",editBoostersText:"Gyorsítók szerkesztése",attackPlan:"Támadási terv",removeTarget:"Célpont eltávolítása",removeAttack:"Támadás eltávolítása",addVillageBoost:"Gyorsító hozzáadása faluhoz",removeVillageBoost:"Gyorsító eltávolítása faluról",options:"Beállítások",rename:"Átnevez",launchVillages:"Induló faluk",page:"Oldal",search:"Keresés",PlanNotSelected:"Nincs egy terv se kiválaszva!",needPremiumFeature:"A script futtatásához prémium fiók szükséges!"}},"./src/view/launchDialog.ts":(n,e,a)=>{a.r(e),a.d(e,{launchDialog:()=>g});var t=a("./src/core/Api.ts"),i=a("./src/view/editArrivalsModal.ts"),l=a("./src/view/editLaunchVillagesModal.ts"),o=a("./src/view/editPlanNameModal.ts"),s=a("./src/view/editTargetModal.ts"),r=a("./src/view/editTemplatesModal.ts"),d=a("./src/view/mainWindow.ts"),c=a("./src/core/Language.ts");const g=()=>`<style>.launch-dialog{display:grid;text-align:center;}.launch-dialog option {font-size:16px;padding:2px 5px;text-align:center;}\n.launch-dialog button{margin: 10px auto;width: max-content;}\n.launch-dialog-selector{display:grid;}\n.new-plan{display:none;}\n.steps{width:100%;display:inline-flex;justify-content: space-evenly;width: 100%;padding: 10px 0;}\n.step{display:grid;}\n.circle{border-radius:50%;background: linear-gradient(to bottom, #947a62 0%,#7b5c3d 22%,#6c4824 30%,#6c4824 100%);color:white;padding: 4px 10px;font-size: 20px;cursor:pointer;z-index:2;}\n.inactive{background: linear-gradient(to bottom, #b1a397 0%, #645d56 22%, #635f5a 30%, #6c6763 100%) !important}\n.modal-input-group{display:inline-grid;text-align:center;border-bottom: solid 1px #603000;padding: 5px 0;}\n.modal-input-inline{display:block;text-align:center;border-bottom: solid 1px #603000;padding: 5px 0;}\n.modal-input-group label{margin-bottom:10px;}\n.modal-input-group input{margin-bottom:10px;}\n.modal-input-group textarea{margin-bottom:10px;}\n.modal-input-group button{margin-bottom:10px;}\n.modal-input-group input{text-align:center;font-size: 14px;}\n.modal-input-group select{text-align:center;font-size: 14px;margin-bottom:10px;}.progress-field{width:88%; position:absolute;height: 5px;background-color: black;margin-top: 13px;z-index:1;background: linear-gradient(to bottom, #b1a397 0%, #645d56 22%, #635f5a 30%, #6c6763 100%);}#progress-bar{height:100%;background: linear-gradient(to bottom, #947a62 0%,#7b5c3d 22%,#6c4824 30%,#6c4824 100%);z-index:1;}.confirm-remove button{margin:0 5px;}</style><div id="dialog-loading" style="display: none;justify-content: center;width: 100%;"><img style="height:25px" src="https://dshu.innogamescdn.com/asset/6389cdba/graphic/loading.gif"><span style="padding:5px">${(0,c.Lang)("loading")}</span></div><div class="launch-dialog"><div><h1>TW Attack Planner</h1></div><div class="launch-dialog-selector"><h3>${(0,c.Lang)("plans")}:</h3><select id="launchDialogSelect" size="5" onDblClick="launchDialog.loadPlan()">${window.Plans.map((n=>`<option value="${n.id}">${n.name}</option>`)).join("")}</select><button onclick="launchDialog.loadPlan()" class="btn">${(0,c.Lang)("loadPlan")}</button><button id="removePlan" onclick="launchDialog.confirmRemovePlan()" class="btn">${(0,c.Lang)("removePlan")}</button><div class="confirm-remove" style="display:none;"><button onclick="launchDialog.removePlan()" class="btn">${(0,c.Lang)("remove")}</button><button onclick="launchDialog.cancelRemovePlan()" class="btn">${(0,c.Lang)("cancel")}</button></div><button onclick="launchDialog.newplan()" class="btn">+ ${(0,c.Lang)("newPlan")}</button></div>\n<div class="new-plan"><div class="steps"><div class="progress-field"><div id="progress-bar" style="width:0%"></div></div><div id="c1" onclick="launchDialog.goToStep(1)" class="circle">1</div><div id="c2" class="circle inactive">2</div><div id="c3" class="circle inactive">3</div><div id="c4" class="circle inactive">4</div><div id="c5" class="circle inactive">5</div></div><div class="step-1 step"></div><div class="step-2 step" style="display:none;"></div><div class="step-3 step" style="display:none;"></div><div class="step-4 step" style="display:none;"></div><div class="step-5 step" style="display:none;"></div><button id="nextBtn" onclick="launchDialog.goNext(2)" class="btn" disabled>${(0,c.Lang)("next")}</button><button style="display:none;" id="createPlan" onclick="launchDialog.createPlan()" class="btn" disabled>${(0,c.Lang)("createPlan")}</button><button onclick="launchDialog.cancelNewPlan()" class="btn">${(0,c.Lang)("cancel")}</button></div></div>`;window.launchDialog={groupIDs:[],currentStep:0,stepCheck:()=>{if(0==$("#dialog-loading").get().length)return;let n=window.launchDialog.currentStep;switch(window.launchDialog.currentStep){case 0:if(!(window.launchDialog.plan.name.length>3&&-1==window.Plans.findIndex((n=>n.name==window.launchDialog.plan.name))))break;window.launchDialog.currentStep++;case 1:if(!(window.launchDialog.plan.targetPool.length>0))break;window.launchDialog.currentStep++;case 2:if(!(window.launchDialog.groupIDs.length>0))break;window.launchDialog.currentStep++;case 3:if(!(window.launchDialog.plan.arrivals.length>0))break;window.launchDialog.currentStep++;case 4:if(!(window.launchDialog.plan.templates.length>0))break;window.launchDialog.currentStep++}n<window.launchDialog.currentStep&&$("#nextBtn").prop("disabled",!1),5==window.launchDialog.currentStep&&$("#createPlan").prop("disabled",!1)},goToStep:n=>{$(".step-1").hide(),$(".step-2").hide(),$(".step-3").hide(),$(".step-4").hide(),$(".step-5").hide(),$(".step-"+n).show(),n<5?($("#nextBtn").attr("onclick","launchDialog.goNext("+(n+1)+")"),$("#createPlan").hide(),$("#nextBtn").show()):($("#createPlan").show(),$("#nextBtn").hide()),window.launchDialog.stepCheck()},goNext:n=>{$(".step-1").hide(),$(".step-2").hide(),$(".step-3").hide(),$(".step-4").hide(),$(".step-5").hide(),$("#c"+n).attr("onclick","launchDialog.goToStep("+n+")"),n>4?($(".step-5").show(),$("#nextBtn").hide(),$("#createPlan").show(),$("#c"+n).removeClass("inactive"),$("#progress-bar").css("width",25*(n-1)+"%")):($("#nextBtn").prop("disabled",!0),$(".step-"+n).show(),$("#c"+n).removeClass("inactive"),$("#progress-bar").css("width",25*(n-1)+"%"),n++,$("#nextBtn").attr("onclick","launchDialog.goNext("+n+")"))},newplan:()=>{$(".new-plan").show(),$(".launch-dialog-selector").hide(),window.launchDialog.currentStep=0,window.launchDialog.plan={arrivals:[],boosters:[],launchPool:[],id:(new Date).getTime().toString(),name:"",targetPool:[],templates:[]},$(".step-1").html((0,o.editPlanNameModal)(window.launchDialog.plan)),$(".step-2").html((0,s.editTargetModal)(window.launchDialog.plan.targetPool)),$(".step-3").html((0,l.editLaunchVillagesModal)(window.launchDialog.plan.launchPool)),$(".step-4").html((0,i.editArrivalsModal)(window.launchDialog.plan.arrivals)),$(".step-5").html((0,r.editTemplatesModal)(window.launchDialog.plan.templates))},cancelNewPlan:()=>{$(".step-1").show(),$(".step-2").hide(),$(".step-3").hide(),$(".step-4").hide(),$(".step-5").hide(),$("#nextBtn").attr("onclick","launchDialog.goNext(2)"),$(".new-plan").hide(),$(".launch-dialog-selector").show(),$("#c2").addClass("inactive"),$("#c3").addClass("inactive"),$("#c4").addClass("inactive"),$("#c5").addClass("inactive"),$("#createPlan").hide(),$("#nextBtn").show(),$("#template_name").val(""),$("#c2").attr("onclick",""),$("#c3").attr("onclick",""),$("#c4").attr("onclick",""),$("#c5").attr("onclick",""),$("#plan_arrivals_select").html(""),$("#plan_targets").val(""),$("#template_select").html(""),$("#temp_name").val(""),window.launchDialog.groupIDs=[],$("#plan_launcher_list").html("")},createPlan:async()=>{$("#dialog-loading").css("display","inline-flex"),$(".launch-dialog").hide(),setTimeout((async()=>{window.attackPlan=window.launchDialog.plan,window.attackPlan.launchPool=await(0,t.loadPages)(window.launchDialog.groupIDs.map((n=>n.id))),await window.DB.savePlan(window.attackPlan),window.UI.SuccessMessage((0,c.Lang)("PlanSuccessfullyCreated")),setTimeout((()=>{window.Dialog.close("launchDialog"),window.Dialog.show("PlannerMainWindow",(0,d.mainWindow)()),$(".popup_box_container").append('<div style="position: fixed;width: 100%;height: 100%;top:0;left:0;z-index:12001"></div>')}),1e3)}),1e3)},loadPlan:()=>{if(null==$("#launchDialogSelect").val())return void window.UI.ErrorMessage((0,c.Lang)("PlanNotSelected"));let n=$("#launchDialogSelect").val().toString(),e=window.Plans.findIndex((e=>e.id==n));-1!=e&&($("#dialog-loading").css("display","inline-flex"),$(".launch-dialog").hide(),setTimeout((()=>{window.Dialog.close("launchDialog"),window.attackPlan=window.Plans[e],window.Dialog.show("PlannerMainWindow",(0,d.mainWindow)()),$(".popup_box_container").append('<div style="position: fixed;width: 100%;height: 100%;top:0;left:0;z-index:12001"></div>')}),1e3))},removePlan:async()=>{if(null==$("#launchDialogSelect").val())return void window.UI.ErrorMessage((0,c.Lang)("PlanNotSelected"));let n=$("#launchDialogSelect").val().toString();window.DB.removePlan(n);let e=await window.DB.loadPlans();$("#launchDialogSelect").html(`${e.map((n=>`<option value="${n.id}">${n.name}</option>`))}`),$(".confirm-remove").hide(),$("#removePlan").show()},confirmRemovePlan:()=>{null!=$("#launchDialogSelect").val()?($(".confirm-remove").show(),$("#removePlan").hide()):window.UI.ErrorMessage((0,c.Lang)("PlanNotSelected"))},cancelRemovePlan:()=>{$(".confirm-remove").hide(),$("#removePlan").show()},plan:void 0}},"./src/view/launchItem.ts":(n,e,a)=>{a.r(e),a.d(e,{launchItem:()=>i});var t=a("./src/core/Api.ts");const i=n=>{n.popSize=(0,t.calcUnitPop)(n.unitsContain);let e="small";n.popSize>1e3&&n.popSize<=5e3?e="medium":n.popSize>5e3&&(e="large");let a=Object.keys(n.unitsContain);return`<div class="launch-item" id="${n.id}"><div class="name-field"><a href="/game.php?village=${t.game.village.id}&screen=info_village&id=${n.id}" target="_blank">${n.name} (${n.coord.text}) K${n.kontinent}</a></div><div class="check-field"><input type="checkbox" value="${n.id}"><img src="https://dshu.innogamescdn.com/asset/72737c96/graphic/command/attack_${e}.png"></div>${a.map((e=>{if(0!=window.gameConfig.game.archer||"archer"!=e&&"marcher"!=e)return`<div class="${e}-field ${0==n.unitsContain[e]?"hidden":""}">${n.unitsContain[e]}</div>`})).join("")}</div>`}},"./src/view/mainWindow.ts":(n,e,a)=>{a.r(e),a.d(e,{mainWindow:()=>v});var t=a("./src/core/Language.ts"),i=a("./src/core/Query.ts"),l=a("./src/view/addAttackModal.ts"),o=a("./src/view/addPlayerSpeedModal.ts"),s=a("./src/view/autoAssignModal.ts"),r=a("./src/view/calculatedAttackModal.ts"),d=a("./src/view/confirmCalculateAttackModal.ts"),c=a("./src/view/confirmResetAssignmentsModal.ts"),g=a("./src/view/editArrivalsModal.ts"),p=a("./src/view/editPlanNameModal.ts"),u=a("./src/view/editTargetModal.ts"),h=a("./src/view/editTemplatesModal.ts"),m=a("./src/view/launchItem.ts"),w=a("./src/view/targetItem.ts");const v=()=>`<style>::-webkit-scrollbar {width: 5px;}/* Track */::-webkit-scrollbar-track {box-shadow: inset 0 0 5px grey;border-radius: 10px;}/* Handle */::-webkit-scrollbar-thumb {background: grey;border-radius: 10px;}\n.mainWindow{width: 100%;height:85vh;}.popup_box_container{height:100% !important;}#popup_box_PlannerMainWindow{width: 95vw !important;}html{overflow: hidden !important;}.container {height: calc(100% - 10px);border: solid 2px #6c4824;border-radius:20px;display: grid;grid-template-columns: 260px 1.3fr 1.3fr;grid-template-rows: 30px 3fr [option] 0.1fr;gap: 0px 0px;grid-auto-flow: row;}\n.options-title { grid-area: 1 / 1 / 2 / 2; border-top-left-radius: 20px;border-right: solid 2px #6c4824;border-bottom: solid 2px #6c4824;}\n.options-panel {border-right: solid 2px #6c4824;display: table;}\n.target-title { grid-area: 1 / 2 / 2 / 3; border-right: solid 1px #6c4824;border-bottom: solid 2px #6c4824;}\n.target-panel { grid-area: 2 / 2 / 4 / 3; border-right: solid 1px #6c4824;\ndisplay: grid; grid-template-columns: 1fr; grid-template-rows: 30px 1fr; gap: 0px 0px; grid-template-areas: "target-header""target-list";}\n.target-header {grid-area: target-header; }.target-list { grid-area: target-list; overflow-y:auto; }\n.launch-title { grid-area: 1 / 3 / 2 / 4;border-top-right-radius: 20px;border-left: solid 1px #6c4824;border-bottom: solid 2px #6c4824;display: flex;flex-wrap: nowrap;justify-content: space-evenly;align-items: flex-start;align-content: flex-start;flex-direction: row;}\n.launch-panel { grid-area: 2 / 3 / 4 / 4; border-left: solid 1px #6c4824;display: grid; grid-template-columns: 1fr; grid-template-rows: 30px 1fr; gap: 0px 0px; grid-template-areas: "launch-header""launch-list"; }\n.launch-list {overflow-y:scroll;border-bottom-right-radius: 20px;grid-area: launch-list; display: block;}.launch-header { padding-right:5px;background: linear-gradient(to bottom,#e2c07c 0%,#dab874 44%,#c1a264 100%);grid-area: launch-header;display: grid;grid-template-columns:  1fr 1fr 1fr 1fr${1==window.gameConfig.game.archer&&" 1fr"} 1fr 1fr${1==window.gameConfig.game.archer&&" 1fr"} 1fr 1fr 1fr 1fr 1fr; grid-template-rows: 30px;gap: 0px;grid-template-areas: "size-icon spear-icon sword-icon axe-icon${1==window.gameConfig.game.archer&&" archer-icon"} spy-icon light-icon${1==window.gameConfig.game.archer&&" marcher-icon"} heavy-icon ram-icon catapult-icon pala-icon snob-icon"}\n.target-launch-header { background: linear-gradient(to bottom,#e2c07c 0%,#dab874 44%,#c1a264 100%);grid-area: launch-header;display: grid;grid-template-columns:  30px 1fr 1fr 1fr${1==window.gameConfig.game.archer&&" 1fr"} 1fr 1fr${1==window.gameConfig.game.archer?" 1fr":""} 1fr 1fr 1fr 1fr 1fr 30px; grid-template-rows: 30px;gap: 0px;grid-template-areas: "size-icon spear-icon sword-icon axe-icon${1==window.gameConfig.game.archer&&" archer-icon"} spy-icon light-icon${1==window.gameConfig.game.archer&&" marcher-icon"} heavy-icon ram-icon catapult-icon pala-icon snob-icon del-icon"}\n.target-launch-header div {padding: 5px;}\n.target-launch-header img {margin: 0 auto;display: block;}\n\n.credits { grid-area: option / 1 / 4 / 2; border-right: solid 2px #6c4824; padding:10px;}\n.header {background: linear-gradient(to bottom,#e2c07c 0%,#dab874 44%,#c1a264 100%);text-align: center;padding:3px;}\n.launch-header div{padding: 5px;}.launch-header img{margin: 0 auto;display: block;cursor: pointer;}\n.size-icon { grid-area: size-icon; }.spear-icon { grid-area: spear-icon; }.sword-icon { grid-area: sword-icon; }.axe-icon { grid-area: axe-icon; }.archer-icon { grid-area: archer-icon; }.spy-icon { grid-area: spy-icon; }.light-icon { grid-area: light-icon; }.marcher-icon { grid-area: marcher-icon; }.heavy-icon { grid-area: heavy-icon; }.ram-icon { grid-area: ram-icon; }.catapult-icon { grid-area: catapult-icon; }.pala-icon { grid-area: pala-icon; }.snob-icon { grid-area: snob-icon; }.del-icon { grid-area: del-icon; }\n.option-item{width:100%;margin: 15px 0;}.option-item button{height: 30px;margin: 0 auto;display: block;min-width: 85%;}.option-item h2{text-align:center;}\n.header-count{margin-left:10px;display: inline;}\n.header-count span{font-weight: bold;padding: 0 2px;}\n.btn-add-attack{font-size: 30px !important;padding: 0;line-height: 20px;}</style><style>.targetsLauncher-item{height: max-content;border-top: solid 1px #6c4824;border-bottom: solid 1px #6c4824;margin-top:3px;text-align:center;display: grid; grid-template-columns:  30px 1fr 1fr 1fr${1==window.gameConfig.game.archer&&" 1fr"} 1fr 1fr${1==window.gameConfig.game.archer&&" 1fr"} 1fr 1fr 1fr 1fr 1fr 30px; grid-template-rows: 35px 30px ;gap: 0px 0px; grid-template-areas: "size-field name-field name-field name-field${1==window.gameConfig.game.archer&&" name-field"} name-field name-field${1==window.gameConfig.game.archer&&" name-field"} name-field name-field name-field name-field name-field del-field""size-field spear-field sword-field axe-field${1==window.gameConfig.game.archer&&" archer-field"} spy-field light-field${1==window.gameConfig.game.archer&&" marcher-field"} heavy-field ram-field catapult-field knight-field snob-field del-field";}.del-field{ grid-area: del-field; padding: 20px 5px;background-color:#fff5dc;border-left: 1px solid #6c4824;}.size-field{ grid-area: size-field; padding: 5px 8px;background-color:#fff5dc;border-right: 1px solid #6c4824;}\n.launch-item{height: max-content;border-top: solid 1px #6c4824;border-bottom: solid 1px #6c4824;margin-top:3px;text-align:center;display: grid; grid-template-columns:  1fr 1fr 1fr 1fr${1==window.gameConfig.game.archer&&" 1fr"} 1fr 1fr${1==window.gameConfig.game.archer&&" 1fr"} 1fr 1fr 1fr 1fr 1fr;grid-template-rows: 30px 30px ;gap: 0px 0px; grid-template-areas:"check-field name-field name-field name-field${1==window.gameConfig.game.archer&&" name-field"} name-field name-field${1==window.gameConfig.game.archer&&" name-field"} name-field name-field name-field name-field name-field""check-field spear-field sword-field axe-field${1==window.gameConfig.game.archer&&" archer-field"} spy-field light-field${1==window.gameConfig.game.archer&&" marcher-field"}  heavy-field ram-field catapult-field knight-field snob-field";}\n.check-field input{height:16px;width:16px;float:left;}\n.check-field img{height: 16px;float:right;padding-right:3px;}\n.size-field img{height: 16px;float:right;padding: 15px 0;}\n.del-field .remove-target-btn{margin: 0 !important;}\n.check-field { grid-area: check-field; padding: 20px 0; background-color:#fff5dc; border-right:1px solid #6c4824}.spear-field { grid-area: spear-field; padding: 5px 0;background-color:#fff5dc}.sword-field { grid-area: sword-field; padding: 5px 0;background-color:#fff5dc}.axe-field { grid-area: axe-field; padding: 5px 0;background-color:#fff5dc}.archer-field { grid-area: archer-field; padding: 5px 0;background-color:#fff5dc}.spy-field { grid-area: spy-field; padding: 5px 0;background-color:#fff5dc}.light-field { grid-area: light-field; padding: 5px 0;background-color:#fff5dc}.marcher-field { grid-area: marcher-field; padding: 5px 0;background-color:#fff5dc}.heavy-field { grid-area: heavy-field; padding: 5px 0;background-color:#fff5dc}.ram-field { grid-area: ram-field; padding: 5px 0;background-color:#fff5dc}.catapult-field { grid-area: catapult-field; padding: 5px 0;background-color:#fff5dc}.knight-field { grid-area: knight-field; padding: 5px 0;background-color:#fff5dc}.snob-field { grid-area: snob-field; padding: 5px 0;background-color:#fff5dc}.name-field { display:grid;grid-area: name-field;color: #603000;font-weight: bold;background-color:#ecd8b2;padding: 5px 0;}.target-item{overflow-x:hidden;display: block;width:100%;margin: 5px 0;border-top: solid 1px #6c4824;border-bottom: solid 1px #6c4824;}.target-header{height:35px;width:100%;display: flex;\n\t            justify-content: space-around;background-color: #ecd8b2;cursor: pointer;}\n.target-header div{padding-top: 9px;padding-bottom: 9px;}\n.target-village-name{color: #603000;font-weight: bold;}.target-extras{flex-grow: 1;}\n.target-launchers{display:none;width:100%;min-height:20px;background-color: #fff5dc;}\n.remove-target-btn {float: right;z-index: 2;width: 20px;height: 20px;background: url(https://dshu.innogamescdn.com/asset/80b013af/graphic/login_close.png) top left no-repeat;cursor: pointer;background-size: 20px;margin-right: 10px;}.add-village-booster{background: url(https://klanhaboru.hu/graphic/plus.png) top left no-repeat;height: 16px;width: 16px;margin-left: 5px;cursor: pointer;display: inline-block;vertical-align: middle;}\n.indicator{font-size: 16px;padding-left: 5px;padding-right: 5px;}\n.indicator-open{transform: rotate(90deg);}\n.planner-modal {background: transparent url(https://dshu.innogamescdn.com/asset/fd86cac8/graphic/index/contentbg.png) scroll left top repeat;filter: drop-shadow(0 0 0.75rem rgb(88, 88, 88));width: max-content;height: fit-content;max-height: calc(100vh - 120px);border: 2px solid #6c4824;position: absolute;top: 0;bottom: 0;left: 0;right: 0;margin: auto;border-radius: 10px;z-index: 100001;display: grid;align-content: space-evenly;grid-template-areas:'header''content';grid-template-rows: 30px calc(100% - 30px);}\n.planner-modal-header {font-size:16px;border-top-left-radius: 10px;border-top-right-radius: 10px;padding: 5px;grid-area: header;text-align: center;background: linear-gradient(to bottom,#e2c07c 0%,#dab874 44%,#c1a264 100%);}\n.planner-modal-content {display:grid;grid-area: content;padding: 10px;}\n.modal-input-group{display:inline-grid;text-align:center;border-bottom: solid 1px #603000;padding: 5px 0;}\n.modal-input-inline{display:block;text-align:center;border-bottom: solid 1px #603000;padding: 5px 0;}\n.modal-input-group label{margin-bottom:10px;}\n.modal-input-group input{margin-bottom:10px;}\n.modal-input-group textarea{margin-bottom:10px;}\n.modal-input-group button{margin-bottom:10px;}\n.modal-input-group input{text-align:center;font-size: 14px;}\n.modal-input-group select{text-align:center;font-size: 14px;margin-bottom:10px;}.del-boost {background: url(https://klanhaboru.hu/graphic/minus.png) top left no-repeat;height: 16px;width: 16px;margin-left: 5px;cursor: pointer;display: inline-block;vertical-align: middle;}\n.booster-button {display: inline;}\n.launch-search-bar{display: inline-block;\n}\n.launch-search-bar input{width:60px;font-size:12px;}\n.remove-search-btn {float: right;z-index: 2;width: 20px;height: 20px;background: url(https://dshu.innogamescdn.com/asset/80b013af/graphic/login_close.png) top left no-repeat;cursor: pointer;background-size: 20px;}.qr-row{height:fit-content}\n</style><link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css"><script>$.widget("ui.accordion",{version:"1.12.1",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top","ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:!1,event:"click",header:"> li > :first-child, > :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var a=this.options;this.prevShow=this.prevHide=$(),this._addClass("ui-accordion","ui-widget ui-helper-reset"),this.element.attr("role","tablist"),a.collapsible|| !1!==a.active&&null!=a.active||(a.active=0),this._processPanels(),a.active<0&&(a.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():$()}},_createIcons:function(){var b,c,a=this.options.icons;a&&(b=$("<span>"),this._addClass(b,"ui-accordion-header-icon","ui-icon "+a.header),b.prependTo(this.headers),c=this.active.children(".ui-accordion-header-icon"),this._removeClass(c,a.header)._addClass(c,null,a.activeHeader)._addClass(this.headers,"ui-accordion-icons"))},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons"),this.headers.children(".ui-accordion-header-icon").remove()},_destroy:function(){var a;this.element.removeAttr("role"),this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId(),this._destroyIcons(),a=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&a.css("height","")},_setOption:function(a,b){if("active"===a){this._activate(b);return}"event"===a&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(b)),this._super(a,b),"collapsible"!==a||b|| !1!==this.options.active||this._activate(0),"icons"===a&&(this._destroyIcons(),b&&this._createIcons())},_setOptionDisabled:function(a){this._super(a),this.element.attr("aria-disabled",a),this._toggleClass(null,"ui-state-disabled",!!a),this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!a)},_keydown:function(b){if(!b.altKey&&!b.ctrlKey){var a=$.ui.keyCode,d=this.headers.length,e=this.headers.index(b.target),c=!1;switch(b.keyCode){case a.RIGHT:case a.DOWN:c=this.headers[(e+1)%d];break;case a.LEFT:case a.UP:c=this.headers[(e-1+d)%d];break;case a.SPACE:case a.ENTER:this._eventHandler(b);break;case a.HOME:c=this.headers[0];break;case a.END:c=this.headers[d-1]}c&&($(b.target).attr("tabIndex",-1),$(c).attr("tabIndex",0),$(c).trigger("focus"),b.preventDefault())}},_panelKeyDown:function(a){a.keyCode===$.ui.keyCode.UP&&a.ctrlKey&&$(a.currentTarget).prev().trigger("focus")},refresh:function(){var a=this.options;this._processPanels(),(!1!==a.active|| !0!==a.collapsible)&&this.headers.length?!1===a.active?this._activate(0):this.active.length&&!$.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(a.active=!1,this.active=$()):this._activate(Math.max(0,a.active-1)):a.active=this.headers.index(this.active):(a.active=!1,this.active=$()),this._destroyIcons(),this._refresh()},_processPanels:function(){var b=this.headers,a=this.panels;this.headers=this.element.find(this.options.header),this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default"),this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide(),this._addClass(this.panels,"ui-accordion-content","ui-helper-reset ui-widget-content"),a&&(this._off(b.not(this.headers)),this._off(a.not(this.panels)))},_refresh:function(){var a,b=this.options,c=b.heightStyle,d=this.element.parent();this.active=this._findActive(b.active),this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed"),this._addClass(this.active.next(),"ui-accordion-content-active"),this.active.next().show(),this.headers.attr("role","tab").each(function(){var a=$(this),c=a.uniqueId().attr("id"),b=a.next(),d=b.uniqueId().attr("id");a.attr("aria-controls",d),b.attr("aria-labelledby",c)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(b.event),"fill"===c?(a=d.height(),this.element.siblings(":visible").each(function(){var b=$(this),c=b.css("position");"absolute"!==c&&"fixed"!==c&&(a-=b.outerHeight(!0))}),this.headers.each(function(){a-=$(this).outerHeight(!0)}),this.headers.next().each(function(){$(this).height(Math.max(0,a-$(this).innerHeight()+$(this).height()))}).css("overflow","auto")):"auto"===c&&(a=0,this.headers.next().each(function(){var b=$(this).is(":visible");b||$(this).show(),a=Math.max(a,$(this).css("height","").height()),b||$(this).hide()}).height(a))},_activate:function(b){var a=this._findActive(b)[0];a!==this.active[0]&&(a=a||this.active[0],this._eventHandler({target:a,currentTarget:a,preventDefault:$.noop}))},_findActive:function(a){return"number"==typeof a?this.headers.eq(a):$()},_setupEvents:function(a){var b={keydown:"_keydown"};a&&$.each(a.split(" "),function(c,a){b[a]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,b),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var f,g,a=this.options,c=this.active,b=$(e.currentTarget),d=b[0]===c[0],h=d&&a.collapsible,j=h?$():b.next(),k=c.next(),i={oldHeader:c,oldPanel:k,newHeader:h?$():b,newPanel:j};e.preventDefault(),(!d||a.collapsible)&& !1!==this._trigger("beforeActivate",e,i)&&(a.active=!h&&this.headers.index(b),this.active=d?$():b,this._toggle(i),this._removeClass(c,"ui-accordion-header-active","ui-state-active"),a.icons&&(f=c.children(".ui-accordion-header-icon"),this._removeClass(f,null,a.icons.activeHeader)._addClass(f,null,a.icons.header)),d||(this._removeClass(b,"ui-accordion-header-collapsed")._addClass(b,"ui-accordion-header-active","ui-state-active"),a.icons&&(g=b.children(".ui-accordion-header-icon"),this._removeClass(g,null,a.icons.header)._addClass(g,null,a.icons.activeHeader)),this._addClass(b.next(),"ui-accordion-content-active")))},_toggle:function(c){var b=c.newPanel,a=this.prevShow.length?this.prevShow:c.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=b,this.prevHide=a,this.options.animate?this._animate(b,a,c):(a.hide(),b.show(),this._toggleComplete(c)),a.attr({"aria-hidden":"true"}),a.prev().attr({"aria-selected":"false","aria-expanded":"false"}),b.length&&a.length?a.prev().attr({tabIndex:-1,"aria-expanded":"false"}):b.length&&this.headers.filter(function(){return 0===parseInt($(this).attr("tabIndex"),10)}).attr("tabIndex",-1),b.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(a,e,j){var h,b,c,k=this,l=0,m=a.css("box-sizing"),i=a.length&&(!e.length||a.index()<e.index()),f=this.options.animate||{},d=i&&f.down||f,g=function(){k._toggleComplete(j)};return("number"==typeof d&&(c=d),"string"==typeof d&&(b=d),b=b||d.easing||f.easing,c=c||d.duration||f.duration,e.length)?a.length?void(h=a.show().outerHeight(),e.animate(this.hideProps,{duration:c,easing:b,step:function(a,b){b.now=Math.round(a)}}),a.hide().animate(this.showProps,{duration:c,easing:b,complete:g,step:function(b,a){a.now=Math.round(b),"height"!==a.prop?"content-box"===m&&(l+=a.now):"content"!==k.options.heightStyle&&(a.now=Math.round(h-e.outerHeight()-l),l=0)}})):e.animate(this.hideProps,c,b,g):a.animate(this.showProps,c,b,g)},_toggleComplete:function(b){var a=b.oldPanel,c=a.prev();this._removeClass(a,"ui-accordion-content-active"),this._removeClass(c,"ui-accordion-header-active")._addClass(c,"ui-accordion-header-collapsed"),a.length&&(a.parent()[0].className=a.parent()[0].className),this._trigger("activate",null,b)}});<\/script><div class="mainWindow"><div class="container"><div class="options-title header"><h3>${(0,t.Lang)("options")}</h3></div><div class="options-panel"><div class="option-item"><h2 style="font-size: 1rem;"><span id="open-plan-name">${window.attackPlan.name}</span><a onclick="window.editName()" class="rename-icon" href="#" data-title="rename"></a></h2></div><div class="option-item"><button onclick="window.editTargets()" class="btn">${(0,t.Lang)("editTargets")}</button></div><div class="option-item"><button onclick="window.editArrivals()" class="btn">${(0,t.Lang)("editArrivals")}</button></div><div class="option-item"><button onclick="window.editTemplates()" class="btn">${(0,t.Lang)("editTemplates")}</button></div><div class="option-item"><button onclick="window.editPlayerBoosts()" class="btn">${(0,t.Lang)("editPalyerBoosters")}</button></div><div class="option-item"><button onclick="window.openAutoAssignModal()" class="btn">${(0,t.Lang)("autoAssigner")}</button></div><div class="option-item"><button onclick="window.calculateAttack()" class="btn">${(0,t.Lang)("calculateAttack")}</button></div><div class="option-item"><button onclick="window.resetAssignments()" class="btn">${(0,t.Lang)("resetAssigments")}</button></div></div><div class="target-title header"><h3>${(0,t.Lang)("targets")} (<span id="target-cnt"></span>)</h3></div><div class="target-panel"><div class="target-header"></div><div class="target-list"></div></div><div class="launch-title header"><div class="launch-filter-bar"><button onclick="window.launchVillagesQuery.order('coord.text')" class="btn">XY</button><button onclick="window.launchVillagesQuery.order('name')" class="btn">${(0,t.Lang)("name")}</button></div><h3>${(0,t.Lang)("launchVillages")} (<span id="launch-cnt"></span>)</h3><div class="launch-filter-bar"><button onclick="window.launchVillagesQuery.order('popSize')" class="btn">${(0,t.Lang)("size")}</button><div class="launch-search-bar"><input id="search-bar" onkeyup="window.launchVillagesQuery.search(this)" placeholder="${(0,t.Lang)("search")}" type="text"><button onclick="window.launchVillagesQuery.resetAll()" class="btn">${(0,t.Lang)("reset")}</button></div></div></div><div class="launch-panel"><div class="launch-header"><div class="size-icon"><button onclick="window.openAddLauncherWindow()" class="btn btn-add-attack">⬅</button></div><div class="spear-icon"><img onclick="window.launchVillagesQuery.order('unitsContain.spear')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_spear.png"></div><div class="sword-icon"><img onclick="window.launchVillagesQuery.order('unitsContain.sword')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_sword.png"></div><div class="axe-icon"><img onclick="window.launchVillagesQuery.order('unitsContain.axe')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_axe.png"></div>${1==window.gameConfig.game.archer&&'<div class="archer-icon"><img onclick="window.launchVillagesQuery.order(\'unitsContain.archer\')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_archer.png"></div>'}<div class="spy-icon"><img onclick="window.launchVillagesQuery.order('unitsContain.spy')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_spy.png"></div><div class="light-icon"><img onclick="window.launchVillagesQuery.order('unitsContain.light')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_light.png"></div>${1==window.gameConfig.game.archer&&'<div class="marcher-icon"><img onclick="window.launchVillagesQuery.order(\'unitsContain.marcher\')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_marcher.png"></div>'}<div class="heavy-icon"><img onclick="window.launchVillagesQuery.order('unitsContain.heavy')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_heavy.png"></div><div class="ram-icon"><img onclick="window.launchVillagesQuery.order('unitsContain.ram')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_ram.png"></div><div class="catapult-icon"><img onclick="window.launchVillagesQuery.order('unitsContain.catapult')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_catapult.png"></div><div class="pala-icon"><img onclick="window.launchVillagesQuery.order('unitsContain.pala')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_knight.png"></div><div class="snob-icon"><img onclick="window.launchVillagesQuery.order('unitsContain.snob')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_snob.png"></div></div><div class="launch-list"></div></div><div class="credits">v0.1.4-beta [2024.11.09.]; by: toldi26</div></div></div><div class="planner-modal" style="display:none;"><div class="planner-modal-header"><b></b></div><div class="planner-modal-content"> </div></div><script>window.mainInit();<\/script>`;window.mainInit=()=>{console.log(window.attackPlan.launchPool),window.launchVillagesQuery=new i.Query(window.attackPlan.launchPool,$(".launch-list").get()[0],$("#launch-cnt").get()[0],m.launchItem,"name"),window.launchVillagesQuery.render(),window.targetPoolQuery=new i.Query(window.attackPlan.targetPool,$(".target-list").get()[0],$("#target-cnt").get()[0],w.targetItem,"village.name"),window.targetPoolQuery.render()},window.openAddLauncherWindow=()=>{0!=$('input[name="target"]:checked').get().length&&0!=$('input[name="target"]:checked').get().length?0!=$(".launch-list").find("input:checked").get().length?window.createModal((0,l.addAttackModal)(),(0,t.Lang)("addAtatck")):window.UI.ErrorMessage((0,t.Lang)("noLauncherSel")):window.UI.ErrorMessage((0,t.Lang)("noTargetSel"))},window.createModal=(n,e)=>{let a=`<div id="plannerCloseBtn" class="modal-input-inline"><button class="btn" onclick="window.closeModal()">${(0,t.Lang)("close")}</button></div>`;$(".planner-modal-header b").text(e),$(".planner-modal-content").html(n+a),$(".planner-modal").show()},window.closeModal=()=>{$(".planner-modal-header b").text(""),$(".planner-modal-content").html(""),$(".planner-modal").hide()},window.editName=()=>{window.createModal((0,p.editPlanNameModal)(window.attackPlan),(0,t.Lang)("renamePlan"))},window.editTargets=()=>{window.createModal((0,u.editTargetModal)(window.attackPlan.targetPool),(0,t.Lang)("editTargetsText"))},window.editArrivals=()=>{window.createModal((0,g.editArrivalsModal)(window.attackPlan.arrivals),(0,t.Lang)("editArrivalsText"))},window.editTemplates=()=>{window.createModal((0,h.editTemplatesModal)(window.attackPlan.templates),(0,t.Lang)("editTemplatesText"))},window.editPlayerBoosts=()=>{window.createModal((0,o.addPlayerSpeedModal)(),(0,t.Lang)("editBoostersText"))},window.calculateAttack=()=>{let n=0;window.attackPlan.targetPool.forEach((e=>{e.launchers.forEach((e=>{n++}))})),0!=n?window.createModal((0,d.confirmCalculateAttackModal)(),(0,t.Lang)("calculateAttack")):window.UI.ErrorMessage((0,t.Lang)("noAttackAssigned"))},window.confirmCalculateAttack=()=>{window.createModal((0,r.calculatedAttackModal)(),(0,t.Lang)("attackPlan"))},window.openAutoAssignModal=()=>{window.autoAssign.assignTypes=[],window.autoAssign.launchPoolCopy=structuredClone(window.attackPlan.launchPool),window.createModal((0,s.autoAssignModal)(),(0,t.Lang)("autoAssigner"))},window.resetAssignments=()=>{window.createModal((0,c.confirmResetAssignmentsModal)(),(0,t.Lang)("resetAssigments"))}},"./src/view/targetItem.ts":(n,e,a)=>{a.r(e),a.d(e,{targetItem:()=>c});var t=a("./src/core/Api.ts"),i=a("./src/core/Language.ts"),l=a("./src/view/ConfirmVillageSpeedRemoveModal.ts"),o=a("./src/view/addVillageSpeedModal.ts"),s=a("./src/view/confirmRemoveModal.ts"),r=a("./src/view/confirmRemoveTargetModal.ts"),d=a("./src/view/targetsLauncher.ts");const c=n=>{let e=0,a=0,i=0,l=0,o=0;return n.launchers.forEach((n=>{n.village.popSize<=1e3?a++:n.village.popSize>1e3&&n.village.popSize<=5e3?i++:n.village.popSize>5e3&&l++,n.isAttack||o++,e+=n.village.unitsContain.snob})),`<div id="${n.village.id}" class="target-item"><div onclick="targetItem.toggleTargetItem(this)" class="target-header"><div><input value="${n.village.id}" onclick="targetItem.selectTargetItem(event)" type="radio" name="target" ${n.isSelected?"checked":""}/></div><div class="indicator ${n.isOpen?"indicator-open":""}"><span >▶<span></div><div class="target-village-name"><a target="_blank" href="/game.php?village=${t.game.village.id}&screen=info_village&id=${n.village.id}">${n.village.name}(${n.village.coord.text}) K${n.village.kontinent}</a></div><div class="target-extras">${n.booster>0?`<div class="booster-button">( ${n.booster}% <img height="15" src="https://dshu.innogamescdn.com/asset/f9cb54f8/graphic/items/3005.png">) <a class="del-boost" onclick="targetItem.removeVillageBooster(event,${n.village.id})"></a></div>`:`<a onclick="targetItem.addVillageBooster(event,${n.village.id})" class="add-village-booster"></a>`}<div class="header-count">${e>0?`<img height="14px" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_snob.png"><span>${e}<span>`:""}${l>0?`<img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/command/attack_large.png"><span>${l}<span>`:""}${i>0?`<img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/command/attack_medium.png"><span>${i}<span>`:""}${a>0?`<img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/command/attack_small.png"><span>${a}<span>`:""}${o>0?`<img src="https://dshu.innogamescdn.com/asset/69990994/graphic/command/support.png"><span>${o}<span>`:""}</div></div><div><a onclick="targetItem.removeTargetItem(event,${n.village.id})" class="remove-target-btn"></a></div></div><div class="target-launchers" style="display: ${n.isOpen?"block":"none"};"><div class="target-launch-header"><div class="spear-icon"><img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_spear.png"></div><div class="sword-icon"><img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_sword.png"></div><div class="axe-icon"><img  src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_axe.png"></div>${0==window.gameConfig.game.archer?"":'<div class="archer-icon"><img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_archer.png"></div>'}<div class="spy-icon"><img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_spy.png"></div><div class="light-icon"><img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_light.png"></div>${0==window.gameConfig.game.archer?"":'<div class="marcher-icon"><img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_marcher.png"></div>'}<div class="heavy-icon"><img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_heavy.png"></div><div class="ram-icon"><img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_ram.png"></div><div class="catapult-icon"><img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_catapult.png"></div><div class="pala-icon"><img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_knight.png"></div><div class="snob-icon"><img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_snob.png"></div><div class="del-icon"></div> </div>${n.launchers.map((e=>(0,d.targetsLauncher)(e,n.village.id))).join("")}</div></div>`};window.targetItem={toggleTargetItem:n=>{$(n).parent().find(".target-launchers").toggle(),$(n).find(".indicator").toggleClass("indicator-open"),$(n).find("input").prop("checked",!0);let e=parseInt($(n).parent().attr("id")),a=window.attackPlan.targetPool.findIndex((n=>n.village.id==e));window.attackPlan.targetPool[a].isOpen=!window.attackPlan.targetPool[a].isOpen},selectTargetItem:n=>{let e=parseInt($(n.target).parent().parent().parent().attr("id"));window.attackPlan.targetPool.forEach((n=>{n.village.id==e?(n.isSelected=!0,n.isOpen=!0):n.isSelected=!1})),n.stopPropagation(),$(n.target).parent().parent().parent().find(".target-launchers").toggle(),$(n.target).parent().parent().find(".indicator").toggleClass("indicator-open")},removeTargetItem:(n,e)=>{n.stopPropagation(),$(".planner-modal-header b").text((0,i.Lang)("removeTarget")),$(".planner-modal-content").html((0,r.confirmRemoveTargetModal)(e)),$(".planner-modal").show()},confirmRemoveTargetItem:n=>{let e=[],a=window.attackPlan.targetPool.findIndex((e=>e.village.id==n)),i=!1;a<-1||(window.attackPlan.targetPool[a].launchers.forEach((n=>{let a=window.attackPlan.launchPool.findIndex((e=>e.id==n.village.id));if(-1==a){let e={...n.village};window.attackPlan.launchPool.push(e),i=!0}else[window.attackPlan.launchPool[a].unitsContain,n.village.unitsContain]=(0,t.TroopTransaction)(window.attackPlan.launchPool[a].unitsContain,n.village.unitsContain,n.village.unitsContain),e.push(n.village)})),i?window.launchVillagesQuery.resetAll():window.launchVillagesQuery.partialRender(e,"id"),window.attackPlan.targetPool.splice(a,1),window.targetPoolQuery.resetAll(),window.closeModal(),window.DB.savePlan(window.attackPlan))},removeTargetLauncherItem:(n,e)=>{$(".planner-modal-header b").text((0,i.Lang)("removeAttack")),$(".planner-modal-content").html((0,s.confirmRemoveModal)(n,e)),$(".planner-modal").show()},confirmRemoveTargetLauncherItem:(n,e)=>{let a=[],i=window.attackPlan.targetPool.findIndex((n=>n.village.id==e));if(i<-1)return;let l=window.attackPlan.targetPool[i].launchers.findIndex((e=>e.village.id==n));if(l<-1)return;let o=window.attackPlan.launchPool.findIndex((e=>e.id==n));if(-1==o){let n={...window.attackPlan.targetPool[i].launchers[l].village};window.attackPlan.launchPool.push(n),window.attackPlan.targetPool[i].launchers.splice(l,1),window.launchVillagesQuery.resetAll()}else[window.attackPlan.launchPool[o].unitsContain,window.attackPlan.targetPool[i].launchers[l].village.unitsContain]=(0,t.TroopTransaction)(window.attackPlan.launchPool[o].unitsContain,window.attackPlan.targetPool[i].launchers[l].village.unitsContain,window.attackPlan.targetPool[i].launchers[l].village.unitsContain),console.log(window.attackPlan.launchPool[o].unitsContain,window.attackPlan.targetPool[i].launchers[l].village.unitsContain),a.push(window.attackPlan.launchPool[o]),window.attackPlan.targetPool[i].launchers.splice(l,1);window.launchVillagesQuery.partialRender(a,"id"),window.targetPoolQuery.partialRender([window.attackPlan.targetPool[i]],"village.id"),window.closeModal(),window.DB.savePlan(window.attackPlan)},addVillageBooster:(n,e)=>{n.stopPropagation(),$(".planner-modal-header b").text((0,i.Lang)("addVillageBoost")),$(".planner-modal-content").html((0,o.addVillageBoosterModal)(e)),$(".planner-modal").show()},confirmAddVillageBooster:n=>{let e=window.attackPlan.targetPool.findIndex((e=>e.village.id==n));e<-1||(window.attackPlan.targetPool[e].booster=parseInt($("#planner-village-boost").val().toString()),window.closeModal(),window.targetPoolQuery.partialRender([window.attackPlan.targetPool[e]],"village.id"),window.DB.savePlan(window.attackPlan))},removeVillageBooster:(n,e)=>{n.stopPropagation(),$(".planner-modal-header b").text((0,i.Lang)("removeVillageBoost")),$(".planner-modal-content").html((0,l.ConfirmVillageSpeedRemoveModal)(e)),$(".planner-modal").show()},confirmRemoveVillageBooster:n=>{window.closeModal();let e=window.attackPlan.targetPool.findIndex((e=>e.village.id==n));e<-1||(window.attackPlan.targetPool[e].booster=0,window.closeModal(),window.targetPoolQuery.partialRender([window.attackPlan.targetPool[e]],"village.id"),window.DB.savePlan(window.attackPlan))}}},"./src/view/targetsLauncher.ts":(n,e,a)=>{a.r(e),a.d(e,{targetsLauncher:()=>i});var t=a("./src/core/Api.ts");const i=(n,e)=>{let a="small";n.village.popSize>1e3&&n.village.popSize<=5e3?a="medium":n.village.popSize>5e3&&(a="large");let i=`https://dshu.innogamescdn.com/asset/72737c96/graphic/command/attack_${a}.png`;n.isAttack||(i="https://dshu.innogamescdn.com/asset/69990994/graphic/command/support.png");let l=Object.keys(n.village.unitsContain),o="";for(let e=0;e<l.length;e++){const a=l[e];(0!=window.gameConfig.game.archer||"archer"!=a&&"marcher"!=a)&&(o+=`<div class="${a}-field ${0==n.village.unitsContain[a]?"hidden":""}">${n.village.unitsContain[a]}</div>`)}return`<div class="targetsLauncher-item" id="${n.village.id}"><div class="name-field"><span><a target="_blank" href="/game.php?village=${t.game.village.id}&screen=info_village&id=${n.village.id}">${n.village.name} (${n.village.coord.text}) K${n.village.kontinent}</a></span><span style="font-size:9px;color:black">(${n.arrival})</span></div><div class="size-field"><img src="${i}"></div>${o}<div class="del-field"><a onclick="window.targetItem.removeTargetLauncherItem(${n.village.id.toString()},${e})" class="remove-target-btn"></a></div></div>`}}},e={};function a(t){var i=e[t];if(void 0!==i)return i.exports;var l=e[t]={exports:{}};return n[t](l,l.exports,a),l.exports}a.d=(n,e)=>{for(var t in e)a.o(e,t)&&!a.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})},a.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),a.r=n=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var t={};(()=>{a.r(t);var n=a("./src/core/Api.ts"),e=a("./src/core/Language.ts"),i=a("./src/core/PlayersModel.ts"),l=a("./src/core/VillageModel.ts"),o=a("./src/core/planDB.ts"),s=a("./src/view/launchDialog.ts");(async()=>{window.Lang=(0,e.determineLang)(),window.game_data.features.Premium.active?(window.DB=new o.planDB,await window.DB.init(),window.Plans=await window.DB.loadPlans(),window.gameConfig=await(0,n.getServerConifg)(),window.unitConfig=await(0,n.getUnitConfig)(),window.Villages=await l.VillageModel.init(),window.Players=await i.PlayersModel.init(),window.Groups=await(0,n.fetchGroups)(),window.Dialog.show("launchDialog",(0,s.launchDialog)()),$(".popup_box_container").append('<div style="position: fixed;width: 100%;height: 100%;top:0;left:0;z-index:12001"></div>')):window.UI.ErrorMessage((0,e.Lang)("needPremiumFeature"))})()})()})();