/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var n={"./src/core/Api.ts":(n,e,a)=>{a.r(e),a.d(e,{TroopTransaction:()=>y,calcUnitPop:()=>P,coordDistance:()=>C,fetchGroups:()=>v,game:()=>o,getAllPlayer:()=>m,getAllVillages:()=>h,getServerConifg:()=>p,getSlowestUnit:()=>A,getUnitConfig:()=>u,hasAvailableTroops:()=>_,loadPages:()=>f});var t=a("./src/core/VillageModel.ts"),i=a("./src/core/xml2json.ts");const l="https://"+window.location.hostname,o=game_data,s="/map/village.txt",r="/map/player.txt",d="/interface.php?func=get_unit_info",c="/interface.php?func=get_config",g="screen=accountmanager";async function p(){let n=await $.ajax({url:l+c});return(0,i.xml2json)(n,"")}async function u(){let n=await $.ajax({url:l+d});return(0,i.xml2json)(n,"")}async function h(){let n=await $.ajax({url:l+s});n=n.trim();let e=[],a=n.split("\n");for(let n=0;n<a.length;n++){let t=a[n].split(","),i=parseInt(t[2]),l=parseInt(t[3]);e.push({id:parseInt(t[0]),name:decodeURIComponent(t[1]).replaceAll("+"," "),owner:parseInt(t[4]),kontinent:10*Math.floor(l/100)+Math.floor(i/100),coord:{text:t[2]+"|"+t[3],x:i,y:l},popRemain:null,unitsContain:null,popSize:null})}return e}async function m(){let n=await $.ajax({url:l+r});n=n.trim();let e=[],a=n.split("\n");for(let n=0;n<a.length;n++){let t=a[n].split(",");e.push({id:parseInt(t[0]),name:decodeURIComponent(t[1]).replaceAll("+"," "),allyId:parseInt(t[2]),villageCnt:parseInt(t[3]),pionts:parseInt(t[4]),rank:parseInt(t[5])})}return e}function w(n=1,e=0){return`/game.php?${0!=o.player.sitter?"t="+o.player.id+"&":""}village=${o.village.id}&group=${e}&page=${n}&screen=overview_villages&mode=combined`}async function v(){let n=await $.ajax({url:l+`/game.php?${0!=o.player.sitter?"t="+o.player.id+"&":""}village=${o.village.id}&`+g}),e=$(n).find(".group-menu-item").get(),a=[];return e.forEach((n=>{a.push({id:parseInt($(n).attr("data-group-id")),name:$(n).text().trim().slice(1,-1)})})),a}async function f(n){let e=[],a=[],t=[];for(let e=0;e<n.length;e++)a.push(b(w(0,n[e]),e,1));await Promise.allSettled(a).then((n=>n.forEach((async n=>{t.push(n.value.pageCnt),n.value.villages.forEach((n=>{-1==e.findIndex((e=>n.id==e.id))&&e.push(n)}))})))),a=[];for(let e=0;e<n.length;e++)for(let i=1;i<t[e];i++)a.push(b(w(i,n[e]),(e+1)*i,i));return await Promise.allSettled(a).then((n=>n.forEach((async n=>{n.value.villages.forEach((n=>{-1==e.findIndex((e=>n.id==e.id))&&e.push(n)}))})))),e}function b(n,e,a){return new Promise((async(i,l)=>{setTimeout((async()=>{let e=await $.ajax({url:n}),l=await async function(n){let e=$(n).find("#combined_table").find("tr"),a=[],i=[];$(e).find("th").get().forEach(((n,e)=>{let a=$(n).find("img");if(a.length>0){let n=$(a).attr("src");n.includes("graphic/unit/unit_")&&!n.includes("unit_militia")&&i.push({index:e,name:x(n)})}}));for(let n=1;n<e.length;n++){const l=e[n];let o=$(l).find("td"),s=parseInt($(l).find(".quickedit-vn").attr("data-id")),r={spear:0,sword:0,axe:0,archer:0,spy:0,light:0,marcher:0,heavy:0,ram:0,catapult:0,knight:0,snob:0},d=0;i.forEach((n=>{let e=parseInt($(o[n.index]).text());r[n.name]=e,d+=window.unitConfig[n.name].pop*e}));let c=(await t.VillageModel.init()).find((n=>n.id==s)),g=parseInt($(o[7]).find("a").text().split(" ")[0]);c.unitsContain=r,c.popRemain=g,c.popSize=d,a.push(c)}return a}(e);i({pageCnt:k(e),pageNum:a-1,villages:l})}),200*e)}))}function k(n){let e=$($(n).find(".paged-nav-item").get()[0]).parent().find("select"),a=0;return a=1==e.length?e.find("option").length-1:$(n).find(".paged-nav-item").length,a}function x(n){let e=n.split("/");return e[e.length-1].split(".")[0].replace("unit_","").replace("@2x","")}function y(n,e,a){return Object.keys(a).forEach((t=>{[n[t],e[t]]=function(n,e,a){return a<0&&(a=e+a)<0&&(a=0),e-a<0?(n=e,e=0):(n+=a,e-=a),[n,e]}(n[t],e[t],a[t])})),[n,e]}function P(n){let e=0;return Object.keys(n).forEach((a=>{e+=window.unitConfig[a].pop*n[a]})),e}function A(n,e){var a=Object.keys(n).map((n=>({key:n,value:window.unitConfig[n].speed}))).sort(((n,e)=>n.value>e.value?-1:1));if(!e&&n.knight>0)return{key:"knight",value:window.unitConfig.knight.speed};for(let e=0;e<a.length;e++)if(n[a[e].key]>0)return a[e]}function C(n,e){return n&&e?Math.sqrt(Math.pow(e.coord.x-n.coord.x,2)+Math.pow(e.coord.y-n.coord.y,2)):null}function _(n,e){let a=Object.keys(e);for(let t=0;t<a.length;t++){const i=a[t];if("snob"==i&&n.unitsContain[i]>0&&0==e[i])return console.log("ide"),!1;if(0!=e[i]){if(e[i]<0&&n.unitsContain[i]+e[i]<0)return!1;if(0==n.unitsContain[i]&&99999==e[i])return!1;if(n.unitsContain[i]<e[i]&&99999!=e[i]&&e[i]>0)return!1}}return!0}},"./src/core/Language.ts":(n,e,a)=>{a.r(e),a.d(e,{Lang:()=>l,determineLang:()=>o});var t=a("./src/view/language/en.ts"),i=a("./src/view/language/hu.ts");function l(n){let e=i.hu;switch(window.Lang){case"hu":e=i.hu;break;case"en":e=t.en}return e.hasOwnProperty(n)?e[n]:`lang.${window.Lang}.${n}`}function o(){const n=navigator.language.split("-")[0];return["hu","en"].includes(n)?n:"en"}},"./src/core/Model.ts":(n,e,a)=>{a.r(e),a.d(e,{Model:()=>t});class t{constructor(n=[]){this.items=[],this.items=n}first(){return this.items.length>0?this.items[0]:null}get(n=this.items.length){return this.items.slice(0,n)}filter(n){let e=this.items.filter(n);return new t(e)}find(n){return this.items.find(n)}sort(n,e){let a=this.items.sort(((a,t)=>a[n]>t[n]?e?1:-1:e?-1:1));return new t(a)}}},"./src/core/PlayersModel.ts":(n,e,a)=>{a.r(e),a.d(e,{PlayersModel:()=>l});var t=a("./src/core/Api.ts"),i=a("./src/core/Model.ts");class l extends i.Model{static init(){return null==l.instance?async function(){return l.instance=new l,await l.instance.loadPlayers(),l.instance}():async function(){return l.instance}()}async loadPlayers(){this.items=await(0,t.getAllPlayer)()}}l.instance=null},"./src/core/Query.ts":(n,e,a)=>{a.r(e),a.d(e,{Query:()=>t});class t{constructor(n,e,a,t,i){this.objectCopy=[],this.way=1,this.field="",this.from=0,this.to=0,this.draw=50,this.CanScroll=!1,this.searchField=null,this.field=i,this.objectRef=n,this.objectCopy=structuredClone(this.objectRef),this.controlledOrder(this.field,this.way),this.funcRef=t,this.targetHtml=e,this.targetCnt=a;let l=this;e.addEventListener("scroll",(function(n){let a=!1;e.scrollHeight-100<=e.clientHeight+e.scrollTop&&!a&&l.CanScroll&&(a=!0,l.pull())})),addEventListener("wheel",(n=>{l.CanScroll=!0,clearTimeout(l.To),l.To=setTimeout((()=>{l.CanScroll=!1}),500)}))}search(n){this.searchField=n,this.reset(),this.objectCopy=this.objectCopy.filter((n=>`${n.name} (${n.coord.text}) K${n.kontinent}`.includes(this.searchField.value))),this.render()}setDraw(n){this.draw=n}calcPaging(){this.to=this.from+this.draw,this.to>this.objectCopy.length&&(this.to=this.objectCopy.length)}reset(){$(this.targetHtml).html(""),$(this.targetHtml).scrollTop(0),this.objectCopy=structuredClone(this.objectRef),this.controlledOrder(this.field,1),this.from=0,this.to=0}resetAll(){this.reset(),this.render(),this.searchField&&(this.searchField.value="")}controlledOrder(n,e){let a=this;this.objectCopy.sort(((e,t)=>a.getProp(n,e)<a.getProp(n,t)?-1*this.way:1*this.way))}order(n){this.reset(),this.field==n?this.way*=-1:this.way=-1,this.controlledOrder(n,this.way),this.field=n,this.render()}getProp(n,e){let a=n.split(".");return 1==a.length?e[a[0]]:(e=e[a.shift()],this.getProp(a.join("."),e))}pull(){this.from+this.draw>this.objectCopy.length||(this.from+=this.draw,this.to=this.from+this.draw,this.render())}render(){this.calcPaging();for(let n=this.from;n<this.to;n++)$(this.targetHtml).append(this.funcRef(this.objectCopy[n]));$(this.targetCnt).text(this.objectCopy.length)}partialRender(n,e){n.forEach((n=>{$(this.targetHtml).find(`#${this.getProp(e,n)}`).replaceWith(this.funcRef(n))}))}}},"./src/core/VillageModel.ts":(n,e,a)=>{a.r(e),a.d(e,{VillageModel:()=>l});var t=a("./src/core/Api.ts"),i=a("./src/core/Model.ts");class l extends i.Model{static init(){return null==l.instance?async function(){return l.instance=new l,await l.instance.loadVillages(),l.instance}():l.instance}async loadVillages(){this.items=await(0,t.getAllVillages)()}}l.instance=null},"./src/core/planDB.ts":(n,e,a)=>{a.r(e),a.d(e,{planDB:()=>t});class t{async init(){this.db=await this.loadDB(),console.log("loaded plan DB 🚀")}async loadPlans(){return new Promise((async(n,e)=>{if(!this.db.objectStoreNames.contains("plans"))return void n([]);let a=this.db.transaction("plans"),t=await a.objectStore("plans").getAll();t.onsuccess=()=>{n(t.result.map((n=>JSON.parse(n.data))))}}))}async savePlan(n){let e=this.db.transaction("plans","readwrite");await e.objectStore("plans").put({id:n.id,data:JSON.stringify(n)})}async removePlan(n){let e=this.db.transaction("plans","readwrite");await e.objectStore("plans").delete(n)}async loadDB(){return new Promise(((n,e)=>{let a=indexedDB.open("TW_ATTACK_PLANNER_DATA",1);a.onupgradeneeded=function(){let e=a.result;e.objectStoreNames.contains("plans")||e.createObjectStore("plans",{keyPath:"id",autoIncrement:!1}),a.onsuccess=function(){n(a.result)}},a.onsuccess=function(){n(a.result)},a.onerror=function(){throw console.error("Error",a.error),new Error(a.error.message)}}))}}},"./src/core/xml2json.ts":(n,e,a)=>{function t(n,e){var a={toObj:function(n){var e={};if(1==n.nodeType){if(n.attributes.length)for(var t=0;t<n.attributes.length;t++)e["@"+n.attributes[t].nodeName]=(n.attributes[t].nodeValue||"").toString();if(n.firstChild){for(var i=0,l=0,o=!1,s=n.firstChild;s;s=s.nextSibling)1==s.nodeType?o=!0:3==s.nodeType&&s.nodeValue.match(/[^ \f\n\r\t\v]/)?i++:4==s.nodeType&&l++;if(o)if(i<2&&l<2)for(a.removeWhite(n),s=n.firstChild;s;s=s.nextSibling)3==s.nodeType?e["#text"]=a.escape(s.nodeValue):4==s.nodeType?e["#cdata"]=a.escape(s.nodeValue):e[s.nodeName]?e[s.nodeName]instanceof Array?e[s.nodeName][e[s.nodeName].length]=a.toObj(s):e[s.nodeName]=[e[s.nodeName],a.toObj(s)]:e[s.nodeName]=a.toObj(s);else n.attributes.length?e["#text"]=a.escape(a.innerXml(n)):e=a.escape(a.innerXml(n));else if(i)n.attributes.length?e["#text"]=a.escape(a.innerXml(n)):(e=a.escape(a.innerXml(n)),isNaN(e)||(e=parseFloat(e)));else if(l)if(l>1)e=a.escape(a.innerXml(n));else for(s=n.firstChild;s;s=s.nextSibling)e["#cdata"]=a.escape(s.nodeValue)}n.attributes.length||n.firstChild||(e=null)}else 9==n.nodeType?e=a.toObj(n.documentElement):alert("unhandled node type: "+n.nodeType);return e},toJson:function(n,e,t){var i=e?'"'+e+'"':"";if(n instanceof Array){for(var l=0,o=n.length;l<o;l++)n[l]=a.toJson(n[l],"",t+"\t");i+=(e?":[":"[")+(n.length>1?"\n"+t+"\t"+n.join(",\n"+t+"\t")+"\n"+t:n.join(""))+"]"}else if(null==n)i+=(e&&":")+"null";else if("object"==typeof n){var s=[];for(var r in n)s[s.length]=a.toJson(n[r],r,t+"\t");i+=(e?":{":"{")+(s.length>1?"\n"+t+"\t"+s.join(",\n"+t+"\t")+"\n"+t:s.join(""))+"}"}else i+="string"==typeof n?(e&&":")+'"'+n.toString()+'"':(e&&":")+n.toString();return i},innerXml:function(n){var e="";if("innerHTML"in n)e=n.innerHTML;else for(var a=function(n){var e="";if(1==n.nodeType){e+="<"+n.nodeName;for(var t=0;t<n.attributes.length;t++)e+=" "+n.attributes[t].nodeName+'="'+(n.attributes[t].nodeValue||"").toString()+'"';if(n.firstChild){e+=">";for(var i=n.firstChild;i;i=i.nextSibling)e+=a(i);e+="</"+n.nodeName+">"}else e+="/>"}else 3==n.nodeType?e+=n.nodeValue:4==n.nodeType&&(e+="<![CDATA["+n.nodeValue+"]]>");return e},t=n.firstChild;t;t=t.nextSibling)e+=a(t);return e},escape:function(n){return n.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(n){n.normalize();for(var e=n.firstChild;e;)if(3==e.nodeType)if(e.nodeValue.match(/[^ \f\n\r\t\v]/))e=e.nextSibling;else{var t=e.nextSibling;n.removeChild(e),e=t}else 1==e.nodeType?(a.removeWhite(e),e=e.nextSibling):e=e.nextSibling;return n}};return 9==n.nodeType&&(n=n.documentElement),a.toObj(a.removeWhite(n))}a.r(e),a.d(e,{xml2json:()=>t})},"./src/view/ConfirmVillageSpeedRemoveModal.ts":(n,e,a)=>{a.r(e),a.d(e,{ConfirmVillageSpeedRemoveModal:()=>i});var t=a("./src/core/Language.ts");const i=n=>`\n    <div class="modal-input-inline">\n        <h2>${(0,t.Lang)("removeQuestion")}</h2>\n    </div>\n    <div class="modal-input-inline">\n        <button class="btn" onclick="window.targetItem.confirmRemoveVillageBooster(${n})">${(0,t.Lang)("yes")}</button> \n        <button class="btn" onclick="window.closeModal()">${(0,t.Lang)("cancel")}</button>\n    </div>\n    `},"./src/view/addAttackModal.ts":(n,e,a)=>{a.r(e),a.d(e,{addAttackModal:()=>l});var t=a("./src/core/Api.ts"),i=a("./src/core/Language.ts");const l=()=>`\n    <div class="modal-input-inline">\n        <label for="attack">${(0,i.Lang)("attack")}:</label>\n        <input type="radio" value="attack" name="planner-operation" checked>\n        <label for="reinforce">${(0,i.Lang)("support")}:</label>\n        <input type="radio" value="reinforce" name="planner-operation">\n    </div>\n    <div class="modal-input-group">\n        <label for="planner-template">${(0,i.Lang)("template")}:</label>\n        <select id="planner-template" placeholder="${(0,i.Lang)("notSelected")}">\n            <option value="temp_all">${(0,i.Lang)("allUnit")}</option>\n            ${window.attackPlan.templates.map((n=>`<option value="${n.name}">${n.name}</option>`))}\n        </select>\n    </div>\n    <div class="modal-input-group">\n        <label for="planner-arrival">${(0,i.Lang)("arrival")}:</label>\n        <select id="planner-arrival" placeholder="${(0,i.Lang)("notSelected")}">\n            ${window.attackPlan.arrivals.map((n=>`<option value="${n}">${n}</option>`))}\n        </select>\n    </div>\n    <div class="modal-input-group">\n        <label for="planner-notes">${(0,i.Lang)("note")}:</label>\n        <input id="planner-notes" placeholder="${(0,i.Lang)("noNote")}">\n    </div>\n    <div class="modal-input-inline">\n        <button class="btn" onclick="window.addAttackConfirm()">${(0,i.Lang)("add")}</button> \n        <button class="btn" onclick="window.closeModal()">${(0,i.Lang)("cancel")}</button>\n    </div>\n    `;window.window.addAttackConfirm=()=>{let n=[],e=[];if(0==$('input[name="target"]:checked').get().length)return void window.UI.ErrorMessage((0,i.Lang)("noTargetSelected"));if(0==$(".launch-list").find("input:checked").get().length)return void window.UI.ErrorMessage((0,i.Lang)("noLauncherSelected"));let a=parseInt($('input[name="target"]:checked').val().toString()),t=$("#planner-template").val(),l=$('input[name="planner-operation"]:checked').val().toString(),o=$("#planner-arrival").val().toString(),s=$("#planner-notes").val().toString();console.log($(".launch-list").find("input:checked").get().length,a,t,l,o,s);let r=window.attackPlan.targetPool.findIndex((n=>n.village.id==a)),d=window.attackPlan.templates.findIndex((n=>n.name==t));$(".launch-list").find("input:checked").get().forEach((e=>{let a=parseInt($(e).val().toString()),i=window.attackPlan.launchPool.findIndex((n=>n.id==a)),c=null;d>-1&&(c=window.attackPlan.templates[d].units),"temp_all"==t&&(c=window.attackPlan.launchPool[i].unitsContain);let g=window.attackPlan.launchPool[i].id,p=window.addLauncher(r,i,c,l,o,s);console.log(p),p?$(".launch-list").find(`#${g}`).remove():n.push(window.attackPlan.launchPool[i])})),e.push(window.attackPlan.targetPool[r]),window.targetPoolQuery.partialRender(e,"village.id"),window.launchVillagesQuery.partialRender(n,"id"),$(".planner-modal").hide(),window.DB.savePlan(window.attackPlan)},window.addLauncher=(n,e,a,i,l,o)=>{console.log("addLauncher");let s={...window.attackPlan.launchPool[e]};return s.unitsContain={spear:0,sword:0,axe:0,archer:0,spy:0,light:0,marcher:0,heavy:0,ram:0,catapult:0,knight:0,snob:0},[s.unitsContain,window.attackPlan.launchPool[e].unitsContain]=(0,t.TroopTransaction)(s.unitsContain,window.attackPlan.launchPool[e].unitsContain,a),s.popSize=(0,t.calcUnitPop)(s.unitsContain),window.attackPlan.launchPool[e].popSize=(0,t.calcUnitPop)(window.attackPlan.launchPool[e].unitsContain),s.popSize>0&&window.attackPlan.targetPool[n].launchers.push({arrival:l,isAttack:"attack"==i,notes:o,unitSpeed:(0,t.getSlowestUnit)(s.unitsContain,"attack"==i),village:s}),0==window.attackPlan.launchPool[e].popSize&&(window.attackPlan.launchPool.splice(e,1),!0)}},"./src/view/addPlayerSpeedModal.ts":(n,e,a)=>{a.r(e),a.d(e,{addPlayerSpeedModal:()=>i});var t=a("./src/core/Language.ts");const i=()=>{let n=[];window.attackPlan.targetPool.forEach((e=>{n.includes(e.village.owner)||n.push(e.village.owner)}));let e=[];return n.forEach((n=>{let a=window.Players.find((e=>e.id==n));a&&-1==window.attackPlan.boosters.findIndex((n=>n.playerId==a.id))&&e.push(a)})),`\n    <div class="modal-input-group">\n        <select id="planner-player-boosts" size="5">\n           ${window.attackPlan.boosters.map((n=>`<option value="${n.playerId}">${n.player} (${n.value}%)</option>`))}\n        </select>\n        <button class="btn" onclick="window.removePlayerBoost()">${(0,t.Lang)("remove")}</button>\n    </div>\n\n    <div class="modal-input-group">\n        <select id="planner-player-select">\n           ${e.map((n=>`<option value="${n.id}">${n.name}</option>`))}\n        </select>\n        <label for="planner-player-boost">${(0,t.Lang)("boosterPct")}:</label>\n        <input id="planner-player-boost" type="number" max="60" min="1" placeholder="%">\n        <button class="btn" onclick="window.addPlayerBoost()">${(0,t.Lang)("add")}</button>\n    </div>\n    `};window.addPlayerBoost=()=>{if(""==$("#planner-player-boost").val())return;let n=parseInt($("#planner-player-select").val().toString()),e=parseInt($("#planner-player-boost").val().toString());if(0==e)return;let a=window.Players.find((e=>e.id==n));window.attackPlan.boosters.push({player:a.name,playerId:n,value:e}),window.DB.savePlan(window.attackPlan),$(".planner-modal-content").html(i())},window.removePlayerBoost=()=>{if(null==$("#planner-player-boosts").val())return;let n=parseInt($("#planner-player-boosts").val().toString()),e=window.attackPlan.boosters.findIndex((e=>e.playerId==n));window.attackPlan.boosters.splice(e,1),$(".planner-modal-content").html(i())}},"./src/view/addVillageSpeedModal.ts":(n,e,a)=>{a.r(e),a.d(e,{addVillageBoosterModal:()=>i});var t=a("./src/core/Language.ts");const i=n=>`\n    <div class="modal-input-group">\n        <label for="planner-notes">${(0,t.Lang)("boosterPct")}:</label>\n        <input id="planner-village-boost" type="number" max="60" min="1" placeholder="%">\n    </div>\n    <div class="modal-input-inline">\n        <button class="btn" onclick="window.targetItem.confirmAddVillageBooster(${n})">${(0,t.Lang)("yes")}</button> \n    </div>\n    `},"./src/view/autoAssignModal.ts":(n,e,a)=>{a.r(e),a.d(e,{autoAssignModal:()=>l});var t=a("./src/core/Api.ts"),i=a("./src/core/Language.ts");const l=()=>{let n="";return window.attackPlan.templates.forEach((e=>{n+=`\n            <option value='${e.name}'>${e.name}</option>\n        `})),`\n    <style>\n        .assigner-row {  display: grid;\n            display: grid;\n            grid-template-columns: 200px repeat(auto-fill, 80px) 10px;\n        }\n\n        .assigner-row input{\n            width:30px;\n        }\n\n        .item{\n            padding:5px;\n        }\n\n        .add-assignment{\n            width: 130px;\n        }\n\n        .add-assignment input{\n            width: 50px;\n        }\n\n        .assigner-target-villages{\n            width:1100px;\n            max-height:250px;\n            overflow-y:auto;\n            border: solid 1px #6c4824;\n            border-radius: 5px;\n            background-color:#fff5dc;\n        }\n\n        .assigner-target-villages .item{\n            border: solid 1px #6c4824;\n        }\n\n        .assigner-counter .item{\n            border: solid 1px #6c4824;\n        }\n\n        .assigner-counter .item:first-of-type{\n            border: none !important;\n        }\n\n        .assigner-counter .item:last-of-type{\n            border: none !important;\n        }\n\n\n        .assigner-target-btn{\n            display:block;\n            width: 20px;\n            height: 20px;\n            background: url(https://dshu.innogamescdn.com/asset/80b013af/graphic/login_close.png) top left no-repeat;\n            cursor: pointer;\n            background-size: 20px;\n            margin-right: 10px;\n        }\n\n        .assigner-date div{\n            transform: rotate(290deg) translateX(20px);\n            text-wrap: nowrap;\n        }\n\n        .assignment-alg{\n            margin:15px 0;\n            display: flex;\n            justify-content: center;\n        }\n\n        .add-assignment-input{\n            margin-bottom:5px;\n            display:grid;\n        }\n    </style>\n    \n    <div class="assigner">\n        <div class="add-assignment">\n            <div class="add-assignment-input">\n                <label>${(0,i.Lang)("date")}:</label>\n                <select id="assignmentArrival">\n                ${window.attackPlan.arrivals.map((n=>`<option value='${n}'>${n}</option>`)).join("")}\n                </select>\n            </div>\n            <div class="add-assignment-input">\n                <label>${(0,i.Lang)("template")}:</label>\n                <select id="assignmentTemplates">\n                    ${n}\n                </select>\n            </div>\n            <div class="add-assignment-input">\n                <label>${(0,i.Lang)("qntt")}:</label>\n                <input min="1" value="1" id="assigner-number-filter" type="number" disabled>\n                <input id="assigner-max-filter" onclick="$('#assigner-number-filter').prop('disabled', (i, v) => !v);" type="checkbox" checked>\n            </div>\n            \n            <button class="btn" onclick="autoAssign.addAssignment()">+ ${(0,i.Lang)("add")}</button>\n        </div>\n        <div class="assigner-header">\n            <div class="assigner-row assigner-date">\n                    <div class="item"></div>\n                    <div class="item checkbox"></div>\n            </div>\n            <div class="assigner-row assigner-remover">\n                    <div class="item"></div>\n                    <div class="item checkbox"></div>\n            </div>\n            <div class="assigner-row assigner-loader">\n                    <div class="item"></div>\n                    <div class="item checkbox"></div>\n            </div>\n            <div class="assigner-row assigner-name">\n                <div class="item">${(0,i.Lang)("village")} (${window.attackPlan.targetPool.length})</div>\n                <div class="item checkbox">\n                    <input id="assigner-main-checkbox" onclick="autoAssign.checkAll()" type="checkbox">\n                </div>\n            </div>  \n        </div>\n        <div class="assigner-target-villages">\n            ${window.attackPlan.targetPool.map((n=>`\n                <div class="assigner-row" id="assigner-row-${n.village.id}">\n                    <div class="item"><a target="_blank" href="/game.php?village=${t.game.village.id}&screen=info_village&id=${n.village.id}">${n.village.name}(${n.village.coord.text}) K${n.village.kontinent}</a></div>\n                    <div class="item checkbox">\n                        <input class="assigner-target-check" value="${n.village.id}" type="checkbox">\n                    </div>\n                </div>\n            `)).join("")}\n        </div>\n        <div class="assigner-row assigner-counter">\n            <div class="item"></div>\n            <div class="item checkbox"></div>\n        </div>\n        <div class="assignment-alg">\n            <input id="evenDistributeClosest" value="1" type="radio" name="assignmentAlg"><label for="evenDistributeClosest">${(0,i.Lang)("even")}</label>\n            <input id="oneByOneQ" value="2" type="radio" name="assignmentAlg"><label for="oneByOneQ">${(0,i.Lang)("oneByOne")}</label>\n            <input id="oneByOneClosest" value="3"  type="radio" name="assignmentAlg"><label for="oneByOneClosest">${(0,i.Lang)("oneByOneClosest")}</label>\n            <input id="closestToTarget" value="4" type="radio" name="assignmentAlg"><label for="closestToTarget">${(0,i.Lang)("closestToTarget")}</label>\n        </div>\n        <div>\n            <button style="margin: 0 auto; display: block;" onclick="autoAssign.startAssignment()" class="btn">${(0,i.Lang)("startAssignment")}</button>\n        </div>\n        \n    </div>\n    <div id="dialog-loading" style="display: none;justify-content: center;width: 100%;">\n        <img style="height:25px" src="https://dshu.innogamescdn.com/asset/6389cdba/graphic/loading.gif"><span style="padding:5px">${(0,i.Lang)("assigningAttacks")}...</span>\n    </div>\n    `};function o(n,e){let a=[];for(let i=0;i<window.autoAssign.launchPoolCopy.length;i++){const l=window.autoAssign.launchPoolCopy[i];if(a.length>=e)break;if((0,t.hasAvailableTroops)(l,n.units)){let e={...l};e.unitsContain={spear:0,sword:0,axe:0,archer:0,spy:0,light:0,marcher:0,heavy:0,ram:0,catapult:0,knight:0,snob:0},[e.unitsContain,l.unitsContain]=(0,t.TroopTransaction)(e.unitsContain,l.unitsContain,n.units),n.units.snob>0&&(n.units.marcher<0&&(l.unitsContain.marcher=0),n.units.light<0&&(l.unitsContain.light=0),n.units.axe<0&&(l.unitsContain.axe=0)),e.popSize=(0,t.calcUnitPop)(e.unitsContain),l.popSize=(0,t.calcUnitPop)(l.unitsContain),a.push(e),0==l.popSize&&(console.log("removed"),window.autoAssign.launchPoolCopy.splice(i,1))}}return a}window.autoAssign={assignTypes:[],launchPoolCopy:[],removeAssignment:n=>{let e=window.autoAssign.assignTypes.findIndex((e=>e.id==n.toString()));-1!=e&&(window.autoAssign.assignTypes[e].filtered.forEach((n=>{let a=window.autoAssign.launchPoolCopy.findIndex((e=>e.id==n.id));-1==a?window.autoAssign.launchPoolCopy.push(n):(window.autoAssign.assignTypes[e].template.units.snob>0&&(window.autoAssign.assignTypes[e].template.units.marcher<0&&(n.unitsContain.marcher-=window.autoAssign.assignTypes[e].template.units.marcher),window.autoAssign.assignTypes[e].template.units.light<0&&(n.unitsContain.light-=window.autoAssign.assignTypes[e].template.units.light),window.autoAssign.assignTypes[e].template.units.axe<0&&(n.unitsContain.axe-=window.autoAssign.assignTypes[e].template.units.axe)),[window.autoAssign.launchPoolCopy[a].unitsContain,n.unitsContain]=(0,t.TroopTransaction)(window.autoAssign.launchPoolCopy[a].unitsContain,n.unitsContain,n.unitsContain))})),window.autoAssign.assignTypes.splice(e,1),$(".ar-"+n).remove())},fillAssignment:n=>{$(".assigner-target-villages .assigner-target-check").get().forEach((e=>{if(!$(e).is(":checked"))return;let a=$(`.assigner-loader .ar-${n}`).find(".ass-inp").val();$(e).parent().parent().find(`.ar-${n} .ass-inp`).val(a)})),window.autoAssign.updateCount(n)},addAssignment:()=>{if(window.autoAssign.assignTypes.length>=10)return;let n=$("#assignmentArrival").val().toString(),e=99999;$("#assigner-max-filter").is(":checked")||(e=parseInt($("#assigner-number-filter").val().toString()));let a=$("#assignmentTemplates").val().toString(),t=window.attackPlan.templates.find((n=>n.name==a)),i={id:(new Date).getTime().toString(),arrival:n,filtered:o(t,e),required:0,template:t,max:e};window.autoAssign.assignTypes.push(i),$(".assigner-header .assigner-loader .checkbox").before(`<div class="item ar-${i.id}" >\n        <input class="ass-inp" value="0" type="number" min="0">\n        <button onclick="autoAssign.fillAssignment(${i.id})">↓</button></div>\n        `),$(".assigner-header .assigner-name .checkbox").before(`\n            <div class="item ar-${i.id}" >${i.template.name}</div>\n        `),$(".assigner-header .assigner-remover .checkbox").before(`\n            <div class="item ar-${i.id}" ><a onclick="autoAssign.removeAssignment(${i.id})" class="assigner-target-btn"></a></div>\n        `),$(".assigner-header .assigner-date .checkbox").before(`\n        <div class="item ar-${i.id}" >${i.arrival}</div>\n        `),$(".assigner-target-villages").find(".assigner-row").get().forEach((n=>{$(n).find(".checkbox").before(`<div class="item ar-${i.id}" >\n                <input class="ass-inp" \n                onchange="autoAssign.updateCount(${i.id})" \n                onkeyup="autoAssign.updateCount(${i.id})" \n                value="0" type="number" min="0"></div>`)})),$(".assigner-counter .checkbox").before(`\n        <div class="item ar-${i.id}" ><span class="cnt-actual">0</span>/${i.filtered.length}</div>\n        `),console.log(window.autoAssign.assignTypes)},startAssignment:()=>{let n=$('input[name="assignmentAlg"]:checked').val();n?0!=window.autoAssign.assignTypes.length?($("#dialog-loading").show(),$("#plannerCloseBtn").hide(),$(".assigner").hide(),setTimeout((()=>{switch(n){case"1":window.autoAssign.assignTypes.forEach(((n,e)=>{let a=0;for(;n.filtered.length>0&&n.required>a;)for(let i=0;i<window.attackPlan.targetPool.length;i++){const l=window.attackPlan.targetPool[i];let o=0;for(let n=0;n<e+1;n++)o+=parseInt($(`#assigner-row-${l.village.id} .ar-${window.autoAssign.assignTypes[n].id} .ass-inp`).val().toString());if(console.log(o),l.launchers.length<o){let e=-1,o=999999;if(n.filtered.forEach(((n,a)=>{let i=(0,t.coordDistance)(n,l.village);i<o&&(e=a,o=i)})),e>-1){a++,console.log(a,n.required);let t=window.attackPlan.launchPool.findIndex((a=>a.id==n.filtered[e].id));window.addLauncher(i,t,n.template.units,"attack",n.arrival,""),n.filtered.splice(e,1)}}}}));break;case"2":!function(){for(let n=0;n<window.attackPlan.targetPool.length;n++){const e=window.attackPlan.targetPool[n];for(let a=0;a<window.autoAssign.assignTypes.length;a++){const i=window.autoAssign.assignTypes[a];if(0==i.filtered.length)continue;let l=parseInt($(`#assigner-row-${e.village.id} .ar-${i.id} .ass-inp`).val().toString());for(let a=0;a<l;a++){let a=-1,l=999999;if(i.filtered.forEach(((n,i)=>{let o=(0,t.coordDistance)(n,e.village);o<l&&(a=i,l=o)})),a>-1){let e=window.attackPlan.launchPool.findIndex((n=>n.id==i.filtered[a].id));window.addLauncher(n,e,i.template.units,"attack",i.arrival,""),i.filtered.splice(a,1)}}}}}();break;case"3":!function(){for(let n=0;n<window.attackPlan.targetPool.length;n++){const e=window.attackPlan.targetPool[n];for(let a=0;a<window.autoAssign.assignTypes.length;a++){const t=window.autoAssign.assignTypes[a];if(0==t.filtered.length)continue;let i=parseInt($(`#assigner-row-${e.village.id} .ar-${t.id} .ass-inp`).val().toString());for(let e=0;e<i;e++){let e=window.attackPlan.launchPool.findIndex((n=>n.id==t.filtered[0].id));window.addLauncher(n,e,t.template.units,"attack",t.arrival,""),t.filtered.splice(0,1)}}}}();break;case"4":!function(){let n=[];for(let e=0;e<window.autoAssign.assignTypes.length;e++){const a=window.autoAssign.assignTypes[e];if(0!=a.filtered.length)for(let i=0;i<a.filtered.length;i++){const l=a.filtered[i];let o=-1,s=999999;for(let a=0;a<window.attackPlan.targetPool.length;a++){const i=window.attackPlan.targetPool[a];let r=n.findIndex((n=>n.id==i.village.id)),d=0;for(let n=0;n<e+1;n++)d+=parseInt($(`#assigner-row-${i.village.id} .ar-${window.autoAssign.assignTypes[n].id} .ass-inp`).val().toString());if(console.log(d),r>-1&&n[r].cnt>=d)continue;let c=(0,t.coordDistance)(l,i.village);c<s&&(o=a,s=c)}if(o>-1){let e=n.findIndex((n=>n.id==window.attackPlan.targetPool[o].village.id));-1==e?n.push({id:window.attackPlan.targetPool[o].village.id,cnt:1}):n[e].cnt++;let t=window.attackPlan.launchPool.findIndex((n=>n.id==a.filtered[i].id));window.addLauncher(o,t,a.template.units,"attack",a.arrival,""),a.filtered.splice(i,1)}}}}()}window.targetPoolQuery.resetAll(),window.launchVillagesQuery.resetAll(),window.closeModal()}),200)):window.UI.ErrorMessage((0,i.Lang)("noAttackAssigned")):window.UI.ErrorMessage((0,i.Lang)("noAlgSelected"))},checkAll:()=>{$(".assigner-target-villages").find("input[type=checkbox]").get().forEach((n=>{$(n).prop("checked",$("#assigner-main-checkbox").prop("checked"))}))},updateCount:n=>{let e=0;$(`.assigner-target-villages .ar-${n} .ass-inp`).get().forEach((n=>{let a=$(n).val();e+=parseInt(a.toString().split("x")[0])})),console.log(n,e);let a=window.autoAssign.assignTypes.findIndex((e=>e.id==n.toString()));window.autoAssign.assignTypes[a].required=e,$(`.assigner-counter .ar-${n} .cnt-actual`).text(e)}}},"./src/view/calculatedAttackModal.ts":(n,e,a)=>{a.r(e),a.d(e,{calculatedAttackModal:()=>l,generateLaunchText:()=>o});var t=a("./src/core/Api.ts"),i=a("./src/core/Language.ts");const l=()=>(setTimeout((()=>{!function(){let n=[];window.attackPlan.targetPool.forEach((e=>{let a=window.attackPlan.boosters.findIndex((n=>n.playerId==e.village.owner));e.launchers.forEach((i=>{let l=1;a>-1&&(e.booster=window.attackPlan.boosters[a].value),i.isAttack||(l+=e.booster/100);let o=60*i.unitSpeed.value,s=new Date(i.arrival),r=new Date(s.valueOf()-Math.round(1e3*o/window.gameConfig.speed/(window.gameConfig.unit_speed*l)*(0,t.coordDistance)(i.village,e.village))),d=new Intl.DateTimeFormat("hu-hu",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).format(r),c="";Object.keys(e.village.unitsContain).forEach((n=>{i.village.unitsContain[n]>0&&(c+=`&${n}=${i.village.unitsContain[n]}`)})),n.push({launchDate:d,launchLink:`https://${window.location.host}/game.php?village=${i.village.id}&screen=place&target=${e.village.id}${c}`,unitSpeed:i.unitSpeed,villageFrom:i.village,villageTo:e.village,note:i.notes,isAttack:i.isAttack})}))})),console.log(n),n.sort(((n,e)=>n.launchDate>e.launchDate?1:-1));let{bbcode:e,html:a}=o(n);$(".bb-field").html(e),$(".inApp-field").html(a),console.log(e,a),$("#dialog-loading").hide(),$(".modal-input-inline").show()}()}),2e3),`\n    <div id="dialog-loading">\n            <img style="height:25px" src="https://dshu.innogamescdn.com/asset/6389cdba/graphic/loading.gif"><span style="padding:5px">${(0,i.Lang)("calculaing")}...</span>\n    </div>\n    <div class="modal-input-inline" style="display:none">\n        <label for="bb">${(0,i.Lang)("bbCode")}:</label>\n        <input onclick="window.changeDisplayType()" type="radio" id="bb" value="bb" name="showType" >\n        <label for="inapp">In-app:</label>\n        <input onclick="window.changeDisplayType()" type="radio" id="inapp" value="inapp" name="showType" checked>\n        <div class="bb-field" style="display:none"></div>\n        <div class="inApp-field" style="max-height:600px; overflow-y: auto;">\n        </div>\n    </div>\n    `);function o(n){let e=0,a=`<textarea style="resize: none;height:100px;width:400px;">[table][**] [||][building]barracks[/building][||]${(0,i.Lang)("launch")}[||]${(0,i.Lang)("target")}[||]${(0,i.Lang)("command")}[||]${(0,i.Lang)("note")}[/**]`,l="",o=`<table class="vis"><tr><th></th><th></th><th>${(0,i.Lang)("launch")}</th><th>${(0,i.Lang)("target")}</th><th>${(0,i.Lang)("command")}</th><th>${(0,i.Lang)("note")}</th></tr>`;for(let s=0;s<n.length;s++){let r=`[*]#${s+1}[|][unit]${n[s].unitSpeed.key}[/unit][|][b]${n[s].launchDate}[/b][|] ${n[s].villageTo.coord.text} [|][url=${n[s].launchLink}]${n[s].isAttack?(0,i.Lang)("attack"):(0,i.Lang)("support")}[/url][|]${n[s].note}`;e+r.length+19>=6e4&&(e=0,l+="[/table]</textarea>"),0==e&&(l+=`1.${(0,i.Lang)("page")}<br>`+a,e+=a.length),l+=r,e+=r.length,o+=`<tr><td>#${s+1}</td><td><img src="/graphic/unit/unit_${n[s].unitSpeed.key}.png"></td><td>${n[s].launchDate}</td><td><a target="_blank" href="/game.php?village=${t.game.village.id}&screen=info_village&id=${n[s].villageTo.id}">${n[s].villageTo.name} (${n[s].villageTo.coord.text}) </a></td><td><a href="${n[s].launchLink}">${n[s].isAttack?(0,i.Lang)("attack"):(0,i.Lang)("support")}</a></td><td>${n[s].note}</td></tr>`}return o+="</table>",console.log(l,o),{bbcode:l,html:o}}window.changeDisplayType=()=>{"bb"==$("input[name=showType]:checked").val()?($(".bb-field").show(),$(".inApp-field").hide()):($(".bb-field").hide(),$(".inApp-field").show())}},"./src/view/confirmCalculateAttackModal.ts":(n,e,a)=>{a.r(e),a.d(e,{confirmCalculateAttackModal:()=>i});var t=a("./src/core/Language.ts");const i=()=>`\n    <div class="modal-input-inline">\n        <h2>${(0,t.Lang)("calculateQuestion")}</h2>\n    </div>\n    <div class="modal-input-inline">\n        <button class="btn" onclick="window.confirmCalculateAttack()">${(0,t.Lang)("yes")}</button> \n        <button class="btn" onclick="window.closeModal()">${(0,t.Lang)("cancel")}</button>\n    </div>\n    `},"./src/view/confirmRemoveModal.ts":(n,e,a)=>{a.r(e),a.d(e,{confirmRemoveModal:()=>i});var t=a("./src/core/Language.ts");const i=(n,e)=>`\n    <div class="modal-input-inline">\n        <h2>${(0,t.Lang)("removeQuestion")}</h2>\n    </div>\n    <div class="modal-input-inline">\n        <button class="btn" onclick="window.targetItem.confirmRemoveTargetLauncherItem(${n},${e})">${(0,t.Lang)("yes")}</button> \n        <button class="btn" onclick="window.closeModal()">${(0,t.Lang)("cancel")}</button>\n    </div>\n    `},"./src/view/confirmRemoveTargetModal.ts":(n,e,a)=>{a.r(e),a.d(e,{confirmRemoveTargetModal:()=>i});var t=a("./src/core/Language.ts");const i=n=>`\n    <div class="modal-input-inline">\n        <h2>${(0,t.Lang)("removeQuestion")}</h2>\n    </div>\n    <div class="modal-input-inline">\n        <button class="btn" onclick="window.targetItem.confirmRemoveTargetItem(${n})">${(0,t.Lang)("yes")}</button> \n        <button class="btn" onclick="window.closeModal()">${(0,t.Lang)("cancel")}</button>\n    </div>\n    `},"./src/view/confirmResetAssignmentsModal.ts":(n,e,a)=>{a.r(e),a.d(e,{confirmResetAssignmentsModal:()=>l});var t=a("./src/core/Api.ts"),i=a("./src/core/Language.ts");const l=()=>`\n    <div class="modal-input-inline">\n        <h2>${(0,i.Lang)("resetAttackQuestion")}</h2>\n    </div>\n    <div class="modal-input-inline">\n        <button class="btn" onclick="window.finalResetAssignments()">${(0,i.Lang)("yes")}</button>\n    </div>\n    `;window.finalResetAssignments=()=>{window.attackPlan.targetPool.forEach((n=>{n.isSelected=!1,n.isOpen=!1,n.launchers.forEach((n=>{let e=window.attackPlan.launchPool.findIndex((e=>e.id==n.village.id));-1==e?window.attackPlan.launchPool.push({...n.village}):[window.attackPlan.launchPool[e].unitsContain,n.village.unitsContain]=(0,t.TroopTransaction)(window.attackPlan.launchPool[e].unitsContain,n.village.unitsContain,n.village.unitsContain)})),n.launchers=[]})),window.closeModal(),window.launchVillagesQuery.resetAll(),window.targetPoolQuery.resetAll(),window.DB.savePlan(window.attackPlan)}},"./src/view/editArrivalsModal.ts":(n,e,a)=>{a.r(e),a.d(e,{editArrivalsModal:()=>i});var t=a("./src/core/Language.ts");const i=n=>(window.editArrivalsModal.arrivalsRef=n,`\n    <div class="modal-input-group">\n        <label for="">${(0,t.Lang)("arrivals")}:</label>\n        <select id="plan_arrivals_select" size="5">\n        ${n.map((n=>`\n            <option value="${n}">${n}</option>\n            `)).join("")}\n        </select>\n        <input id="plan_arrivals_input" type="datetime-local" type="text" step="1"/>\n    </div>\n    <div class="modal-input-inline">\n        <button class="btn" onclick="editArrivalsModal.addArrival()" >${(0,t.Lang)("add")}</button>\n        <button class="btn" onclick="editArrivalsModal.removeArrival()">${(0,t.Lang)("remove")}</button>\n    </div>\n    `);window.editArrivalsModal={addArrival:()=>{let n=$("#plan_arrivals_input").val().toString().replace("T"," ");if(""==n)return;window.editArrivalsModal.arrivalsRef.includes(n)||window.editArrivalsModal.arrivalsRef.push(n),window.editArrivalsModal.arrivalsRef.sort(((n,e)=>n>e?1:-1));let e="";window.editArrivalsModal.arrivalsRef.forEach((n=>{e+=`<option value="${n}">${n}</option>`})),$("#plan_arrivals_select").html(e),1==$(".mainWindow").get().length?window.DB.savePlan(window.attackPlan):window.launchDialog.stepCheck()},removeArrival:()=>{let n=$("#plan_arrivals_select").val().toString().replace("T"," ");if(console.log(n),""==n)return;let e=window.editArrivalsModal.arrivalsRef.findIndex((e=>e==n));e>-1&&window.editArrivalsModal.arrivalsRef.splice(e,1);let a="";window.editArrivalsModal.arrivalsRef.forEach((n=>{a+=`<option value="${n}">${n}</option>`})),$("#plan_arrivals_select").html(a),1==$(".mainWindow").get().length?window.DB.savePlan(window.attackPlan):window.launchDialog.stepCheck()}}},"./src/view/editLaunchVillagesModal.ts":(n,e,a)=>{a.r(e),a.d(e,{editLaunchVillagesModal:()=>i});var t=a("./src/core/Language.ts");const i=n=>`\n        <label for="">${(0,t.Lang)("launchers")}:</label><br>\n        <select id="plan_launcher_list" size="5">\n        </select>\n        <select id="plan_launcher_select" style="font-size:16px" >\n            ${window.Groups.map((n=>`<option value="${n.id}">${n.name}</option>`)).join("")}\n        </select>\n        <div>\n            <button class="btn" onclick="editLaunchVillagesModal.addGroup()" >${(0,t.Lang)("add")}</button>\n            <button class="btn" onclick="editLaunchVillagesModal.removeGroup()" >${(0,t.Lang)("remove")}</button>\n        </div>\n    `;window.editLaunchVillagesModal={addGroup:()=>{let n=parseInt($("#plan_launcher_select").val().toString());if(window.launchDialog.groupIDs.findIndex((e=>e.id==n))>-1)return;window.launchDialog.groupIDs.push({id:n,name:$("#plan_launcher_select option:selected").text()});let e="";window.launchDialog.groupIDs.forEach((n=>{e+=`<option value="${n.id}">${n.name}</option>`})),$("#plan_launcher_list").html(e),window.launchDialog.stepCheck()},removeGroup:()=>{let n=parseInt($("#plan_launcher_list").val().toString()),e=window.launchDialog.groupIDs.findIndex((e=>e.id==n));window.launchDialog.groupIDs.splice(e,1);let a="";window.launchDialog.groupIDs.forEach((n=>{a+=`<option value="${n.id}">${n.name}</option>`})),$("#plan_launcher_list").html(a),window.launchDialog.stepCheck()}}},"./src/view/editPlanNameModal.ts":(n,e,a)=>{a.r(e),a.d(e,{editPlanNameModal:()=>i});var t=a("./src/core/Language.ts");const i=n=>(window.editPlanNameModal.planRef=n,`\n        <label for="plan_name_input" >${(0,t.Lang)("planName")}:</label><br>\n        <input maxlength="20" value="${window.editPlanNameModal.planRef.name}" onkeyup="window.editPlanNameModal.saveName()" id="plan_name_input" type="text"/>\n    `);window.editPlanNameModal={saveName:()=>{let n=$("#plan_name_input").val().toString();n=n.substring(0,20).trim(),window.editPlanNameModal.planRef.name=n,$("#open-plan-name").get().length>0&&$("#open-plan-name").text(n),1==$(".mainWindow").get().length?window.DB.savePlan(window.attackPlan):window.launchDialog.stepCheck()}}},"./src/view/editTargetModal.ts":(n,e,a)=>{a.r(e),a.d(e,{editTargetModal:()=>l});var t=a("./src/core/Api.ts"),i=a("./src/core/Language.ts");const l=n=>(window.editTargetModal.targetRef=n,`\n    <div class="modal-input-group">\n    <label for="target-select">${(0,i.Lang)("targets")} (<span id="modal-targets-cnt">${n.length}</span>):</label>\n    <select id="target-select" size="5" multiple>\n        ${n.map((n=>`\n            <option value="${n.village.id}">${n.village.name} (${n.village.coord.text}) K${n.village.kontinent}</option>\n            `)).join("")}\n    </select>\n    </div>\n    <div class="modal-input-group">\n        <label for="">${(0,i.Lang)("newTargets")}:</label><br>\n        <textarea id="plan_targets" size="10"></textarea>\n    </div>\n    <div class="modal-input-inline">\n        <button class="btn" onclick="editTargetModal.addTargets()">${(0,i.Lang)("add")}</button>\n        <button class="btn" onclick="editTargetModal.removeTargets()">${(0,i.Lang)("remove")}</button>\n    </div>\n    `);window.editTargetModal={addTargets:()=>{let n=$("#plan_targets").val().toString();console.log(n);let e=Array.from(n.matchAll(/([0-9]{1,3}).([0-9]{1,3})/g));console.log(e),e.forEach((n=>{let e=n[1]+"|"+n[2],a=window.Villages.find((n=>n.coord.text==e)),t=window.editTargetModal.targetRef.findIndex((n=>n.village.coord.text==e));a&&-1==t&&window.editTargetModal.targetRef.push({booster:0,launchers:[],village:a,isOpen:!1,isSelected:!1})})),$("#plan_targets").val(""),$("#modal-targets-cnt").text(window.editTargetModal.targetRef.length),$("#target-select").html(window.editTargetModal.targetRef.map((n=>`\n            <option value="${n.village.id}">${n.village.name} (${n.village.coord.text}) K${n.village.kontinent}</option>\n            `)).join("")),1==$(".mainWindow").get().length?(window.DB.savePlan(window.attackPlan),window.targetPoolQuery.resetAll()):window.launchDialog.stepCheck()},removeTargets:()=>{$("#target-select").val().toString().split(",").forEach((n=>{let e=window.editTargetModal.targetRef.findIndex((e=>e.village.id==parseInt(n)));1==$(".mainWindow").get().length&&window.editTargetModal.targetRef[e].launchers.forEach((n=>{let e=window.attackPlan.launchPool.findIndex((e=>e.id==n.village.id));-1==e?window.attackPlan.launchPool.push({...n.village}):[window.attackPlan.launchPool[e].unitsContain,n.village.unitsContain]=(0,t.TroopTransaction)(window.attackPlan.launchPool[e].unitsContain,n.village.unitsContain,n.village.unitsContain)})),window.editTargetModal.targetRef.splice(e,1)})),$("#target-select").html(window.editTargetModal.targetRef.map((n=>`\n            <option value="${n.village.id}">${n.village.name} (${n.village.coord.text}) K${n.village.kontinent}</option>\n            `)).join("")),1==$(".mainWindow").get().length&&(window.targetPoolQuery.resetAll(),window.launchVillagesQuery.resetAll())},targetRef:[]}},"./src/view/editTemplatesModal.ts":(n,e,a)=>{a.r(e),a.d(e,{editTemplatesModal:()=>i});var t=a("./src/core/Language.ts");const i=n=>(window.templateModal.templateRef=n,`\n        <style>\n            .template-editor {  \n            margin: 0 auto;\n            display: grid;\n            grid-template-columns: 100px 100px;\n            grid-template-rows: max-content 35px max-content max-content;\n            text-align:center;\n            gap: 10px 0px;\n            grid-auto-flow: row;\n            grid-template-areas:\n                "template-select-box template-select-box"\n                "template-buttons template-buttons"\n                "template-infantry template-calvary"\n                "template-machines template-other";\n            }\n            .template-select-box { grid-area: template-select-box; display:grid; }\n            .template-calvary { grid-area: template-calvary; }\n            .template-machines { grid-area: template-machines; }\n            .template-other { grid-area: template-other; }\n            .template-buttons{ grid-area: template-buttons; }\n            .template-infantry { grid-area: template-infantry; }\n            .template-input-group{\n                margin-top:5px;\n            }\n\n            .template-editor option {\n                font-size: 16px;\n                padding: 2px 5px;\n                text-align: center;\n            }\n            .template-unitsInput {\n                width: 45px;\n            }\n\n        </style>\n        <div class="template-editor">\n            <div class="template-select-box">\n                <label for="template_select">${(0,t.Lang)("templates")}:</label>\n                <select onclick="templateModal.selectTemplate()" id="template_select" size="5">\n                    ${n.map((n=>`\n                        <option value="${n.name}">${n.name}</option>\n                        `))}\n                </select>\n                <label for="temp_name">${(0,t.Lang)("name")}:</label>\n                <input id="temp_name" type="text" />\n            </div>\n            <div class="template-infantry">\n                <div class="template-input-group">\n                    <img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_spear.png" >\n                    <input id="palnner_unit_input_spear" type="number" tabindex="1" value="0" class="template-unitsInput"><br>\n                    <input onclick="templateModal.selectAll('spear')" id="max_spear" type="checkbox"> ${(0,t.Lang)("all")}\n                </div>\n                <div class="template-input-group">\n                    <img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_sword.png" >\n                    <input id="palnner_unit_input_sword" type="number" tabindex="1" value="0" class="template-unitsInput"><br>\n                    <input onclick="templateModal.selectAll('sword')" id="max_sword" type="checkbox"> ${(0,t.Lang)("all")}\n                </div>\n                <div class="template-input-group">\n                    <img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_axe.png" >\n                    <input id="palnner_unit_input_axe" type="number" tabindex="1" value="0" class="template-unitsInput"><br>\n                    <input onclick="templateModal.selectAll('axe')" id="max_axe" type="checkbox"> ${(0,t.Lang)("all")}\n                </div>\n                <div class="template-input-group" ${0==window.gameConfig.game.archer&&'style="display:none;"'} >\n                    <img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_archer.png" >\n                    <input id="palnner_unit_input_archer" type="number" tabindex="1" value="0" class="template-unitsInput"><br>\n                    <input onclick="templateModal.selectAll('archer')" id="max_archer" type="checkbox"> ${(0,t.Lang)("all")}\n                </div>\n            </div>\n            <div class="template-calvary">\n                <div class="template-input-group">\n                    <img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_spy.png" >\n                    <input id="palnner_unit_input_spy" type="number" tabindex="1" value="0" class="template-unitsInput"><br>\n                    <input onclick="templateModal.selectAll('spy')" id="max_spy" type="checkbox"> ${(0,t.Lang)("all")}\n                </div>\n                <div class="template-input-group">\n                    <img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_light.png" >\n                    <input id="palnner_unit_input_light" type="number" tabindex="1" value="0" class="template-unitsInput"><br>\n                    <input onclick="templateModal.selectAll('light')" id="max_light" type="checkbox"> ${(0,t.Lang)("all")}\n                </div>\n                <div class="template-input-group" ${0==window.gameConfig.game.archer&&'style="display:none;"'}>\n                    <img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_marcher.png" >\n                    <input id="palnner_unit_input_marcher" type="number" tabindex="1" value="0" class="template-unitsInput"><br>\n                    <input onclick="templateModal.selectAll('marcher')" id="max_marcher" type="checkbox"> ${(0,t.Lang)("all")}\n                </div>\n                <div class="template-input-group">\n                    <img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_heavy.png" >\n                    <input id="palnner_unit_input_heavy" type="number" tabindex="1" value="0" class="template-unitsInput"><br>\n                    <input onclick="templateModal.selectAll('heavy')" id="max_heavy" type="checkbox"> ${(0,t.Lang)("all")}\n                </div>    \n            </div>\n            <div class="template-machines">\n                <div class="template-input-group">\n                    <img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_ram.png" >\n                    <input id="palnner_unit_input_ram" type="number" tabindex="1" value="0" class="template-unitsInput"><br>\n                    <input onclick="templateModal.selectAll('ram')" id="max_ram" type="checkbox"> ${(0,t.Lang)("all")}\n                </div>\n                <div class="template-input-group">\n                    <img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_catapult.png" >\n                    <input id="palnner_unit_input_catapult"  type="number" tabindex="1" value="0" class="template-unitsInput"><br>\n                    <input onclick="templateModal.selectAll('catapult')" id="max_catapult" type="checkbox"> ${(0,t.Lang)("all")}\n                </div>\n            </div>\n            <div class="template-other">\n                <div class="template-input-group">\n                    <img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_knight.png" >\n                    <input id="palnner_unit_input_knight" type="number" tabindex="1" value="0" class="template-unitsInput"><br>\n                    <input onclick="templateModal.selectAll('knight')" id="max_knight" type="checkbox"> ${(0,t.Lang)("all")}\n                </div>\n                <div class="template-input-group">\n                    <img src="https://dshu.innogamescdn.com/asset/31698b62/graphic/unit/unit_snob.png" >\n                    <input id="palnner_unit_input_snob" type="number" tabindex="1" value="0" class="template-unitsInput"><br>\n                    <input onclick="templateModal.selectAll('snob')" id="max_snob" type="checkbox"> ${(0,t.Lang)("all")}\n                </div>\n            </div>\n            <div class="template-buttons">\n                <button class="btn" onclick="templateModal.addTemplate()">${(0,t.Lang)("add")}</button>\n                <button class="btn" onclick="templateModal.removeTemplate()">${(0,t.Lang)("remove")}</button>\n            </div>\n        </div>\n    `);window.templateModal={templateRef:[],addTemplate:()=>{if($("#temp_name").val().toString().length>10)return;let n={name:$("#temp_name").val().toString(),units:{spear:0,sword:0,archer:0,axe:0,spy:0,light:0,marcher:0,heavy:0,ram:0,catapult:0,knight:0,snob:0}};if(Object.keys(n.units).forEach((e=>{let a=parseInt($(`#palnner_unit_input_${e}`).val().toString());console.log($(`#max_${e}`).is(":checked")),$(`#max_${e}`).is(":checked")&&(a=99999),null==a&&(a=0),n.units[e]=a})),console.log(n),""==n.name)return;let e=window.templateModal.templateRef.findIndex((e=>e.name==n.name));e>-1?window.templateModal.templateRef[e]=n:window.templateModal.templateRef.push(n),$("#temp_name").val(""),Object.keys(n.units).forEach((n=>{$(`#palnner_unit_input_${n}`).val("0"),$(`#palnner_unit_input_${n}`).prop("disabled",!1),$(`#max_${n}`).prop("checked",!1)}));let a="";window.templateModal.templateRef.forEach((n=>{a+=`<option value="${n.name}">${n.name}</option>`})),$("#template_select").html(a),1==$(".mainWindow").get().length?window.DB.savePlan(window.attackPlan):window.launchDialog.stepCheck()},removeTemplate:()=>{let n=$("#template_select").val(),e=window.templateModal.templateRef.findIndex((e=>e.name==n));e>-1&&window.templateModal.templateRef.splice(e,1);let a="";window.templateModal.templateRef.forEach((n=>{a+=`<option value="${n.name}">${n.name}</option>`})),$("#template_select").html(a),1==$(".mainWindow").get().length?window.DB.savePlan(window.attackPlan):window.launchDialog.stepCheck()},selectTemplate:()=>{let n=$("#template_select").val(),e=window.templateModal.templateRef.findIndex((e=>e.name==n));if(console.log(e,n,window.templateModal.templateRef),e>-1){let n=window.templateModal.templateRef[e];console.log(n),$("#temp_name").val(n.name),Object.keys(n.units).forEach((e=>{let a=n.units[e];99999==a?($(`#max_${e}`).prop("checked",!0),$(`#palnner_unit_input_${e}`).prop("disabled",!0),$(`#palnner_unit_input_${e}`).val("")):($(`#palnner_unit_input_${e}`).val(a),$(`#palnner_unit_input_${e}`).prop("disabled",!1),$(`#max_${e}`).prop("checked",!1))}))}},selectAll:n=>{$(`#max_${n}`).prop("checked")?$(`#palnner_unit_input_${n}`).val(""):$(`#palnner_unit_input_${n}`).val("0"),$(`#palnner_unit_input_${n}`).prop("disabled",$(`#max_${n}`).prop("checked"))}}},"./src/view/language/en.ts":(n,e,a)=>{a.r(e),a.d(e,{en:()=>t});const t={plans:"Plans",loadPlan:"Load plan",removePlan:"Remove plan",newPlan:"New plan",cancel:"Cancel",next:"Next",loading:"Loading...",createPlan:"Create plan",PlanSuccessfullyCreated:"Plan successfully created!",attack:"Attack",support:"Strengthen",template:"Template",templates:"Templates",allUnit:"All units",arrival:"Arrival",arrivals:"Arrivals",notSelected:"---Not selected---",noNote:"---No note---",add:"Add",note:"Note",noTargetSelected:"No targets selected",noLauncherSelected:"No launchers selected",remove:"Remove",boosterPct:"Booster in percent",yes:"Yes",date:"Date",qntt:"Quantity",village:"Village",even:"Even distribution",oneByOne:"One by one",oneByOneClosest:"One by one closest",closestToTarget:"Closest to target",assigningAttacks:"Assigning attacks",startAssignment:"Start assignment",noAlgSelected:"The distribution algorithm is not selected!",noAttackAssigned:"No attack assigned!",bbCode:"BB Code",calculaing:"Calculating",calculateAttack:"Calculate attack",launch:"Launch",target:"Target",targets:"Targets",command:"Command",calculateQuestion:"Are you sure you want to calculate?",removeQuestion:"Are you sure you want to remove?",resetAttackQuestion:"Are you sure you want to reset all attacks?",launchers:"Launching village",planName:"Plan name",newTargets:"New targets",all:"All",name:"Name",editTargets:"Edit targets",editArrivals:"Edit arrivals",editTemplates:"Edit templates",editPalyerBoosters:"Booster boosters",autoAssigner:"Automatic assignment",resetAssigments:"Reset assignments",size:"Size",reset:"Reset",addAtatck:"Add attack",noLauncherSel:"No launcher village(s) selected!",noTargetSel:"No target selected!",close:"Close",renamePlan:"Rename plan",editTargetsText:"Edit targets",editArrivalsText:"Edit arrivals",editTemplatesText:"Edit templates",editBoostersText:"Edit boosters",attackPlan:"Attack Plan",removeTarget:"Remove target",removeAttack:"Remove attack",addVillageBoost:"Add booster to village",removeVillageBoost:"Remove booster from village",options:"Settings",rename:"Rename",launchVillages:"Starting villages",page:"Page",search:"Search",PlanNotSelected:"No plans have been selected!"}},"./src/view/language/hu.ts":(n,e,a)=>{a.r(e),a.d(e,{hu:()=>t});const t={plans:"Tervek",loadPlan:"Terv betöltése",removePlan:"Terv törlése",newPlan:"Új terv",cancel:"Mégse",next:"Következő",loading:"Betöltés...",createPlan:"Terv létrehozása",PlanSuccessfullyCreated:"A terv sikeresen létre lett hozva!",attack:"Támadás",support:"Erősítés",template:"Sablon",templates:"Sablonok",allUnit:"Összes egység",arrival:"Érkezés",arrivals:"Érkezések",notSelected:"---Nincs kiválasztva---",noNote:"---Nincs megjegyzés---",add:"Hozzáadás",note:"Megjegyzés",noTargetSelected:"Nincsenek célpontok kiválasztva",noLauncherSelected:"Nincsenek inulófaluk kiválasztva",remove:"Eltávolítás",boosterPct:"Gyorsító százalékban",yes:"Igen",date:"Dátum",qntt:"Mennyiség",village:"Falu",even:"Egyenletes",oneByOne:"Egyenként sorban",oneByOneClosest:"Egyenként legközelebb",closestToTarget:"Célpothoz legközelebb",assigningAttacks:"Támadások kiosztása",startAssignment:"Kiosztás indítása",noAlgSelected:"Nincs az elosztó algoritmus kiválasztva!",noAttackAssigned:"Nincs egy támadás se kiosztva!",bbCode:"BB kód",calculaing:"Számolás",calculateAttack:"Támadás kiszámítása",launch:"Indítás",target:"Célpont",targets:"Célpontok",command:"Parancs",calculateQuestion:"Biztosan szeretnéd kiszámítani?",removeQuestion:"Biztosan szeretnéd eltávolítani?",resetAttackQuestion:"Biztosan szeretnéd visszaállítani az összes támadást?",launchers:"Iduló faluk",planName:"Terv neve",newTargets:"Új célpontok",all:"Összes",name:"Név",editTargets:"Célpontok szerkesztése",editArrivals:"Érkezések szerkesztése",editTemplates:"Sablonok szerkesztése",editPalyerBoosters:"Erősítés gyorsítók",autoAssigner:"Automata hozzárrendelés",resetAssigments:"Kiosztások visszaállítása",size:"Méret",reset:"Vissza áll.",addAtatck:"Támadás hozzáadása",noLauncherSel:"Nincs indítófalu(k) kiválasztva!",noTargetSel:"Nincs célpont kiválasztva!",close:"Bezár",renamePlan:"Terv átnevezése",editTargetsText:"Célpontok szerkesztése",editArrivalsText:"Érkezések szerkesztése",editTemplatesText:"Sablonok szerkesztése",editBoostersText:"Gyorsítók szerkesztése",attackPlan:"Támadási terv",removeTarget:"Célpont eltávolítása",removeAttack:"Támadás eltávolítása",addVillageBoost:"Gyorsító hozzáadása faluhoz",removeVillageBoost:"Gyorsító eltávolítása faluról",options:"Beállítások",rename:"Átnevez",launchVillages:"Induló faluk",page:"Oldal",search:"Keresés",PlanNotSelected:"Nincs egy terv se kiválaszva!"}},"./src/view/launchDialog.ts":(n,e,a)=>{a.r(e),a.d(e,{launchDialog:()=>g});var t=a("./src/core/Api.ts"),i=a("./src/view/editArrivalsModal.ts"),l=a("./src/view/editLaunchVillagesModal.ts"),o=a("./src/view/editPlanNameModal.ts"),s=a("./src/view/editTargetModal.ts"),r=a("./src/view/editTemplatesModal.ts"),d=a("./src/view/mainWindow.ts"),c=a("./src/core/Language.ts");const g=()=>`\n        <style>\n            .launch-dialog{\n                display:grid;\n                text-align:center;\n            }\n            .launch-dialog option {\n                font-size:16px;\n                padding:2px 5px;\n                text-align:center;\n            }\n\n            .launch-dialog button{\n                margin: 10px auto;\n                width: max-content;\n            }\n\n            .launch-dialog-selector{\n                display:grid;\n            }\n\n            .new-plan{\n                display:none;\n            }\n\n            .steps{\n                width:100%;\n                display:inline-flex;\n                justify-content: space-evenly;\n                width: 100%;\n                padding: 10px 0;\n            }\n\n            .step{\n                display:grid;\n            }\n\n            .circle{\n                border-radius:50%;\n                background: linear-gradient(to bottom, #947a62 0%,#7b5c3d 22%,#6c4824 30%,#6c4824 100%);\n                color:white;\n                padding: 4px 10px;\n                font-size: 20px;\n                cursor:pointer;\n                z-index:2;\n            }\n\n            .inactive{\n                background: linear-gradient(to bottom, #b1a397 0%, #645d56 22%, #635f5a 30%, #6c6763 100%) !important\n            }\n\n            .modal-input-group{\n                display:inline-grid;\n                text-align:center;\n                border-bottom: solid 1px #603000;\n                padding: 5px 0;\n            }\n\n            .modal-input-inline{\n                display:block;\n                text-align:center;\n                border-bottom: solid 1px #603000;\n                padding: 5px 0;\n            }\n\n            .modal-input-group label{\n                margin-bottom:10px;\n            }\n\n            .modal-input-group input{\n                margin-bottom:10px;\n            }\n\n            .modal-input-group textarea{\n                margin-bottom:10px;\n            }\n\n            .modal-input-group button{\n                margin-bottom:10px;\n            }\n\n            .modal-input-group input{\n                text-align:center;\n                font-size: 14px;\n            }\n\n            .modal-input-group select{\n                text-align:center;\n                font-size: 14px;\n                margin-bottom:10px;\n            }\n            .progress-field{\n                width:88%; \n                position:absolute;\n                height: 5px;\n                background-color: black;\n                margin-top: 13px;\n                z-index:1;\n                background: linear-gradient(to bottom, #b1a397 0%, #645d56 22%, #635f5a 30%, #6c6763 100%);\n            }\n            #progress-bar{\n                height:100%;\n                background: linear-gradient(to bottom, #947a62 0%,#7b5c3d 22%,#6c4824 30%,#6c4824 100%);\n                z-index:1;\n            }\n        </style>\n        <div id="dialog-loading" style="display: none;justify-content: center;width: 100%;">\n            <img style="height:25px" src="https://dshu.innogamescdn.com/asset/6389cdba/graphic/loading.gif"><span style="padding:5px">${(0,c.Lang)("loading")}</span>\n        </div>\n        <div class="launch-dialog">\n            <div><h1>TW Attack Planner</h1></div>\n            <div class="launch-dialog-selector">\n                <h3>${(0,c.Lang)("plans")}:</h3>\n                <select id="launchDialogSelect" size="5">\n                    ${window.Plans.map((n=>(console.log(n),`<option value="${n.id}">${n.name}</option>`))).join("")}\n                </select>\n                <button onclick="launchDialog.loadPlan()" class="btn">${(0,c.Lang)("loadPlan")}</button>\n                <button onclick="launchDialog.removePlan()" class="btn">${(0,c.Lang)("removePlan")}</button>\n\n                <button onclick="launchDialog.newplan()" class="btn">+ ${(0,c.Lang)("newPlan")}</button>\n            </div>\n\n            <div class="new-plan">\n                <div class="steps">\n                    <div class="progress-field">\n                        <div id="progress-bar" style="width:0%"></div>\n                    </div>\n                    <div id="c1" onclick="launchDialog.goToStep(1)" class="circle">1</div>\n                    <div id="c2" class="circle inactive">2</div>\n                    <div id="c3" class="circle inactive">3</div>\n                    <div id="c4" class="circle inactive">4</div>\n                    <div id="c5" class="circle inactive">5</div>\n                </div>\n                <div class="step-1 step"></div>\n                <div class="step-2 step" style="display:none;"></div>\n                <div class="step-3 step" style="display:none;"></div>\n                <div class="step-4 step" style="display:none;"></div>\n                <div class="step-5 step" style="display:none;"></div>\n                <button id="nextBtn" onclick="launchDialog.goNext(2)" class="btn" disabled>${(0,c.Lang)("next")}</button>\n                <button style="display:none;" id="createPlan" onclick="launchDialog.createPlan()" class="btn" disabled>${(0,c.Lang)("createPlan")}</button>\n                <button onclick="launchDialog.cancelNewPlan()" class="btn">${(0,c.Lang)("cancel")}</button>\n            </div>\n        </div>\n    `;window.launchDialog={groupIDs:[],currentStep:0,stepCheck:()=>{if(0==$("#dialog-loading").get().length)return;let n=window.launchDialog.currentStep;switch(window.launchDialog.currentStep){case 0:if(!(window.launchDialog.plan.name.length>3&&-1==window.Plans.findIndex((n=>n.name==window.launchDialog.plan.name))))break;window.launchDialog.currentStep++;case 1:if(!(window.launchDialog.plan.targetPool.length>0))break;window.launchDialog.currentStep++;case 2:if(!(window.launchDialog.groupIDs.length>0))break;window.launchDialog.currentStep++;case 3:if(!(window.launchDialog.plan.arrivals.length>0))break;window.launchDialog.currentStep++;case 4:if(!(window.launchDialog.plan.templates.length>0))break;window.launchDialog.currentStep++}n<window.launchDialog.currentStep&&$("#nextBtn").prop("disabled",!1),5==window.launchDialog.currentStep&&$("#createPlan").prop("disabled",!1),console.log(n,window.launchDialog.currentStep)},goToStep:n=>{$(".step-1").hide(),$(".step-2").hide(),$(".step-3").hide(),$(".step-4").hide(),$(".step-5").hide(),$(".step-"+n).show(),n<5?($("#nextBtn").attr("onclick","launchDialog.goNext("+(n+1)+")"),$("#createPlan").hide(),$("#nextBtn").show()):($("#createPlan").show(),$("#nextBtn").hide()),window.launchDialog.stepCheck()},goNext:n=>{$(".step-1").hide(),$(".step-2").hide(),$(".step-3").hide(),$(".step-4").hide(),$(".step-5").hide(),console.log("in",n),$("#c"+n).attr("onclick","launchDialog.goToStep("+n+")"),n>4?($(".step-5").show(),$("#nextBtn").hide(),$("#createPlan").show(),$("#c"+n).removeClass("inactive"),$("#progress-bar").css("width",25*(n-1)+"%")):($("#nextBtn").prop("disabled",!0),$(".step-"+n).show(),$("#c"+n).removeClass("inactive"),$("#progress-bar").css("width",25*(n-1)+"%"),n++,$("#nextBtn").attr("onclick","launchDialog.goNext("+n+")"))},newplan:()=>{$(".new-plan").show(),$(".launch-dialog-selector").hide(),window.launchDialog.currentStep=0,window.launchDialog.plan={arrivals:[],boosters:[],launchPool:[],id:(new Date).getTime().toString(),name:"",targetPool:[],templates:[]},$(".step-1").html((0,o.editPlanNameModal)(window.launchDialog.plan)),$(".step-2").html((0,s.editTargetModal)(window.launchDialog.plan.targetPool)),$(".step-3").html((0,l.editLaunchVillagesModal)(window.launchDialog.plan.launchPool)),$(".step-4").html((0,i.editArrivalsModal)(window.launchDialog.plan.arrivals)),$(".step-5").html((0,r.editTemplatesModal)(window.launchDialog.plan.templates))},cancelNewPlan:()=>{$(".step-1").show(),$(".step-2").hide(),$(".step-3").hide(),$(".step-4").hide(),$(".step-5").hide(),$("#nextBtn").attr("onclick","launchDialog.goNext(2)"),$(".new-plan").hide(),$(".launch-dialog-selector").show(),$("#c2").addClass("inactive"),$("#c3").addClass("inactive"),$("#c4").addClass("inactive"),$("#c5").addClass("inactive"),$("#createPlan").hide(),$("#nextBtn").show(),$("#template_name").val(""),$("#c2").attr("onclick",""),$("#c3").attr("onclick",""),$("#c4").attr("onclick",""),$("#c5").attr("onclick",""),$("#plan_arrivals_select").html(""),$("#plan_targets").val(""),$("#template_select").html(""),$("#temp_name").val(""),window.launchDialog.groupIDs=[],$("#plan_launcher_list").html("")},createPlan:async()=>{$("#dialog-loading").css("display","inline-flex"),$(".launch-dialog").hide(),setTimeout((async()=>{window.attackPlan=window.launchDialog.plan,window.attackPlan.launchPool=await(0,t.loadPages)(window.launchDialog.groupIDs.map((n=>n.id))),await window.DB.savePlan(window.attackPlan),window.UI.SuccessMessage((0,c.Lang)("PlanSuccessfullyCreated")),setTimeout((()=>{window.Dialog.close("launchDialog"),window.Dialog.show("PlannerMainWindow",(0,d.mainWindow)()),$(".popup_box_container").append('<div style="position: fixed;width: 100%;height: 100%;top:0;left:0;z-index:12001"></div>')}),1e3)}),1e3)},loadPlan:()=>{if(null==$("#launchDialogSelect").val())return void window.UI.ErrorMessage((0,c.Lang)("PlanNotSelected"));let n=$("#launchDialogSelect").val().toString(),e=window.Plans.findIndex((e=>e.id==n));-1!=e&&($("#dialog-loading").css("display","inline-flex"),$(".launch-dialog").hide(),setTimeout((()=>{window.Dialog.close("launchDialog"),window.attackPlan=window.Plans[e],window.Dialog.show("PlannerMainWindow",(0,d.mainWindow)()),$(".popup_box_container").append('<div style="position: fixed;width: 100%;height: 100%;top:0;left:0;z-index:12001"></div>')}),1e3))},removePlan:async()=>{if(null==$("#launchDialogSelect").val())return void window.UI.ErrorMessage((0,c.Lang)("PlanNotSelected"));let n=$("#launchDialogSelect").val().toString();window.DB.removePlan(n);let e=await window.DB.loadPlans();$("#launchDialogSelect").html(`${e.map((n=>`<option value="${n.id}">${n.name}</option>`))}`)},plan:void 0}},"./src/view/launchItem.ts":(n,e,a)=>{a.r(e),a.d(e,{launchItem:()=>i});var t=a("./src/core/Api.ts");const i=n=>{n.popSize=(0,t.calcUnitPop)(n.unitsContain);let e="small";n.popSize>1e3&&n.popSize<=5e3?e="medium":n.popSize>5e3&&(e="large");let a=Object.keys(n.unitsContain);return`\n        <div class="launch-item" id="${n.id}">\n            <div class="name-field">\n                <a href="/game.php?village=${t.game.village.id}&screen=info_village&id=${n.id}" target="_blank">${n.name} (${n.coord.text}) K${n.kontinent}</a>\n            </div>\n            <div class="check-field">\n                <input type="checkbox" value="${n.id}"><img src="https://dshu.innogamescdn.com/asset/72737c96/graphic/command/attack_${e}.png">\n            </div>\n            ${a.map((e=>{if(0!=window.gameConfig.game.archer||"archer"!=e&&"marcher"!=e)return`<div class="${e}-field ${0==n.unitsContain[e]?"hidden":""}">${n.unitsContain[e]}</div>`})).join("")}\n        </div>`}},"./src/view/mainWindow.ts":(n,e,a)=>{a.r(e),a.d(e,{mainWindow:()=>v});var t=a("./src/core/Language.ts"),i=a("./src/core/Query.ts"),l=a("./src/view/addAttackModal.ts"),o=a("./src/view/addPlayerSpeedModal.ts"),s=a("./src/view/autoAssignModal.ts"),r=a("./src/view/calculatedAttackModal.ts"),d=a("./src/view/confirmCalculateAttackModal.ts"),c=a("./src/view/confirmResetAssignmentsModal.ts"),g=a("./src/view/editArrivalsModal.ts"),p=a("./src/view/editPlanNameModal.ts"),u=a("./src/view/editTargetModal.ts"),h=a("./src/view/editTemplatesModal.ts"),m=a("./src/view/launchItem.ts"),w=a("./src/view/targetItem.ts");const v=()=>`\n    <style>\n        ::-webkit-scrollbar {\n    width: 5px;\n    }\n    \n    /* Track */\n    ::-webkit-scrollbar-track {\n        box-shadow: inset 0 0 5px grey;\n        border-radius: 10px;\n    }\n    \n    /* Handle */\n    ::-webkit-scrollbar-thumb {\n        background: grey;\n        border-radius: 10px;\n    }\n\n        .mainWindow{\n            width: 100%;\n            height:85vh;\n        }\n        .popup_box_container{\n            height:100% !important;\n        }\n        #popup_box_PlannerMainWindow{\n            width: 95vw !important;\n        }\n        html{\n            overflow: hidden !important;\n        }\n        .container {\n            height: calc(100% - 10px);\n            border: solid 2px #6c4824;\n            border-radius:20px;\n            display: grid;\n            grid-template-columns: 260px 1.3fr 1.3fr;\n            grid-template-rows: 30px 3fr [option] 0.1fr;\n            gap: 0px 0px;\n            grid-auto-flow: row;\n        }\n\n        .options-title { \n            grid-area: 1 / 1 / 2 / 2; \n            border-top-left-radius: 20px;\n            border-right: solid 2px #6c4824;\n            border-bottom: solid 2px #6c4824;\n        }\n\n        .options-panel {\n            border-right: solid 2px #6c4824;\n            display: table;\n        }\n\n        .target-title { \n            grid-area: 1 / 2 / 2 / 3; \n            border-right: solid 1px #6c4824;\n            border-bottom: solid 2px #6c4824;\n        }\n\n        .target-panel { \n            grid-area: 2 / 2 / 4 / 3; \n            border-right: solid 1px #6c4824;\n\n            display: grid; \n            grid-template-columns: 1fr; \n            grid-template-rows: 30px 1fr; \n            gap: 0px 0px; \n            grid-template-areas: \n                "target-header"\n                "target-list";\n        }\n\n        .target-header {\n            grid-area: target-header; \n        }\n        .target-list { grid-area: target-list; overflow-y:auto; }\n\n        .launch-title { \n            grid-area: 1 / 3 / 2 / 4;\n            border-top-right-radius: 20px;\n            border-left: solid 1px #6c4824;\n            border-bottom: solid 2px #6c4824;\n            display: flex;\n            flex-wrap: nowrap;\n            justify-content: space-evenly;\n            align-items: flex-start;\n            align-content: flex-start;\n            flex-direction: row;\n        }\n\n        .launch-panel { \n            grid-area: 2 / 3 / 4 / 4; \n            border-left: solid 1px #6c4824;\n            display: grid; \n            grid-template-columns: 1fr; \n            grid-template-rows: 30px 1fr; \n            gap: 0px 0px; \n            grid-template-areas: \n                "launch-header"\n                "launch-list"; \n        }\n\n        .launch-list {\n            overflow-y:scroll;\n            border-bottom-right-radius: 20px;\n            grid-area: launch-list; \n            display: block;\n        }\n        .launch-header { \n            padding-right:5px;\n            background: linear-gradient(to bottom,#e2c07c 0%,#dab874 44%,#c1a264 100%);\n            grid-area: launch-header;\n            display: grid;\n            grid-template-columns:  1fr 1fr 1fr 1fr${1==window.gameConfig.game.archer&&" 1fr"} 1fr 1fr${1==window.gameConfig.game.archer&&" 1fr"} 1fr 1fr 1fr 1fr 1fr; \n            grid-template-rows: 30px;\n            gap: 0px;\n            grid-template-areas: \n                "size-icon spear-icon sword-icon axe-icon${1==window.gameConfig.game.archer&&" archer-icon"} spy-icon light-icon${1==window.gameConfig.game.archer&&" marcher-icon"} heavy-icon ram-icon catapult-icon pala-icon snob-icon"\n        }\n\n        .target-launch-header { \n            background: linear-gradient(to bottom,#e2c07c 0%,#dab874 44%,#c1a264 100%);\n            grid-area: launch-header;\n            display: grid;\n            grid-template-columns:  30px 1fr 1fr 1fr${1==window.gameConfig.game.archer&&" 1fr"} 1fr 1fr${1==window.gameConfig.game.archer?" 1fr":""} 1fr 1fr 1fr 1fr 1fr 30px; \n            grid-template-rows: 30px;\n            gap: 0px;\n            grid-template-areas: \n                "size-icon spear-icon sword-icon axe-icon${1==window.gameConfig.game.archer&&" archer-icon"} spy-icon light-icon${1==window.gameConfig.game.archer&&" marcher-icon"} heavy-icon ram-icon catapult-icon pala-icon snob-icon del-icon"\n        }\n\n        .target-launch-header div {\n            padding: 5px;\n        }\n\n        .target-launch-header img {\n            margin: 0 auto;\n            display: block;\n        }\n\n\n        .credits { grid-area: option / 1 / 4 / 2; border-right: solid 2px #6c4824; padding:10px;}\n\n        .header {\n            background: linear-gradient(to bottom,#e2c07c 0%,#dab874 44%,#c1a264 100%);\n            text-align: center;\n            padding:3px;\n        }\n\n        .launch-header div{\n            padding: 5px;\n        }\n        .launch-header img{\n            margin: 0 auto;\n            display: block;\n            cursor: pointer;\n        }\n\n        .size-icon { grid-area: size-icon; }\n        .spear-icon { grid-area: spear-icon; }\n        .sword-icon { grid-area: sword-icon; }\n        .axe-icon { grid-area: axe-icon; }\n        .archer-icon { grid-area: archer-icon; }\n        .spy-icon { grid-area: spy-icon; }\n        .light-icon { grid-area: light-icon; }\n        .marcher-icon { grid-area: marcher-icon; }\n        .heavy-icon { grid-area: heavy-icon; }\n        .ram-icon { grid-area: ram-icon; }\n        .catapult-icon { grid-area: catapult-icon; }\n        .pala-icon { grid-area: pala-icon; }\n        .snob-icon { grid-area: snob-icon; }\n        .del-icon { grid-area: del-icon; }\n\n        .option-item{\n            width:100%;\n            margin: 15px 0;\n        }\n        .option-item button{\n            height: 30px;\n            margin: 0 auto;\n            display: block;\n            min-width: 85%;\n        }\n        .option-item h2{\n            text-align:center;\n        }\n\n        .header-count{\n            margin-left:10px;\n            display: inline;\n        }\n\n        .header-count span{\n            font-weight: bold;\n            padding: 0 2px;\n        }\n\n        .btn-add-attack{\n                font-size: 30px !important;\n                padding: 0;\n                line-height: 20px;\n        }\n    </style>\n     <style>\n            .targetsLauncher-item{\n                height: max-content;\n                border-top: solid 1px #6c4824;\n                border-bottom: solid 1px #6c4824;\n                margin-top:3px;\n                text-align:center;\n                display: grid; \n                grid-template-columns:  30px 1fr 1fr 1fr${1==window.gameConfig.game.archer&&" 1fr"} 1fr 1fr${1==window.gameConfig.game.archer&&" 1fr"} 1fr 1fr 1fr 1fr 1fr 30px; \n                grid-template-rows: 35px 30px ;\n                gap: 0px 0px; \n                grid-template-areas: \n                    "size-field name-field name-field name-field${1==window.gameConfig.game.archer&&" name-field"} name-field name-field${1==window.gameConfig.game.archer&&" name-field"} name-field name-field name-field name-field name-field del-field"\n                    "size-field spear-field sword-field axe-field${1==window.gameConfig.game.archer&&" archer-field"} spy-field light-field${1==window.gameConfig.game.archer&&" marcher-field"} heavy-field ram-field catapult-field knight-field snob-field del-field";\n            }\n            .del-field{ grid-area: del-field; padding: 20px 5px;background-color:#fff5dc;border-left: 1px solid #6c4824;}\n            .size-field{ grid-area: size-field; padding: 5px 8px;background-color:#fff5dc;border-right: 1px solid #6c4824;}\n\n            .launch-item{\n            height: max-content;\n            border-top: solid 1px #6c4824;\n            border-bottom: solid 1px #6c4824;\n            margin-top:3px;\n            text-align:center;\n            display: grid; \n            grid-template-columns:  1fr 1fr 1fr 1fr${1==window.gameConfig.game.archer&&" 1fr"} 1fr 1fr${1==window.gameConfig.game.archer&&" 1fr"} 1fr 1fr 1fr 1fr 1fr;\n            grid-template-rows: 30px 30px ;\n            gap: 0px 0px; \n            grid-template-areas:\n                "check-field name-field name-field name-field${1==window.gameConfig.game.archer&&" name-field"} name-field name-field${1==window.gameConfig.game.archer&&" name-field"} name-field name-field name-field name-field name-field"\n                "check-field spear-field sword-field axe-field${1==window.gameConfig.game.archer&&" archer-field"} spy-field light-field${1==window.gameConfig.game.archer&&" marcher-field"}  heavy-field ram-field catapult-field knight-field snob-field";\n            }\n\n            .check-field input{\n                height:16px;\n                width:16px;\n                float:left;\n            }\n\n            .check-field img{\n                height: 16px;\n                float:right;\n                padding-right:3px;\n            }\n\n            .size-field img{\n                height: 16px;\n                float:right;\n                padding: 15px 0;\n            }\n\n            .del-field .remove-target-btn{\n                margin: 0 !important;\n            }\n\n            .check-field { grid-area: check-field; padding: 20px 0; background-color:#fff5dc; border-right:1px solid #6c4824}\n            .spear-field { grid-area: spear-field; padding: 5px 0;background-color:#fff5dc}\n            .sword-field { grid-area: sword-field; padding: 5px 0;background-color:#fff5dc}\n            .axe-field { grid-area: axe-field; padding: 5px 0;background-color:#fff5dc}\n            .archer-field { grid-area: archer-field; padding: 5px 0;background-color:#fff5dc}\n            .spy-field { grid-area: spy-field; padding: 5px 0;background-color:#fff5dc}\n            .light-field { grid-area: light-field; padding: 5px 0;background-color:#fff5dc}\n            .marcher-field { grid-area: marcher-field; padding: 5px 0;background-color:#fff5dc}\n            .heavy-field { grid-area: heavy-field; padding: 5px 0;background-color:#fff5dc}\n            .ram-field { grid-area: ram-field; padding: 5px 0;background-color:#fff5dc}\n            .catapult-field { grid-area: catapult-field; padding: 5px 0;background-color:#fff5dc}\n            .knight-field { grid-area: knight-field; padding: 5px 0;background-color:#fff5dc}\n            .snob-field { grid-area: snob-field; padding: 5px 0;background-color:#fff5dc}\n            .name-field { \n                display:grid;\n                grid-area: name-field;\n                color: #603000;\n                font-weight: bold;\n                background-color:#ecd8b2;\n                padding: 5px 0;\n            }\n            .target-item{\n                overflow-x:hidden;\n                display: block;\n                width:100%;\n                margin: 5px 0;\n                border-top: solid 1px #6c4824;\n                border-bottom: solid 1px #6c4824;\n            }\n            .target-header{\n                height:35px;\n                width:100%;\n                display: flex;\n\t            justify-content: space-around;\n                background-color: #ecd8b2;\n                cursor: pointer;\n            }\n\n            .target-header div{\n                padding-top: 9px;\n                padding-bottom: 9px;\n            }\n\n            .target-village-name{\n                color: #603000;\n                font-weight: bold;\n            }\n            .target-extras{\n                flex-grow: 1;\n            }\n\n            .target-launchers{\n                display:none;\n                width:100%;\n                min-height:20px;\n                background-color: #fff5dc;\n            }\n\n            .remove-target-btn {\n                float: right;\n                z-index: 2;\n                width: 20px;\n                height: 20px;\n                background: url(https://dshu.innogamescdn.com/asset/80b013af/graphic/login_close.png) top left no-repeat;\n                cursor: pointer;\n                background-size: 20px;\n                margin-right: 10px;\n            }\n            .add-village-booster{\n                background: url(https://klanhaboru.hu/graphic/plus.png) top left no-repeat;\n                height: 16px;\n                width: 16px;\n                margin-left: 5px;\n                cursor: pointer;\n                display: inline-block;\n                vertical-align: middle;\n            }\n\n            .indicator{\n                font-size: 16px;\n                padding-left: 5px;\n                padding-right: 5px;\n            }\n\n            .indicator-open{\n                transform: rotate(90deg);\n            }\n\n            .planner-modal {\n                background: transparent url(https://dshu.innogamescdn.com/asset/fd86cac8/graphic/index/contentbg.png) scroll left top repeat;\n                filter: drop-shadow(0 0 0.75rem rgb(88, 88, 88));\n                width: max-content;\n                height: fit-content;\n                max-height: calc(100vh - 120px);\n                border: 2px solid #6c4824;\n                position: absolute;\n                top: 0;\n                bottom: 0;\n                left: 0;\n                right: 0;\n                margin: auto;\n                border-radius: 10px;\n                z-index: 100001;\n                display: grid;\n                align-content: space-evenly;\n                grid-template-areas:\n                    'header'\n                    'content';\n                grid-template-rows: 30px calc(100% - 30px);\n            }\n\n            .planner-modal-header {\n                font-size:16px;\n                border-top-left-radius: 10px;\n                border-top-right-radius: 10px;\n                padding: 5px;\n                grid-area: header;\n                text-align: center;\n                background: linear-gradient(to bottom,#e2c07c 0%,#dab874 44%,#c1a264 100%);\n            }\n\n            .planner-modal-content {\n                display:grid;\n                grid-area: content;\n                padding: 10px;\n            }\n\n            .modal-input-group{\n                display:inline-grid;\n                text-align:center;\n                border-bottom: solid 1px #603000;\n                padding: 5px 0;\n            }\n\n            .modal-input-inline{\n                display:block;\n                text-align:center;\n                border-bottom: solid 1px #603000;\n                padding: 5px 0;\n            }\n\n            .modal-input-group label{\n                margin-bottom:10px;\n            }\n\n            .modal-input-group input{\n                margin-bottom:10px;\n            }\n\n            .modal-input-group textarea{\n                margin-bottom:10px;\n            }\n\n            .modal-input-group button{\n                margin-bottom:10px;\n            }\n\n            .modal-input-group input{\n                text-align:center;\n                font-size: 14px;\n            }\n\n            .modal-input-group select{\n                text-align:center;\n                font-size: 14px;\n                margin-bottom:10px;\n            }\n            \n            .del-boost {\n                background: url(https://klanhaboru.hu/graphic/minus.png) top left no-repeat;\n                height: 16px;\n                width: 16px;\n                margin-left: 5px;\n                cursor: pointer;\n                display: inline-block;\n                vertical-align: middle;\n            }\n\n            .booster-button {\n                display: inline;\n            }\n\n            .launch-search-bar{\n                display: inline-block;\n\n            }\n\n            .launch-search-bar input{\n                width:60px;\n                font-size:12px;\n            }\n\n            .remove-search-btn {\n                float: right;\n                z-index: 2;\n                width: 20px;\n                height: 20px;\n                background: url(https://dshu.innogamescdn.com/asset/80b013af/graphic/login_close.png) top left no-repeat;\n                cursor: pointer;\n                background-size: 20px;\n            }\n\n           \n\n        </style>\n    <div class="mainWindow">\n        <div class="container">\n            <div class="options-title header">\n                <h3>${(0,t.Lang)("options")}</h3>\n            </div>\n            <div class="options-panel">\n                <div class="option-item">\n                    <h2 style="font-size: 1rem;"><span id="open-plan-name">${window.attackPlan.name}</span><a onclick="window.editName()" class="rename-icon" href="#" data-title="rename"></a></h2>\n                </div>\n                <div class="option-item">\n                    <button onclick="window.editTargets()" class="btn">${(0,t.Lang)("editTargets")}</button>\n                </div>\n                <div class="option-item">\n                    <button onclick="window.editArrivals()" class="btn">${(0,t.Lang)("editArrivals")}</button>\n                </div>\n                <div class="option-item">\n                    <button onclick="window.editTemplates()" class="btn">${(0,t.Lang)("editTemplates")}</button>\n                </div>\n                <div class="option-item">\n                    <button onclick="window.editPlayerBoosts()" class="btn">${(0,t.Lang)("editPalyerBoosters")}</button>\n                </div>\n                <div class="option-item">\n                    <button onclick="window.openAutoAssignModal()" class="btn">${(0,t.Lang)("autoAssigner")}</button>\n                </div>\n                <div class="option-item">\n                    <button onclick="window.calculateAttack()" class="btn">${(0,t.Lang)("calculateAttack")}</button>\n                </div>\n                <div class="option-item">\n                    <button onclick="window.resetAssignments()" class="btn">${(0,t.Lang)("resetAssigments")}</button>\n                </div>\n            </div>\n            <div class="target-title header">\n                <h3>${(0,t.Lang)("targets")} (<span id="target-cnt"></span>)</h3>\n            </div>\n            <div class="target-panel">\n                <div class="target-header">\n                </div>\n                <div class="target-list">\n                </div>\n            </div>\n            <div class="launch-title header">\n                <div class="launch-filter-bar">\n                    <button onclick="window.launchVillagesQuery.order('coord.text')" class="btn">XY</button>\n                    <button onclick="window.launchVillagesQuery.order('name')" class="btn">${(0,t.Lang)("name")}</button>\n                    \n                </div>\n                <h3>${(0,t.Lang)("launchVillages")} (<span id="launch-cnt"></span>)</h3>\n                <div class="launch-filter-bar">\n                    <button onclick="window.launchVillagesQuery.order('popSize')" class="btn">${(0,t.Lang)("size")}</button>\n                    <div class="launch-search-bar">\n                        <input id="search-bar" onkeyup="window.launchVillagesQuery.search(this)" placeholder="${(0,t.Lang)("search")}" type="text">\n                        <button onclick="window.launchVillagesQuery.resetAll()" class="btn">${(0,t.Lang)("reset")}</button>\n                    </div>\n                </div>\n            </div>\n            <div class="launch-panel">\n                <div class="launch-header">\n                    <div class="size-icon">\n                        <button onclick="window.openAddLauncherWindow()" class="btn btn-add-attack">⬅</button>\n                    </div>\n                    <div class="spear-icon">\n                        <img onclick="window.launchVillagesQuery.order('unitsContain.spear')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_spear.png">\n                    </div>\n                    <div class="sword-icon">\n                        <img onclick="window.launchVillagesQuery.order('unitsContain.sword')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_sword.png">\n                    </div>\n                    <div class="axe-icon">\n                        <img onclick="window.launchVillagesQuery.order('unitsContain.axe')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_axe.png">\n                    </div>\n                    ${1==window.gameConfig.game.archer&&'<div class="archer-icon">\n                        <img onclick="window.launchVillagesQuery.order(\'unitsContain.archer\')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_archer.png">\n                    </div>'}\n                    <div class="spy-icon">\n                        <img onclick="window.launchVillagesQuery.order('unitsContain.spy')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_spy.png">\n                    </div>\n                    <div class="light-icon">\n                        <img onclick="window.launchVillagesQuery.order('unitsContain.light')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_light.png">\n                    </div>\n                    ${1==window.gameConfig.game.archer&&'<div class="marcher-icon">\n                            <img onclick="window.launchVillagesQuery.order(\'unitsContain.marcher\')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_marcher.png">\n                        </div>'}\n                    <div class="heavy-icon">\n                        <img onclick="window.launchVillagesQuery.order('unitsContain.heavy')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_heavy.png">\n                    </div>\n                    <div class="ram-icon">\n                        <img onclick="window.launchVillagesQuery.order('unitsContain.ram')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_ram.png">\n                    </div>\n                    <div class="catapult-icon">\n                        <img onclick="window.launchVillagesQuery.order('unitsContain.catapult')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_catapult.png">\n                    </div>\n                    <div class="pala-icon">\n                        <img onclick="window.launchVillagesQuery.order('unitsContain.pala')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_knight.png">\n                    </div>\n                    <div class="snob-icon">\n                        <img onclick="window.launchVillagesQuery.order('unitsContain.snob')" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_snob.png">\n                    </div>\n                </div>\n                <div class="launch-list">\n                </div>\n            </div>\n            <div class="credits">\n                v0.1.2-beta [2024.06.08.]; by: toldi26\n            </div>\n        </div>\n    </div>\n    <div class="planner-modal" style="display:none;">\n    <div class="planner-modal-header"><b></b></div>\n    <div class="planner-modal-content"> </div>\n    </div>\n    <script>\n        window.mainInit();\n    <\/script>\n    `;window.mainInit=()=>{console.log(window.attackPlan.launchPool),window.launchVillagesQuery=new i.Query(window.attackPlan.launchPool,$(".launch-list").get()[0],$("#launch-cnt").get()[0],m.launchItem,"name"),window.launchVillagesQuery.render(),window.targetPoolQuery=new i.Query(window.attackPlan.targetPool,$(".target-list").get()[0],$("#target-cnt").get()[0],w.targetItem,"village.name"),window.targetPoolQuery.render()},window.openAddLauncherWindow=()=>{0!=$('input[name="target"]:checked').get().length&&0!=$('input[name="target"]:checked').get().length?0!=$(".launch-list").find("input:checked").get().length?window.createModal((0,l.addAttackModal)(),(0,t.Lang)("addAtatck")):window.UI.ErrorMessage((0,t.Lang)("noLauncherSel")):window.UI.ErrorMessage((0,t.Lang)("noTargetSel"))},window.createModal=(n,e)=>{let a=`<div id="plannerCloseBtn" class="modal-input-inline"><button class="btn" onclick="window.closeModal()">${(0,t.Lang)("close")}</button></div>`;$(".planner-modal-header b").text(e),$(".planner-modal-content").html(n+a),$(".planner-modal").show()},window.closeModal=()=>{$(".planner-modal-header b").text(""),$(".planner-modal-content").html(""),$(".planner-modal").hide()},window.editName=()=>{window.createModal((0,p.editPlanNameModal)(window.attackPlan),(0,t.Lang)("renamePlan"))},window.editTargets=()=>{window.createModal((0,u.editTargetModal)(window.attackPlan.targetPool),(0,t.Lang)("editTargetsText"))},window.editArrivals=()=>{window.createModal((0,g.editArrivalsModal)(window.attackPlan.arrivals),(0,t.Lang)("editArrivalsText"))},window.editTemplates=()=>{window.createModal((0,h.editTemplatesModal)(window.attackPlan.templates),(0,t.Lang)("editTemplatesText"))},window.editPlayerBoosts=()=>{window.createModal((0,o.addPlayerSpeedModal)(),(0,t.Lang)("editBoostersText"))},window.calculateAttack=()=>{let n=0;window.attackPlan.targetPool.forEach((e=>{e.launchers.forEach((e=>{n++}))})),0!=n?window.createModal((0,d.confirmCalculateAttackModal)(),(0,t.Lang)("calculateAttack")):window.UI.ErrorMessage((0,t.Lang)("noAttackAssigned"))},window.confirmCalculateAttack=()=>{window.createModal((0,r.calculatedAttackModal)(),(0,t.Lang)("attackPlan"))},window.openAutoAssignModal=()=>{window.autoAssign.assignTypes=[],window.autoAssign.launchPoolCopy=structuredClone(window.attackPlan.launchPool),console.log(window.attackPlan.launchPool[5].unitsContain),console.log(window.autoAssign.launchPoolCopy[5].unitsContain),window.createModal((0,s.autoAssignModal)(),(0,t.Lang)("autoAssigner"))},window.resetAssignments=()=>{window.createModal((0,c.confirmResetAssignmentsModal)(),(0,t.Lang)("resetAssigments"))}},"./src/view/targetItem.ts":(n,e,a)=>{a.r(e),a.d(e,{targetItem:()=>c});var t=a("./src/core/Api.ts"),i=a("./src/core/Language.ts"),l=a("./src/view/ConfirmVillageSpeedRemoveModal.ts"),o=a("./src/view/addVillageSpeedModal.ts"),s=a("./src/view/confirmRemoveModal.ts"),r=a("./src/view/confirmRemoveTargetModal.ts"),d=a("./src/view/targetsLauncher.ts");const c=n=>{let e=0,a=0,i=0,l=0,o=0;return n.launchers.forEach((n=>{n.village.popSize<=1e3?a++:n.village.popSize>1e3&&n.village.popSize<=5e3?i++:n.village.popSize>5e3&&l++,n.isAttack||o++,e+=n.village.unitsContain.snob})),`\n    <div id="${n.village.id}" class="target-item">\n        <div onclick="targetItem.toggleTargetItem(this)" class="target-header">\n            <div><input value="${n.village.id}" onclick="targetItem.selectTargetItem(event)" type="radio" name="target" ${n.isSelected?"checked":""}/></div>\n            <div class="indicator ${n.isOpen?"indicator-open":""}"><span >▶<span></div>\n            <div class="target-village-name"><a target="_blank" href="/game.php?village=${t.game.village.id}&screen=info_village&id=${n.village.id}">${n.village.name}(${n.village.coord.text}) K${n.village.kontinent}</a></div>\n            <div class="target-extras">\n                ${n.booster>0?`\n                <div class="booster-button">( ${n.booster}% <img height="15" src="https://dshu.innogamescdn.com/asset/f9cb54f8/graphic/items/3005.png">) <a class="del-boost" onclick="targetItem.removeVillageBooster(event,${n.village.id})"></a></div>\n                `:`\n                    <a onclick="targetItem.addVillageBooster(event,${n.village.id})" class="add-village-booster"></a>\n                `}\n                <div class="header-count">\n                    ${e>0?`<img height="14px" src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_snob.png"><span>${e}<span>`:""}\n                    ${l>0?`<img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/command/attack_large.png"><span>${l}<span>`:""}\n                    ${i>0?`<img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/command/attack_medium.png"><span>${i}<span>`:""}\n                    ${a>0?`<img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/command/attack_small.png"><span>${a}<span>`:""}\n                    ${o>0?`<img src="https://dshu.innogamescdn.com/asset/69990994/graphic/command/support.png"><span>${o}<span>`:""}\n                </div>\n            </div>\n            <div><a onclick="targetItem.removeTargetItem(event,${n.village.id})" class="remove-target-btn"></a></div>\n        </div>\n        <div class="target-launchers" style="display: ${n.isOpen?"block":"none"};">\n        <div class="target-launch-header">\n            <div class="spear-icon">\n                <img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_spear.png">\n            </div>\n            <div class="sword-icon">\n                <img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_sword.png">\n            </div>\n            <div class="axe-icon">\n                <img  src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_axe.png">\n            </div>\n            ${0==window.gameConfig.game.archer?"":'\n            <div class="archer-icon">\n                <img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_archer.png">\n            </div>\n            '}\n            <div class="spy-icon">\n                <img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_spy.png">\n            </div>\n            <div class="light-icon">\n                <img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_light.png">\n            </div>\n            ${0==window.gameConfig.game.archer?"":'\n            <div class="marcher-icon">\n                <img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_marcher.png">\n            </div>\n            '}\n            <div class="heavy-icon">\n                <img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_heavy.png">\n            </div>\n            <div class="ram-icon">\n                <img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_ram.png">\n            </div>\n            <div class="catapult-icon">\n                <img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_catapult.png">\n            </div>\n            <div class="pala-icon">\n                <img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_knight.png">\n            </div>\n            <div class="snob-icon">\n                <img src="https://dshu.innogamescdn.com/asset/fd86cac8/graphic/unit/unit_snob.png">\n            </div>\n            <div class="del-icon"></div> \n        </div>\n        ${n.launchers.map((e=>(0,d.targetsLauncher)(e,n.village.id))).join("")}\n        </div>\n    </div>\n    `};window.targetItem={toggleTargetItem:n=>{$(n).parent().find(".target-launchers").toggle(),$(n).find(".indicator").toggleClass("indicator-open"),$(n).find("input").prop("checked",!0);let e=parseInt($(n).parent().attr("id")),a=window.attackPlan.targetPool.findIndex((n=>n.village.id==e));window.attackPlan.targetPool[a].isOpen=!window.attackPlan.targetPool[a].isOpen},selectTargetItem:n=>{let e=parseInt($(n.target).parent().parent().parent().attr("id"));window.attackPlan.targetPool.forEach((n=>{n.village.id==e?(n.isSelected=!0,n.isOpen=!0):n.isSelected=!1})),n.stopPropagation(),$(n.target).parent().parent().parent().find(".target-launchers").toggle(),$(n.target).parent().parent().find(".indicator").toggleClass("indicator-open")},removeTargetItem:(n,e)=>{n.stopPropagation(),$(".planner-modal-header b").text((0,i.Lang)("removeTarget")),$(".planner-modal-content").html((0,r.confirmRemoveTargetModal)(e)),$(".planner-modal").show()},confirmRemoveTargetItem:n=>{let e=[],a=window.attackPlan.targetPool.findIndex((e=>e.village.id==n)),i=!1;a<-1||(window.attackPlan.targetPool[a].launchers.forEach((n=>{let a=window.attackPlan.launchPool.findIndex((e=>e.id==n.village.id));if(-1==a){let e={...n.village};window.attackPlan.launchPool.push(e),i=!0}else[window.attackPlan.launchPool[a].unitsContain,n.village.unitsContain]=(0,t.TroopTransaction)(window.attackPlan.launchPool[a].unitsContain,n.village.unitsContain,n.village.unitsContain),e.push(n.village)})),i?window.launchVillagesQuery.resetAll():window.launchVillagesQuery.partialRender(e,"id"),window.attackPlan.targetPool.splice(a,1),window.targetPoolQuery.resetAll(),window.closeModal(),window.DB.savePlan(window.attackPlan))},removeTargetLauncherItem:(n,e)=>{$(".planner-modal-header b").text((0,i.Lang)("removeAttack")),$(".planner-modal-content").html((0,s.confirmRemoveModal)(n,e)),$(".planner-modal").show()},confirmRemoveTargetLauncherItem:(n,e)=>{let a=[],i=window.attackPlan.targetPool.findIndex((n=>n.village.id==e));if(i<-1)return;let l=window.attackPlan.targetPool[i].launchers.findIndex((e=>e.village.id==n));if(l<-1)return;let o=window.attackPlan.launchPool.findIndex((e=>e.id==n));if(-1==o){let n={...window.attackPlan.targetPool[i].launchers[l].village};window.attackPlan.launchPool.push(n),window.attackPlan.targetPool[i].launchers.splice(l,1),window.launchVillagesQuery.resetAll()}else[window.attackPlan.launchPool[o].unitsContain,window.attackPlan.targetPool[i].launchers[l].village.unitsContain]=(0,t.TroopTransaction)(window.attackPlan.launchPool[o].unitsContain,window.attackPlan.targetPool[i].launchers[l].village.unitsContain,window.attackPlan.targetPool[i].launchers[l].village.unitsContain),console.log(window.attackPlan.launchPool[o].unitsContain,window.attackPlan.targetPool[i].launchers[l].village.unitsContain),a.push(window.attackPlan.launchPool[o]),window.attackPlan.targetPool[i].launchers.splice(l,1);window.launchVillagesQuery.partialRender(a,"id"),window.targetPoolQuery.partialRender([window.attackPlan.targetPool[i]],"village.id"),window.closeModal(),window.DB.savePlan(window.attackPlan)},addVillageBooster:(n,e)=>{n.stopPropagation(),$(".planner-modal-header b").text((0,i.Lang)("addVillageBoost")),$(".planner-modal-content").html((0,o.addVillageBoosterModal)(e)),$(".planner-modal").show()},confirmAddVillageBooster:n=>{let e=window.attackPlan.targetPool.findIndex((e=>e.village.id==n));e<-1||(window.attackPlan.targetPool[e].booster=parseInt($("#planner-village-boost").val().toString()),window.closeModal(),window.targetPoolQuery.partialRender([window.attackPlan.targetPool[e]],"village.id"),window.DB.savePlan(window.attackPlan))},removeVillageBooster:(n,e)=>{n.stopPropagation(),$(".planner-modal-header b").text((0,i.Lang)("removeVillageBoost")),$(".planner-modal-content").html((0,l.ConfirmVillageSpeedRemoveModal)(e)),$(".planner-modal").show()},confirmRemoveVillageBooster:n=>{window.closeModal();let e=window.attackPlan.targetPool.findIndex((e=>e.village.id==n));e<-1||(window.attackPlan.targetPool[e].booster=0,window.closeModal(),window.targetPoolQuery.partialRender([window.attackPlan.targetPool[e]],"village.id"),window.DB.savePlan(window.attackPlan))}}},"./src/view/targetsLauncher.ts":(n,e,a)=>{a.r(e),a.d(e,{targetsLauncher:()=>i});var t=a("./src/core/Api.ts");const i=(n,e)=>{let a="small";n.village.popSize>1e3&&n.village.popSize<=5e3?a="medium":n.village.popSize>5e3&&(a="large");let i=`https://dshu.innogamescdn.com/asset/72737c96/graphic/command/attack_${a}.png`;n.isAttack||(i="https://dshu.innogamescdn.com/asset/69990994/graphic/command/support.png");let l=Object.keys(n.village.unitsContain),o="";for(let e=0;e<l.length;e++){const a=l[e];(0!=window.gameConfig.game.archer||"archer"!=a&&"marcher"!=a)&&(o+=`<div class="${a}-field ${0==n.village.unitsContain[a]?"hidden":""}">${n.village.unitsContain[a]}</div>`)}return`\n    <div class="targetsLauncher-item" id="${n.village.id}">\n        <div class="name-field">\n            <span><a target="_blank" href="/game.php?village=${t.game.village.id}&screen=info_village&id=${n.village.id}">${n.village.name} (${n.village.coord.text}) K${n.village.kontinent}</a></span>\n            <span style="font-size:9px;color:black">(${n.arrival})</span>\n        </div>\n        <div class="size-field"><img src="${i}"></div>\n        ${o}\n        <div class="del-field"><a onclick="window.targetItem.removeTargetLauncherItem(${n.village.id.toString()},${e})" class="remove-target-btn"></a></div>\n    </div>`}}},e={};function a(t){var i=e[t];if(void 0!==i)return i.exports;var l=e[t]={exports:{}};return n[t](l,l.exports,a),l.exports}a.d=(n,e)=>{for(var t in e)a.o(e,t)&&!a.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})},a.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),a.r=n=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var t={};(()=>{a.r(t);var n=a("./src/core/Api.ts"),e=a("./src/core/Language.ts"),i=a("./src/core/PlayersModel.ts"),l=a("./src/core/VillageModel.ts"),o=a("./src/core/planDB.ts"),s=a("./src/view/launchDialog.ts");(async()=>{window.Lang=(0,e.determineLang)(),window.DB=new o.planDB,await window.DB.init(),window.Plans=await window.DB.loadPlans(),window.gameConfig=await(0,n.getServerConifg)(),window.unitConfig=await(0,n.getUnitConfig)(),window.Villages=await l.VillageModel.init(),window.Players=await i.PlayersModel.init(),window.Groups=await(0,n.fetchGroups)(),window.Dialog.show("launchDialog",(0,s.launchDialog)()),$(".popup_box_container").append('<div style="position: fixed;width: 100%;height: 100%;top:0;left:0;z-index:12001"></div>')})()})()})();